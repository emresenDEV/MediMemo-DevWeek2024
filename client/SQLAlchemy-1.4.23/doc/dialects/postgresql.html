<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

        <title>
            
    
    PostgreSQL
 &mdash;
    SQLAlchemy 1.4 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.4 Documentation" href="../index.html" />
        <link rel="up" title="Dialects" href="index.html" />
        <link rel="next" title="MySQL and MariaDB" href="mysql.html" />
        <link rel="prev" title="Dialects" href="index.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.4.23</span>


        | Release Date: August 18, 2021

    </div>

    <h1><a href="../index.html">SQLAlchemy 1.4 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.4 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Dialects">Dialects</a>
        </h3>

        <ul>
<li class="selected"><span class="link-container"><strong>PostgreSQL</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql">Support for the PostgreSQL database.</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sequences-serial-identity">Sequences/SERIAL/IDENTITY</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#postgresql-10-and-above-identity-columns">PostgreSQL 10 and above IDENTITY columns</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#server-side-cursors">Server Side Cursors</a></span></li>
<li><span class="link-container"><a class="reference external" href="#transaction-isolation-level">Transaction Isolation Level</a></span></li>
<li><span class="link-container"><a class="reference external" href="#setting-read-only-deferrable">Setting READ ONLY / DEFERRABLE</a></span></li>
<li><span class="link-container"><a class="reference external" href="#setting-alternate-search-paths-on-connect">Setting Alternate Search Paths on Connect</a></span></li>
<li><span class="link-container"><a class="reference external" href="#remote-schema-table-introspection-and-postgresql-search-path">Remote-Schema Table Introspection and PostgreSQL search_path</a></span></li>
<li><span class="link-container"><a class="reference external" href="#insert-update-returning">INSERT/UPDATE…RETURNING</a></span></li>
<li><span class="link-container"><a class="reference external" href="#insert-on-conflict-upsert">INSERT…ON CONFLICT (Upsert)</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#specifying-the-target">Specifying the Target</a></span></li>
<li><span class="link-container"><a class="reference external" href="#the-set-clause">The SET Clause</a></span></li>
<li><span class="link-container"><a class="reference external" href="#updating-using-the-excluded-insert-values">Updating using the Excluded INSERT Values</a></span></li>
<li><span class="link-container"><a class="reference external" href="#additional-where-criteria">Additional WHERE Criteria</a></span></li>
<li><span class="link-container"><a class="reference external" href="#skipping-rows-with-do-nothing">Skipping Rows with DO NOTHING</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#full-text-search">Full Text Search</a></span></li>
<li><span class="link-container"><a class="reference external" href="#from-only">FROM ONLY …</a></span></li>
<li><span class="link-container"><a class="reference external" href="#postgresql-specific-index-options">PostgreSQL-Specific Index Options</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#covering-indexes">Covering Indexes</a></span></li>
<li><span class="link-container"><a class="reference external" href="#partial-indexes">Partial Indexes</a></span></li>
<li><span class="link-container"><a class="reference external" href="#operator-classes">Operator Classes</a></span></li>
<li><span class="link-container"><a class="reference external" href="#index-types">Index Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#index-storage-parameters">Index Storage Parameters</a></span></li>
<li><span class="link-container"><a class="reference external" href="#indexes-with-concurrently">Indexes with CONCURRENTLY</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#postgresql-index-reflection">PostgreSQL Index Reflection</a></span></li>
<li><span class="link-container"><a class="reference external" href="#special-reflection-options">Special Reflection Options</a></span></li>
<li><span class="link-container"><a class="reference external" href="#postgresql-table-options">PostgreSQL Table Options</a></span></li>
<li><span class="link-container"><a class="reference external" href="#table-values-table-and-column-valued-functions-row-and-tuple-objects">Table values, Table and Column valued functions, Row and Tuple objects</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#table-valued-functions">Table-Valued Functions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#column-valued-functions">Column Valued Functions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#row-types">Row Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#table-types-passed-to-functions">Table Types passed to Functions</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#array-types">ARRAY Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#json-types">JSON Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#hstore-type">HSTORE Type</a></span></li>
<li><span class="link-container"><a class="reference external" href="#enum-types">ENUM Types</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-enum-with-array">Using ENUM with ARRAY</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-json-jsonb-with-array">Using JSON/JSONB with ARRAY</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#postgresql-data-types-and-custom-sql-constructs">PostgreSQL Data Types and Custom SQL Constructs</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#range-types">Range Types</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#postgresql-constraint-types">PostgreSQL Constraint Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#postgresql-dml-constructs">PostgreSQL DML Constructs</a></span></li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2">psycopg2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-psycopg2-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-psycopg2-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#psycopg2-connect-arguments">psycopg2 Connect Arguments</a></span></li>
<li><span class="link-container"><a class="reference external" href="#ssl-connections">SSL Connections</a></span></li>
<li><span class="link-container"><a class="reference external" href="#unix-domain-connections">Unix Domain Connections</a></span></li>
<li><span class="link-container"><a class="reference external" href="#specifying-multiple-fallback-hosts">Specifying multiple fallback hosts</a></span></li>
<li><span class="link-container"><a class="reference external" href="#empty-dsn-connections-environment-variable-connections">Empty DSN Connections / Environment Variable Connections</a></span></li>
<li><span class="link-container"><a class="reference external" href="#per-statement-connection-execution-options">Per-Statement/Connection Execution Options</a></span></li>
<li><span class="link-container"><a class="reference external" href="#psycopg2-fast-execution-helpers">Psycopg2 Fast Execution Helpers</a></span></li>
<li><span class="link-container"><a class="reference external" href="#unicode-with-psycopg2">Unicode with Psycopg2</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#disabling-native-unicode">Disabling Native Unicode</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#transactions">Transactions</a></span></li>
<li><span class="link-container"><a class="reference external" href="#psycopg2-transaction-isolation-level">Psycopg2 Transaction Isolation Level</a></span></li>
<li><span class="link-container"><a class="reference external" href="#notice-logging">NOTICE logging</a></span></li>
<li><span class="link-container"><a class="reference external" href="#psycopg2-hstore">HSTORE type</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pg8000">pg8000</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pg8000-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pg8000-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#unicode">Unicode</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pg8000-ssl">SSL Connections</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pg8000-transaction-isolation-level">pg8000 Transaction Isolation Level</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.asyncpg">asyncpg</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-asyncpg-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-asyncpg-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#prepared-statement-cache">Prepared Statement Cache</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi">psycopg2cffi</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-psycopg2cffi-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-psycopg2cffi-connect">Connecting</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pypostgresql">py-postgresql</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pypostgresql-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pypostgresql-connect">Connecting</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pygresql">pygresql</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pygresql-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-postgresql-pygresql-connect">Connecting</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="mysql.html">MySQL and MariaDB</a></span></li>
<li><span class="link-container"><a class="reference external" href="sqlite.html">SQLite</a></span></li>
<li><span class="link-container"><a class="reference external" href="oracle.html">Oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="mssql.html">Microsoft SQL Server</a></span></li>
<li><span class="link-container"><a class="reference external" href="firebird.html">Firebird</a></span></li>
<li><span class="link-container"><a class="reference external" href="sybase.html">Sybase</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar dialects-postgresql" >
        
<section id="module-sqlalchemy.dialects.postgresql.base">
<span id="postgresql"></span><span id="postgresql-toplevel"></span><h1>PostgreSQL<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.base" title="Permalink to this headline">¶</a></h1>
<section id="dialect-postgresql">
<p>Support for the PostgreSQL database.</p>
<p>The following table summarizes current support levels for database release versions.</p>
<p><table class="docutils align-default" id="id7">
<caption><span class="caption-text"><strong>Supported PostgreSQL versions</strong></span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Support type</p></th>
<th class="head"><p>Versions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#term-Fully-tested-in-CI"><span class="xref std std-term">Fully tested in CI</span></a></p></td>
<td><p>9.6, 10, 11, 12, 13</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#term-Normal-support"><span class="xref std std-term">Normal support</span></a></p></td>
<td><p>9.6+</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#term-Best-effort"><span class="xref std std-term">Best effort</span></a></p></td>
<td><p>8+</p></td>
</tr>
</tbody>
</table>
</p>
<h2>DBAPI Support<a class="headerlink" href="#dialect-postgresql" title="Permalink to this headline">¶</a></h2>
<p>The following dialect/DBAPI options are available.  Please refer to individual DBAPI sections for connect information.<ul class="simple">
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2">psycopg2</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pg8000">pg8000</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.asyncpg">asyncpg</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi">psycopg2cffi</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pypostgresql">py-postgresql</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.postgresql.pygresql">pygresql</a></p></li>
</ul>
</p>
</section>
<section id="sequences-serial-identity">
<span id="postgresql-sequences"></span><h2>Sequences/SERIAL/IDENTITY<a class="headerlink" href="#sequences-serial-identity" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL supports sequences, and SQLAlchemy uses these as the default means
of creating new primary key values for integer-based primary key columns. When
creating tables, SQLAlchemy will issue the <code class="docutils literal notranslate"><span class="pre">SERIAL</span></code> datatype for
integer-based primary key columns, which generates a sequence and server side
default corresponding to the column.</p>
<p>To specify a specific named sequence to be used for primary key generation,
use the <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Sequence" title="sqlalchemy.schema.Sequence"><code class="xref py py-func docutils literal notranslate"><span class="pre">Sequence()</span></code></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">(</span><span class="s1">&#39;some_id_seq&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<p>When SQLAlchemy issues a single INSERT statement, to fulfill the contract of
having the “last insert identifier” available, a RETURNING clause is added to
the INSERT statement which specifies the primary key columns should be
returned after the statement completes. The RETURNING functionality only takes
place if PostgreSQL 8.2 or later is in use. As a fallback approach, the
sequence, whether specified explicitly or implicitly via <code class="docutils literal notranslate"><span class="pre">SERIAL</span></code>, is
executed independently beforehand, the returned value to be used in the
subsequent insert. Note that when an
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> construct is executed using
“executemany” semantics, the “last inserted identifier” functionality does not
apply; no RETURNING clause is emitted nor is the sequence pre-executed in this
case.</p>
<p>To force the usage of RETURNING by default off, specify the flag
<code class="docutils literal notranslate"><span class="pre">implicit_returning=False</span></code> to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.</p>
<section id="postgresql-10-and-above-identity-columns">
<h3>PostgreSQL 10 and above IDENTITY columns<a class="headerlink" href="#postgresql-10-and-above-identity-columns" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL 10 and above have a new IDENTITY feature that supersedes the use
of SERIAL. The <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> construct in a
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> can be used to control its behavior:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Computed</span>

<span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;data&quot;</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span>
        <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Identity</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The CREATE TABLE for the above <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object would be:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">data</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">AS</span> <span class="k">IDENTITY</span> <span class="p">(</span><span class="k">START</span> <span class="k">WITH</span> <span class="mi">42</span> <span class="k">CYCLE</span><span class="p">),</span>
    <span class="k">data</span> <span class="nb">VARCHAR</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>Added <a class="reference internal" href="../core/defaults.html#sqlalchemy.schema.Identity" title="sqlalchemy.schema.Identity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Identity</span></code></a> construct
in a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> to specify the option of an autoincrementing
column.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previous versions of SQLAlchemy did not have built-in support for rendering
of IDENTITY, and could use the following compilation hook to replace
occurrences of SERIAL with IDENTITY:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.schema</span> <span class="kn">import</span> <span class="n">CreateColumn</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="kn">import</span> <span class="n">compiles</span>


<span class="nd">@compiles</span><span class="p">(</span><span class="n">CreateColumn</span><span class="p">,</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">use_identity</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_create_column</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="s2">&quot;SERIAL&quot;</span><span class="p">,</span> <span class="s2">&quot;INT GENERATED BY DEFAULT AS IDENTITY&quot;</span>
     <span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span></pre></div>
</div>
<p>Using the above, a table such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Will generate on the backing database as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">t</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INT</span> <span class="n">GENERATED</span> <span class="n">BY</span> <span class="n">DEFAULT</span> <span class="n">AS</span> <span class="n">IDENTITY</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">VARCHAR</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</div>
</section>
</section>
<section id="server-side-cursors">
<span id="postgresql-ss-cursors"></span><h2>Server Side Cursors<a class="headerlink" href="#server-side-cursors" title="Permalink to this headline">¶</a></h2>
<p>Server-side cursor support is available for the psycopg2, asyncpg
dialects and may also be available in others.</p>
<p>Server side cursors are enabled on a per-statement basis by using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.stream_results" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.stream_results</span></code></a> connection execution
option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">stream_results</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;select * from table&quot;</span><span class="p">))</span></pre></div>
</div>
<p>Note that some kinds of SQL statements may not be supported with
server side cursors; generally, only SQL statements that return rows should be
used with this option.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The dialect-level server_side_cursors flag is deprecated
and will be removed in a future release.  Please use the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.params.stream_results" title="sqlalchemy.engine.Connection"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.stream_results</span></code></a> execution option for
unbuffered cursor support.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/connections.html#engine-stream-results"><span class="std std-ref">Using Server Side Cursors (a.k.a. stream results)</span></a></p>
</div>
</section>
<section id="transaction-isolation-level">
<span id="postgresql-isolation-level"></span><h2>Transaction Isolation Level<a class="headerlink" href="#transaction-isolation-level" title="Permalink to this headline">¶</a></h2>
<p>Most SQLAlchemy dialects support setting of transaction isolation level
using the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.execution_options" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.execution_options</span></code></a> parameter
at the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> level, and at the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
level via the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
parameter.</p>
<p>For PostgreSQL dialects, this feature works either by making use of the
DBAPI-specific features, such as psycopg2’s isolation level flags which will
embed the isolation level setting inline with the <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> statement, or for
DBAPIs with no direct support by emitting <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">CHARACTERISTICS</span> <span class="pre">AS</span>
<span class="pre">TRANSACTION</span> <span class="pre">ISOLATION</span> <span class="pre">LEVEL</span> <span class="pre">&lt;level&gt;</span></code> ahead of the <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> statement
emitted by the DBAPI.   For the special AUTOCOMMIT isolation level,
DBAPI-specific techniques are used which is typically an <code class="docutils literal notranslate"><span class="pre">.autocommit</span></code>
flag on the DBAPI connection object.</p>
<p>To set isolation level using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;isolation_level&quot;</span><span class="p">:</span> <span class="s2">&quot;REPEATABLE READ&quot;</span>
    <span class="p">}</span>
<span class="p">)</span></pre></div>
</div>
<p>To set using per-connection execution options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
        <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;REPEATABLE READ&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="c1"># ... work with transaction</span></pre></div>
</div>
<p>Valid values for <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> on most PostgreSQL dialects include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-readonly-deferrable"><span class="std std-ref">Setting READ ONLY / DEFERRABLE</span></a></p>
<p><a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">Setting Transaction Isolation Levels including DBAPI Autocommit</span></a></p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#pg8000-isolation-level"><span class="std std-ref">pg8000 Transaction Isolation Level</span></a></p>
</div>
</section>
<section id="setting-read-only-deferrable">
<span id="postgresql-readonly-deferrable"></span><h2>Setting READ ONLY / DEFERRABLE<a class="headerlink" href="#setting-read-only-deferrable" title="Permalink to this headline">¶</a></h2>
<p>Most PostgreSQL dialects support setting the “READ ONLY” and “DEFERRABLE”
characteristics of the transaction, which is in addition to the isolation level
setting. These two attributes can be established either in conjunction with or
independently of the isolation level by passing the <code class="docutils literal notranslate"><span class="pre">postgresql_readonly</span></code> and
<code class="docutils literal notranslate"><span class="pre">postgresql_deferrable</span></code> flags with
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>.  The example below illustrates
passing the <code class="docutils literal notranslate"><span class="pre">&quot;SERIALIZABLE&quot;</span></code> isolation level at the same time as setting
“READ ONLY” and “DEFERRABLE”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span>
        <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;SERIALIZABLE&quot;</span><span class="p">,</span>
        <span class="n">postgresql_readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">postgresql_deferrable</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="c1">#  ... work with transaction</span></pre></div>
</div>
<p>Note that some DBAPIs such as asyncpg only support “readonly” with
SERIALIZABLE isolation.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>added support for the <code class="docutils literal notranslate"><span class="pre">postgresql_readonly</span></code>
and <code class="docutils literal notranslate"><span class="pre">postgresql_deferrable</span></code> execution options.</p>
</div>
</section>
<section id="setting-alternate-search-paths-on-connect">
<span id="postgresql-alternate-search-path"></span><h2>Setting Alternate Search Paths on Connect<a class="headerlink" href="#setting-alternate-search-paths-on-connect" title="Permalink to this headline">¶</a></h2>
<p>The PostgreSQL <code class="docutils literal notranslate"><span class="pre">search_path</span></code> variable refers to the list of schema names
that will be implicitly referred towards when a particular table or other
object is referenced in a SQL statement.  As detailed in the next section
<a class="reference internal" href="#postgresql-schema-reflection"><span class="std std-ref">Remote-Schema Table Introspection and PostgreSQL search_path</span></a>, SQLAlchemy is generally organized around
the concept of keeping this variable at its default value of <code class="docutils literal notranslate"><span class="pre">public</span></code>,
however, in order to have it set to any arbitrary name or names when connections
are used automatically, the “SET SESSION search_path” command may be invoked
for all connections in a pool using the following event handler, as discussed
at <a class="reference internal" href="../core/metadata.html#schema-set-default-connections"><span class="std std-ref">Setting a Default Schema for New Connections</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">)</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="n">insert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_search_path</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">existing_autocommit</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SET SESSION search_path=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">schema_name</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="n">existing_autocommit</span></pre></div>
</div>
<p>The reason the recipe is complicated by use of the <code class="docutils literal notranslate"><span class="pre">.autocommit</span></code> DBAPI
attribute is so that when the <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">SESSION</span> <span class="pre">search_path</span></code> directive is invoked,
it is invoked outside of the scope of any transaction and therefore will not
be reverted when the DBAPI connection has a rollback.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/metadata.html#schema-set-default-connections"><span class="std std-ref">Setting a Default Schema for New Connections</span></a> - in the <a class="reference internal" href="../core/metadata.html"><span class="std std-ref">Describing Databases with MetaData</span></a> documentation</p>
</div>
</section>
<section id="remote-schema-table-introspection-and-postgresql-search-path">
<span id="postgresql-schema-reflection"></span><h2>Remote-Schema Table Introspection and PostgreSQL search_path<a class="headerlink" href="#remote-schema-table-introspection-and-postgresql-search-path" title="Permalink to this headline">¶</a></h2>
<p><strong>TL;DR;</strong>: keep the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> variable set to its default of <code class="docutils literal notranslate"><span class="pre">public</span></code>,
name schemas <strong>other</strong> than <code class="docutils literal notranslate"><span class="pre">public</span></code> explicitly within <code class="docutils literal notranslate"><span class="pre">Table</span></code> definitions.</p>
<p>The PostgreSQL dialect can reflect tables from any schema.  The
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.params.schema" title="sqlalchemy.schema.Table"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Table.schema</span></code></a> argument, or alternatively the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect.params.schema" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">MetaData.reflect.schema</span></code></a> argument determines which schema will
be searched for the table or tables.   The reflected <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
objects
will in all cases retain this <code class="docutils literal notranslate"><span class="pre">.schema</span></code> attribute as was specified.
However, with regards to tables which these <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
objects refer to
via foreign key constraint, a decision must be made as to how the <code class="docutils literal notranslate"><span class="pre">.schema</span></code>
is represented in those remote tables, in the case where that remote
schema name is also a member of the current
<a class="reference external" href="https://www.postgresql.org/docs/current/static/ddl-schemas.html#DDL-SCHEMAS-PATH">PostgreSQL search path</a>.</p>
<p>By default, the PostgreSQL dialect mimics the behavior encouraged by
PostgreSQL’s own <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> builtin procedure.  This function
returns a sample definition for a particular foreign key constraint,
omitting the referenced schema name from that definition when the name is
also in the PostgreSQL schema search path.  The interaction below
illustrates this behavior:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span> <span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">test_schema</span><span class="o">.</span><span class="n">referred</span><span class="p">(</span><span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">);</span>
<span class="n">CREATE</span> <span class="n">TABLE</span>
<span class="n">test</span><span class="o">=&gt;</span> <span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">referring</span><span class="p">(</span>
<span class="n">test</span><span class="p">(</span><span class="o">&gt;</span>         <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span>
<span class="n">test</span><span class="p">(</span><span class="o">&gt;</span>         <span class="n">referred_id</span> <span class="n">INTEGER</span> <span class="n">REFERENCES</span> <span class="n">test_schema</span><span class="o">.</span><span class="n">referred</span><span class="p">(</span><span class="nb">id</span><span class="p">));</span>
<span class="n">CREATE</span> <span class="n">TABLE</span>
<span class="n">test</span><span class="o">=&gt;</span> <span class="n">SET</span> <span class="n">search_path</span> <span class="n">TO</span> <span class="n">public</span><span class="p">,</span> <span class="n">test_schema</span><span class="p">;</span>
<span class="n">test</span><span class="o">=&gt;</span> <span class="n">SELECT</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_get_constraintdef</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">oid</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span> <span class="n">FROM</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_class</span> <span class="n">c</span> <span class="n">JOIN</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_namespace</span> <span class="n">n</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">ON</span> <span class="n">n</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">relnamespace</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">JOIN</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_constraint</span> <span class="n">r</span>  <span class="n">ON</span> <span class="n">c</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">conrelid</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">WHERE</span> <span class="n">c</span><span class="o">.</span><span class="n">relname</span><span class="o">=</span><span class="s1">&#39;referring&#39;</span> <span class="n">AND</span> <span class="n">r</span><span class="o">.</span><span class="n">contype</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="p">;</span>
               <span class="n">pg_get_constraintdef</span>
<span class="o">---------------------------------------------------</span>
 <span class="n">FOREIGN</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">referred_id</span><span class="p">)</span> <span class="n">REFERENCES</span> <span class="n">referred</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span></pre></div>
</div>
<p>Above, we created a table <code class="docutils literal notranslate"><span class="pre">referred</span></code> as a member of the remote schema
<code class="docutils literal notranslate"><span class="pre">test_schema</span></code>, however when we added <code class="docutils literal notranslate"><span class="pre">test_schema</span></code> to the
PG <code class="docutils literal notranslate"><span class="pre">search_path</span></code> and then asked <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> for the
<code class="docutils literal notranslate"><span class="pre">FOREIGN</span> <span class="pre">KEY</span></code> syntax, <code class="docutils literal notranslate"><span class="pre">test_schema</span></code> was not included in the output of
the function.</p>
<p>On the other hand, if we set the search path back to the typical default
of <code class="docutils literal notranslate"><span class="pre">public</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span> <span class="n">SET</span> <span class="n">search_path</span> <span class="n">TO</span> <span class="n">public</span><span class="p">;</span>
<span class="n">SET</span></pre></div>
</div>
<p>The same query against <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code> now returns the fully
schema-qualified name for us:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="o">=&gt;</span> <span class="n">SELECT</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_get_constraintdef</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">oid</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span> <span class="n">FROM</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_class</span> <span class="n">c</span> <span class="n">JOIN</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_namespace</span> <span class="n">n</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">ON</span> <span class="n">n</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">relnamespace</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">JOIN</span> <span class="n">pg_catalog</span><span class="o">.</span><span class="n">pg_constraint</span> <span class="n">r</span>  <span class="n">ON</span> <span class="n">c</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">conrelid</span>
<span class="n">test</span><span class="o">-&gt;</span> <span class="n">WHERE</span> <span class="n">c</span><span class="o">.</span><span class="n">relname</span><span class="o">=</span><span class="s1">&#39;referring&#39;</span> <span class="n">AND</span> <span class="n">r</span><span class="o">.</span><span class="n">contype</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span><span class="p">;</span>
                     <span class="n">pg_get_constraintdef</span>
<span class="o">---------------------------------------------------------------</span>
 <span class="n">FOREIGN</span> <span class="n">KEY</span> <span class="p">(</span><span class="n">referred_id</span><span class="p">)</span> <span class="n">REFERENCES</span> <span class="n">test_schema</span><span class="o">.</span><span class="n">referred</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span></pre></div>
</div>
<p>SQLAlchemy will by default use the return value of <code class="docutils literal notranslate"><span class="pre">pg_get_constraintdef()</span></code>
in order to determine the remote schema name.  That is, if our <code class="docutils literal notranslate"><span class="pre">search_path</span></code>
were set to include <code class="docutils literal notranslate"><span class="pre">test_schema</span></code>, and we invoked a table
reflection process as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;SET search_path TO test_schema, public&quot;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">referring</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;referring&#39;</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">autoload_with</span><span class="o">=</span><span class="n">conn</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;sqlalchemy.engine.result.CursorResult object at 0x101612ed0&gt;</span></pre></div>
</div>
<p>The above process would deliver to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.tables" title="sqlalchemy.schema.MetaData.tables"><code class="xref py py-attr docutils literal notranslate"><span class="pre">MetaData.tables</span></code></a>
collection
<code class="docutils literal notranslate"><span class="pre">referred</span></code> table named <strong>without</strong> the schema:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;referred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schema</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span></pre></div>
</div>
<p>To alter the behavior of reflection such that the referred schema is
maintained regardless of the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> setting, use the
<code class="docutils literal notranslate"><span class="pre">postgresql_ignore_search_path</span></code> option, which can be specified as a
dialect-specific argument to both <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as well as
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;SET search_path TO test_schema, public&quot;</span><span class="p">))</span>
<span class="gp">... </span>    <span class="n">meta</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">referring</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;referring&#39;</span><span class="p">,</span> <span class="n">meta</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">autoload_with</span><span class="o">=</span><span class="n">conn</span><span class="p">,</span>
<span class="gp">... </span>                      <span class="n">postgresql_ignore_search_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">&lt;sqlalchemy.engine.result.CursorResult object at 0x1016126d0&gt;</span></pre></div>
</div>
<p>We will now have <code class="docutils literal notranslate"><span class="pre">test_schema.referred</span></code> stored as schema-qualified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">meta</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s1">&#39;test_schema.referred&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">schema</span>
<span class="go">&#39;test_schema&#39;</span></pre></div>
</div>
<aside class="sidebar">
<p class="sidebar-title">Best Practices for PostgreSQL Schema reflection</p>
<p>The description of PostgreSQL schema reflection behavior is complex, and
is the product of many years of dealing with widely varied use cases and
user preferences. But in fact, there’s no need to understand any of it if
you just stick to the simplest use pattern: leave the <code class="docutils literal notranslate"><span class="pre">search_path</span></code> set
to its default of <code class="docutils literal notranslate"><span class="pre">public</span></code> only, never refer to the name <code class="docutils literal notranslate"><span class="pre">public</span></code> as
an explicit schema name otherwise, and refer to all other schema names
explicitly when building up a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> object.  The options
described here are only for those users who can’t, or prefer not to, stay
within these guidelines.</p>
</aside>
<p>Note that <strong>in all cases</strong>, the “default” schema is always reflected as
<code class="docutils literal notranslate"><span class="pre">None</span></code>. The “default” schema on PostgreSQL is that which is returned by the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">current_schema()</span></code> function.  On a typical PostgreSQL
installation, this is the name <code class="docutils literal notranslate"><span class="pre">public</span></code>.  So a table that refers to another
which is in the <code class="docutils literal notranslate"><span class="pre">public</span></code> (i.e. default) schema will always have the
<code class="docutils literal notranslate"><span class="pre">.schema</span></code> attribute set to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.2: </span>Added the <code class="docutils literal notranslate"><span class="pre">postgresql_ignore_search_path</span></code>
dialect-level option accepted by <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> and
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData.reflect" title="sqlalchemy.schema.MetaData.reflect"><code class="xref py py-meth docutils literal notranslate"><span class="pre">MetaData.reflect()</span></code></a>.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/9.0/static/ddl-schemas.html#DDL-SCHEMAS-PATH">The Schema Search Path</a>
- on the PostgreSQL website.</p>
</div>
</section>
<section id="insert-update-returning">
<h2>INSERT/UPDATE…RETURNING<a class="headerlink" href="#insert-update-returning" title="Permalink to this headline">¶</a></h2>
<p>The dialect supports PG 8.2’s <code class="docutils literal notranslate"><span class="pre">INSERT..RETURNING</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE..RETURNING</span></code> and
<code class="docutils literal notranslate"><span class="pre">DELETE..RETURNING</span></code> syntaxes.   <code class="docutils literal notranslate"><span class="pre">INSERT..RETURNING</span></code> is used by default
for single-row INSERT statements in order to fetch newly generated
primary key identifiers.   To specify an explicit <code class="docutils literal notranslate"><span class="pre">RETURNING</span></code> clause,
use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">_UpdateBase.returning()</span></code> method on a per-statement basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># INSERT..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># UPDATE..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># DELETE..RETURNING</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">col2</span><span class="p">)</span><span class="o">.</span>\
    <span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">==</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></pre></div>
</div>
</section>
<section id="insert-on-conflict-upsert">
<span id="postgresql-insert-on-conflict"></span><h2>INSERT…ON CONFLICT (Upsert)<a class="headerlink" href="#insert-on-conflict-upsert" title="Permalink to this headline">¶</a></h2>
<p>Starting with version 9.5, PostgreSQL allows “upserts” (update or insert) of
rows into a table via the <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement. A
candidate row will only be inserted if that row does not violate any unique
constraints.  In the case of a unique constraint violation, a secondary action
can occur which can be either “DO UPDATE”, indicating that the data in the
target row should be updated, or “DO NOTHING”, which indicates to silently skip
this row.</p>
<p>Conflicts are determined using existing unique constraints and indexes.  These
constraints may be identified either using their name as stated in DDL,
or they may be inferred by stating the columns and conditions that comprise
the indexes.</p>
<p>SQLAlchemy provides <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> support via the PostgreSQL-specific
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> function, which provides
the generative methods <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">insert</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">insert_stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_existing_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_nothing_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_nothing_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">=</span><span class="s1">&#39;pk_my_table&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="k">ON</span> <span class="k">CONSTRAINT</span> <span class="n">pk_my_table</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-insert.html#SQL-ON-CONFLICT">INSERT .. ON CONFLICT</a>
- in the PostgreSQL documentation.</p>
</div>
<section id="specifying-the-target">
<h3>Specifying the Target<a class="headerlink" href="#specifying-the-target" title="Permalink to this headline">¶</a></h3>
<p>Both methods supply the “target” of the conflict using either the
named constraint or by column inference:</p>
<ul>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a> argument
specifies a sequence containing string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, and/or SQL expression elements, which would identify a unique
index:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
<li><p>When using <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a> to
infer an index, a partial index can be inferred by also specifying the
use the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_where</span></code></a> parameter:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">user_email</span><span class="o">=</span><span class="s1">&#39;a@b.com&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted data&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_email</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">index_where</span><span class="o">=</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_email</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;%@gmail.com&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="n">user_email</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">user_email</span><span class="p">)</span><span class="n">s</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">user_email</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">user_email</span> <span class="k">LIKE</span> <span class="o">%</span><span class="p">(</span><span class="n">user_email_1</span><span class="p">)</span><span class="n">s</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="k">data</span>
</div></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.constraint</span></code></a> argument is
used to specify an index directly rather than inferring it.  This can be
the name of a UNIQUE constraint, a PRIMARY KEY constraint, or an INDEX:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">=</span><span class="s1">&#39;my_table_idx_1&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="k">ON</span> <span class="k">CONSTRAINT</span> <span class="n">my_table_idx_1</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">=</span><span class="s1">&#39;my_table_pk&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="k">ON</span> <span class="k">CONSTRAINT</span> <span class="n">my_table_pk</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.constraint</span></code></a> argument may
also refer to a SQLAlchemy construct representing a constraint,
e.g. <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryKeyConstraint</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>, or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a>.   In this use,
if the constraint has a name, it is used directly.  Otherwise, if the
constraint is unnamed, then inference will be used, where the expressions
and optional WHERE clause of the constraint will be spelled out in the
construct.  This use is especially convenient
to refer to the named or unnamed primary key of a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
using the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.primary_key" title="sqlalchemy.schema.Table.primary_key"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.primary_key</span></code></a> attribute:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">constraint</span><span class="o">=</span><span class="n">my_table</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</li>
</ul>
</section>
<section id="the-set-clause">
<h3>The SET Clause<a class="headerlink" href="#the-set-clause" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT...DO</span> <span class="pre">UPDATE</span></code> is used to perform an update of the already
existing row, using any combination of new values as well as values
from the proposed insertion.   These values are specified using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> parameter.  This
parameter accepts a dictionary which consists of direct values
for UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code>
method does <strong>not</strong> take into
account Python-side default UPDATE values or generation functions, e.g.
those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>.
These values will not be exercised for an ON CONFLICT style of UPDATE,
unless they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</section>
<section id="updating-using-the-excluded-insert-values">
<h3>Updating using the Excluded INSERT Values<a class="headerlink" href="#updating-using-the-excluded-insert-values" title="Permalink to this headline">¶</a></h3>
<p>In order to refer to the proposed insertion row, the special alias
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="sqlalchemy.dialects.postgresql.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> is available as an attribute on
the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object; this object is a
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>
which alias contains all columns of the target
table:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;jlh&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">author</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">author</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
</div></pre></div>
</div>
</section>
<section id="additional-where-criteria">
<h3>Additional WHERE Criteria<a class="headerlink" href="#additional-where-criteria" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code> method also accepts
a WHERE clause using the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.where</span></code></a>
parameter, which will limit those rows which receive an UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;jlh&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">on_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">author</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">on_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">author</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">author</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
<span class="k">WHERE</span> <span class="n">my_table</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="o">%</span><span class="p">(</span><span class="n">status_1</span><span class="p">)</span><span class="n">s</span>
</div></pre></div>
</div>
</section>
<section id="skipping-rows-with-do-nothing">
<h3>Skipping Rows with DO NOTHING<a class="headerlink" href="#skipping-rows-with-do-nothing" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> may be used to skip inserting a row entirely
if any conflict with a unique or exclusion constraint occurs; below
this is illustrated using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a> method:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span><span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div></pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> is used without specifying any columns or constraint,
it has the effect of skipping the INSERT for any unique or exclusion
constraint violation which occurs:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">%</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="k">data</span><span class="p">)</span><span class="n">s</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div></pre></div>
</div>
</section>
</section>
<section id="full-text-search">
<span id="postgresql-match"></span><h2>Full Text Search<a class="headerlink" href="#full-text-search" title="Permalink to this headline">¶</a></h2>
<p>SQLAlchemy makes available the PostgreSQL <code class="docutils literal notranslate"><span class="pre">&#64;&#64;</span></code> operator via the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.match" title="sqlalchemy.sql.expression.ColumnElement.match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.match()</span></code></a>
method on any textual column expression.
On a PostgreSQL dialect, an expression like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">sometable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;search string&quot;</span><span class="p">))</span></pre></div>
</div>
<p>will emit to the database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">text</span> <span class="o">@@</span> <span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;search string&#39;</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">table</span></pre></div>
</div>
<p>The PostgreSQL text search functions such as <code class="docutils literal notranslate"><span class="pre">to_tsquery()</span></code>
and <code class="docutils literal notranslate"><span class="pre">to_tsvector()</span></code> are available
explicitly using the standard <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a> construct.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">to_tsvector</span><span class="p">(</span><span class="s1">&#39;fat cats ate rats&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;cat &amp; rat&#39;</span><span class="p">))</span></pre></div>
</div>
<p>Emits the equivalent of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">to_tsvector</span><span class="p">(</span><span class="s1">&#39;fat cats ate rats&#39;</span><span class="p">)</span> <span class="o">@@</span> <span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;cat &amp; rat&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type can provide for explicit CAST:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">TSVECTOR</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">cast</span>
<span class="n">select</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;some text&quot;</span><span class="p">,</span> <span class="n">TSVECTOR</span><span class="p">))</span></pre></div>
</div>
<p>produces a statement equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">CAST</span><span class="p">(</span><span class="s1">&#39;some text&#39;</span> <span class="n">AS</span> <span class="n">TSVECTOR</span><span class="p">)</span> <span class="n">AS</span> <span class="n">anon_1</span></pre></div>
</div>
<p>Full Text Searches in PostgreSQL are influenced by a combination of: the
PostgreSQL setting of <code class="docutils literal notranslate"><span class="pre">default_text_search_config</span></code>, the <code class="docutils literal notranslate"><span class="pre">regconfig</span></code> used
to build the GIN/GiST indexes, and the <code class="docutils literal notranslate"><span class="pre">regconfig</span></code> optionally passed in
during a query.</p>
<p>When performing a Full Text Search against a column that has a GIN or
GiST index that is already pre-computed (which is common on full text
searches) one may need to explicitly pass in a particular PostgreSQL
<code class="docutils literal notranslate"><span class="pre">regconfig</span></code> value to ensure the query-planner utilizes the index and does
not re-compute the column on demand.</p>
<p>In order to provide for this explicit query planning, or to use different
search strategies, the <code class="docutils literal notranslate"><span class="pre">match</span></code> method accepts a <code class="docutils literal notranslate"><span class="pre">postgresql_regconfig</span></code>
keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;somestring&#39;</span><span class="p">,</span> <span class="n">postgresql_regconfig</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Emits the equivalent of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">mytable</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span> <span class="n">mytable</span>
<span class="n">WHERE</span> <span class="n">mytable</span><span class="o">.</span><span class="n">title</span> <span class="o">@@</span> <span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="s1">&#39;somestring&#39;</span><span class="p">)</span></pre></div>
</div>
<p>One can also specifically pass in a <cite>‘regconfig’</cite> value to the
<code class="docutils literal notranslate"><span class="pre">to_tsvector()</span></code> command as the initial argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">func</span><span class="o">.</span><span class="n">to_tsvector</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">title</span> <span class="p">)</span>\
        <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;somestring&#39;</span><span class="p">,</span> <span class="n">postgresql_regconfig</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<p>produces a statement equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">mytable</span><span class="o">.</span><span class="n">id</span> <span class="n">FROM</span> <span class="n">mytable</span>
<span class="n">WHERE</span> <span class="n">to_tsvector</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">mytable</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="o">@@</span>
    <span class="n">to_tsquery</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="s1">&#39;somestring&#39;</span><span class="p">)</span></pre></div>
</div>
<p>It is recommended that you use the <code class="docutils literal notranslate"><span class="pre">EXPLAIN</span> <span class="pre">ANALYZE...</span></code> tool from
PostgreSQL to ensure that you are generating queries with SQLAlchemy that
take full advantage of any indexes you may have created for full text search.</p>
</section>
<section id="from-only">
<h2>FROM ONLY …<a class="headerlink" href="#from-only" title="Permalink to this headline">¶</a></h2>
<p>The dialect supports PostgreSQL’s ONLY keyword for targeting only a particular
table in an inheritance hierarchy. This can be used to produce the
<code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">...</span> <span class="pre">FROM</span> <span class="pre">ONLY</span></code>, <code class="docutils literal notranslate"><span class="pre">UPDATE</span> <span class="pre">ONLY</span> <span class="pre">...</span></code>, and <code class="docutils literal notranslate"><span class="pre">DELETE</span> <span class="pre">FROM</span> <span class="pre">ONLY</span> <span class="pre">...</span></code>
syntaxes. It uses SQLAlchemy’s hints mechanism:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># SELECT ... FROM ONLY ...</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s1">&#39;ONLY&#39;</span><span class="p">,</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c1"># UPDATE ONLY ...</span>
<span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span><span class="s1">&#39;ONLY&#39;</span><span class="p">,</span>
                                               <span class="n">dialect_name</span><span class="o">=</span><span class="s1">&#39;postgresql&#39;</span><span class="p">)</span>

<span class="c1"># DELETE FROM ONLY ...</span>
<span class="n">table</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">with_hint</span><span class="p">(</span><span class="s1">&#39;ONLY&#39;</span><span class="p">,</span> <span class="n">dialect_name</span><span class="o">=</span><span class="s1">&#39;postgresql&#39;</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="postgresql-specific-index-options">
<span id="postgresql-indexes"></span><h2>PostgreSQL-Specific Index Options<a class="headerlink" href="#postgresql-specific-index-options" title="Permalink to this headline">¶</a></h2>
<p>Several extensions to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct are available, specific
to the PostgreSQL dialect.</p>
<section id="covering-indexes">
<h3>Covering Indexes<a class="headerlink" href="#covering-indexes" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">postgresql_include</span></code> option renders INCLUDE(colname) for the given
string names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s2">&quot;my_index&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">postgresql_include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span></pre></div>
</div>
<p>would render the index as <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">INDEX</span> <span class="pre">my_index</span> <span class="pre">ON</span> <span class="pre">table</span> <span class="pre">(x)</span> <span class="pre">INCLUDE</span> <span class="pre">(y)</span></code></p>
<p>Note that this feature requires PostgreSQL 11 or later.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
</section>
<section id="partial-indexes">
<span id="postgresql-partial-indexes"></span><h3>Partial Indexes<a class="headerlink" href="#partial-indexes" title="Permalink to this headline">¶</a></h3>
<p>Partial indexes add criterion to the index definition so that the index is
applied to a subset of rows.   These can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a>
using the <code class="docutils literal notranslate"><span class="pre">postgresql_where</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">postgresql_where</span><span class="o">=</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="operator-classes">
<span id="postgresql-operator-classes"></span><h3>Operator Classes<a class="headerlink" href="#operator-classes" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL allows the specification of an <em>operator class</em> for each column of
an index (see
<a class="reference external" href="https://www.postgresql.org/docs/8.3/interactive/indexes-opclass.html">https://www.postgresql.org/docs/8.3/interactive/indexes-opclass.html</a>).
The <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct allows these to be specified via the
<code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span>
    <span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
    <span class="n">postgresql_ops</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;text_pattern_ops&#39;</span><span class="p">,</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int4_ops&#39;</span>
    <span class="p">})</span></pre></div>
</div>
<p>Note that the keys in the <code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> dictionaries are the
“key” name of the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>, i.e. the name used to access it from
the <code class="docutils literal notranslate"><span class="pre">.c</span></code> collection of <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>, which can be configured to be
different than the actual name of the column as expressed in the database.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">postgresql_ops</span></code> is to be used against a complex SQL expression such
as a function call, then to apply to the column it must be given a label
that is identified in the dictionary by name, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span>
    <span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;data_lower&#39;</span><span class="p">),</span>
    <span class="n">postgresql_ops</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;data_lower&#39;</span><span class="p">:</span> <span class="s1">&#39;text_pattern_ops&#39;</span><span class="p">,</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;int4_ops&#39;</span>
    <span class="p">})</span></pre></div>
</div>
<p>Operator classes are also supported by the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> construct using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ExcludeConstraint.ops</span></code></a> parameter. See that parameter for
details.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.21: </span>added support for operator classes with
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a>.</p>
</div>
</section>
<section id="index-types">
<h3>Index Types<a class="headerlink" href="#index-types" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL provides several index types: B-Tree, Hash, GiST, and GIN, as well
as the ability for users to create their own (see
<a class="reference external" href="https://www.postgresql.org/docs/8.3/static/indexes-types.html">https://www.postgresql.org/docs/8.3/static/indexes-types.html</a>). These can be
specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">postgresql_using</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_using</span><span class="o">=</span><span class="s1">&#39;gin&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The value passed to the keyword argument will be simply passed through to the
underlying CREATE INDEX command, so it <em>must</em> be a valid index type for your
version of PostgreSQL.</p>
</section>
<section id="index-storage-parameters">
<span id="postgresql-index-storage"></span><h3>Index Storage Parameters<a class="headerlink" href="#index-storage-parameters" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL allows storage parameters to be set on indexes. The storage
parameters available depend on the index method used by the index. Storage
parameters can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">postgresql_with</span></code>
keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_with</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fillfactor&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">})</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.6.</span></p>
</div>
<p>PostgreSQL allows to define the tablespace in which to create the index.
The tablespace can be specified on <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> using the
<code class="docutils literal notranslate"><span class="pre">postgresql_tablespace</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;my_index&#39;</span><span class="p">,</span> <span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_tablespace</span><span class="o">=</span><span class="s1">&#39;my_tablespace&#39;</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
<p>Note that the same option is available on <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as well.</p>
</section>
<section id="indexes-with-concurrently">
<span id="postgresql-index-concurrently"></span><h3>Indexes with CONCURRENTLY<a class="headerlink" href="#indexes-with-concurrently" title="Permalink to this headline">¶</a></h3>
<p>The PostgreSQL index option CONCURRENTLY is supported by passing the
flag <code class="docutils literal notranslate"><span class="pre">postgresql_concurrently</span></code> to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;testtbl&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>

<span class="n">idx1</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;test_idx1&#39;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">postgresql_concurrently</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>The above index construct will render DDL for CREATE INDEX, assuming
PostgreSQL 8.2 or higher is detected or for a connection-less dialect, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">CONCURRENTLY</span> <span class="n">test_idx1</span> <span class="n">ON</span> <span class="n">testtbl</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span></pre></div>
</div>
<p>For DROP INDEX, assuming PostgreSQL 9.2 or higher is detected or for
a connection-less dialect, it will emit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DROP</span> <span class="n">INDEX</span> <span class="n">CONCURRENTLY</span> <span class="n">test_idx1</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1: </span>support for CONCURRENTLY on DROP INDEX.  The
CONCURRENTLY keyword is now only emitted if a high enough version
of PostgreSQL is detected on the connection (or for a connection-less
dialect).</p>
</div>
<p>When using CONCURRENTLY, the PostgreSQL database requires that the statement
be invoked outside of a transaction block.   The Python DBAPI enforces that
even for a single statement, a transaction is present, so to use this
construct, the DBAPI’s “autocommit” mode must be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">String</span><span class="p">))</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span>
    <span class="s2">&quot;foo_idx&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">postgresql_concurrently</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">isolation_level</span><span class="o">=</span><span class="s1">&#39;AUTOCOMMIT&#39;</span><span class="p">):</span>
        <span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
</div>
</section>
</section>
<section id="postgresql-index-reflection">
<span id="id1"></span><h2>PostgreSQL Index Reflection<a class="headerlink" href="#postgresql-index-reflection" title="Permalink to this headline">¶</a></h2>
<p>The PostgreSQL database creates a UNIQUE INDEX implicitly whenever the
UNIQUE CONSTRAINT construct is used.   When inspecting a table using
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a>, the <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_indexes" title="sqlalchemy.engine.reflection.Inspector.get_indexes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_indexes()</span></code></a>
and the <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_unique_constraints" title="sqlalchemy.engine.reflection.Inspector.get_unique_constraints"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_unique_constraints()</span></code></a>
will report on these
two constructs distinctly; in the case of the index, the key
<code class="docutils literal notranslate"><span class="pre">duplicates_constraint</span></code> will be present in the index entry if it is
detected as mirroring a constraint.   When performing reflection using
<code class="docutils literal notranslate"><span class="pre">Table(...,</span> <span class="pre">autoload_with=engine)</span></code>, the UNIQUE INDEX is <strong>not</strong> returned
in <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.indexes" title="sqlalchemy.schema.Table.indexes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.indexes</span></code></a> when it is detected as mirroring a
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> in the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.constraints" title="sqlalchemy.schema.Table.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.constraints</span></code></a> collection
.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.0.0: </span>- <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> reflection now includes
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> objects present in the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.constraints" title="sqlalchemy.schema.Table.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.constraints</span></code></a>
collection; the PostgreSQL backend will no longer include a “mirrored”
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct in <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.indexes" title="sqlalchemy.schema.Table.indexes"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.indexes</span></code></a>
if it is detected
as corresponding to a unique constraint.</p>
</div>
</section>
<section id="special-reflection-options">
<h2>Special Reflection Options<a class="headerlink" href="#special-reflection-options" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">Inspector</span></code></a>
used for the PostgreSQL backend is an instance
of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="sqlalchemy.dialects.postgresql.base.PGInspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">PGInspector</span></code></a>, which offers additional methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">inspect</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://localhost/test&quot;</span><span class="p">)</span>
<span class="n">insp</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will be a PGInspector</span>

<span class="nb">print</span><span class="p">(</span><span class="n">insp</span><span class="o">.</span><span class="n">get_enums</span><span class="p">())</span></pre></div>
</div>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><span class="sig-name descname">PGInspector</span></a></p></td>
<td></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.base.</span></span><span class="sig-name descname"><span class="pre">PGInspector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector" title="sqlalchemy.dialects.postgresql.base.PGInspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector</span></code></a> (<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector" title="sqlalchemy.engine.reflection.Inspector"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.engine.reflection.Inspector</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_enums</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of ENUM objects.</p>
<p>Each member is a dictionary containing these fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>name - name of the enum</p></li>
<li><p>schema - the schema name for the enum.</p></li>
<li><p>visible - boolean, whether or not this enum is visible
in the default search path.</p></li>
<li><p>labels - a list of string labels that apply to the enum.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums.params.schema">¶</a> – schema name.  If None, the default schema
(typically ‘public’) is used.  May also be set to ‘*’ to
indicate load enums for all schemas.</p>
</dd>
</dl>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_foreign_table_names</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_foreign_table_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of FOREIGN TABLE names.</p>
<p>Behavior is similar to that of
<a class="reference internal" href="../core/reflection.html#sqlalchemy.engine.reflection.Inspector.get_table_names" title="sqlalchemy.engine.reflection.Inspector.get_table_names"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Inspector.get_table_names()</span></code></a>,
except that the list is limited to those tables that report a
<code class="docutils literal notranslate"><span class="pre">relkind</span></code> value of <code class="docutils literal notranslate"><span class="pre">f</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.0.</span></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_table_oid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_table_oid" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the OID for the given table name.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.base.PGInspector.</span></code></a><span class="sig-name descname"><span class="pre">get_view_names</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">schema</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">('plain',</span> <span class="pre">'materialized')</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all view names in <cite>schema</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names.params.schema"></span><strong>schema</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names.params.schema">¶</a> – Optional, retrieve names from a non-default schema.
For special quoting, use <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.quoted_name" title="sqlalchemy.sql.expression.quoted_name"><code class="xref py py-class docutils literal notranslate"><span class="pre">quoted_name</span></code></a>.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names.params.include"></span><strong>include</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_view_names.params.include">¶</a> – <p>specify which types of views to return.  Passed
as a string value (for a single type) or a tuple (for any number
of types).  Defaults to <code class="docutils literal notranslate"><span class="pre">('plain',</span> <span class="pre">'materialized')</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="postgresql-table-options">
<span id="id2"></span><h2>PostgreSQL Table Options<a class="headerlink" href="#postgresql-table-options" title="Permalink to this headline">¶</a></h2>
<p>Several options for CREATE TABLE are supported directly by the PostgreSQL
dialect in conjunction with the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLESPACE</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_tablespace</span><span class="o">=</span><span class="s1">&#39;some_tablespace&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The above option is also available on the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">COMMIT</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_on_commit</span><span class="o">=</span><span class="s1">&#39;PRESERVE ROWS&#39;</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">OIDS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_with_oids</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITHOUT</span> <span class="pre">OIDS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_with_oids</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">INHERITS</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_inherits</span><span class="o">=</span><span class="s2">&quot;some_supertable&quot;</span><span class="p">)</span>

<span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">postgresql_inherits</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;t1&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="o">...</span><span class="p">))</span>

<span class="o">..</span> <span class="n">versionadded</span><span class="p">::</span> <span class="mf">1.0.0</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PARTITION</span> <span class="pre">BY</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
      <span class="n">postgresql_partition_by</span><span class="o">=</span><span class="s1">&#39;LIST (part_column)&#39;</span><span class="p">)</span>

<span class="o">..</span> <span class="n">versionadded</span><span class="p">::</span> <span class="mf">1.2.6</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/static/sql-createtable.html">PostgreSQL CREATE TABLE options</a></p>
</div>
</section>
<section id="table-values-table-and-column-valued-functions-row-and-tuple-objects">
<span id="postgresql-table-valued-overview"></span><h2>Table values, Table and Column valued functions, Row and Tuple objects<a class="headerlink" href="#table-values-table-and-column-valued-functions-row-and-tuple-objects" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL makes great use of modern SQL forms such as table-valued functions,
tables and rows as values.   These constructs are commonly used as part
of PostgreSQL’s support for complex datatypes such as JSON, ARRAY, and other
datatypes.  SQLAlchemy’s SQL expression language has native support for
most table-valued and row-valued forms.</p>
<section id="table-valued-functions">
<span id="postgresql-table-valued"></span><h3>Table-Valued Functions<a class="headerlink" href="#table-valued-functions" title="Permalink to this headline">¶</a></h3>
<p>Many PostgreSQL built-in functions are intended to be used in the FROM clause
of a SELECT statement, and are capable of returning table rows or sets of table
rows. A large portion of PostgreSQL’s JSON functions for example such as
<code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_object_keys()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_each_text()</span></code>,
<code class="docutils literal notranslate"><span class="pre">json_each()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_to_record()</span></code>, <code class="docutils literal notranslate"><span class="pre">json_populate_recordset()</span></code> use such
forms. These classes of SQL function calling forms in SQLAlchemy are available
using the <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method in conjunction
with <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.Function" title="sqlalchemy.sql.functions.Function"><code class="xref py py-class docutils literal notranslate"><span class="pre">Function</span></code></a> objects generated from the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-data docutils literal notranslate"><span class="pre">func</span></code></a>
namespace.</p>
<p>Examples from PostgreSQL’s reference documentation follow below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">json_each()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">json_each</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;:&quot;foo&quot;, &quot;b&quot;:&quot;bar&quot;}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">table_valued</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT anon_1.key, anon_1.value</span>
<span class="go">FROM json_each(:json_each_1) AS anon_1</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">json_populate_record()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">literal_column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">func</span><span class="o">.</span><span class="n">json_populate_record</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">literal_column</span><span class="p">(</span><span class="s2">&quot;null::myrowtype&quot;</span><span class="p">),</span>
<span class="gp">... </span>        <span class="s1">&#39;{&quot;a&quot;:1,&quot;b&quot;:2}&#39;</span>
<span class="gp">... </span>    <span class="p">)</span><span class="o">.</span><span class="n">table_valued</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT x.a, x.b</span>
<span class="go">FROM json_populate_record(null::myrowtype, :json_populate_record_1) AS x</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">json_to_record()</span></code> - this form uses a PostgreSQL specific form of derived
columns in the alias, where we may make use of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a> elements with
types to produce them.  The <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a>
method produces  a <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableValuedAlias" title="sqlalchemy.sql.expression.TableValuedAlias"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableValuedAlias</span></code></a> construct, and the method
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableValuedAlias.render_derived" title="sqlalchemy.sql.expression.TableValuedAlias.render_derived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TableValuedAlias.render_derived()</span></code></a> method sets up the derived
columns specification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Text</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">func</span><span class="o">.</span><span class="n">json_to_record</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;:1,&quot;b&quot;:[1,2,3],&quot;c&quot;:&quot;bar&quot;}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">table_valued</span><span class="p">(</span>
<span class="gp">... </span>        <span class="n">column</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">)</span><span class="o">.</span><span class="n">render_derived</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">with_types</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT x.a, x.b, x.d</span>
<span class="go">FROM json_to_record(:json_to_record_1) AS x(a INTEGER, b TEXT, d TEXT)</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> - part of the SQL standard, <code class="docutils literal notranslate"><span class="pre">WITH</span> <span class="pre">ORDINALITY</span></code> adds an
ordinal counter to the output of a function and is accepted by a limited set
of PostgreSQL functions including <code class="docutils literal notranslate"><span class="pre">unnest()</span></code> and <code class="docutils literal notranslate"><span class="pre">generate_series()</span></code>. The
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method accepts a keyword
parameter <code class="docutils literal notranslate"><span class="pre">with_ordinality</span></code> for this purpose, which accepts the string name
that will be applied to the “ordinality” column:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">func</span><span class="o">.</span><span class="n">generate_series</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">table_valued</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">with_ordinality</span><span class="o">=</span><span class="s2">&quot;ordinality&quot;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT anon_1.value, anon_1.ordinality</span>
<span class="go">FROM generate_series(:generate_series_1, :generate_series_2, :generate_series_3) WITH ORDINALITY AS anon_1</span></pre></div>
</div>
</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.0b2.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-functions-table-valued"><span class="std std-ref">Table-Valued Functions</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 1.4 / 2.0 Tutorial</span></a></p>
</div>
</section>
<section id="column-valued-functions">
<span id="postgresql-column-valued"></span><h3>Column Valued Functions<a class="headerlink" href="#column-valued-functions" title="Permalink to this headline">¶</a></h3>
<p>Similar to the table valued function, a column valued function is present
in the FROM clause, but delivers itself to the columns clause as a single
scalar value.  PostgreSQL functions such as <code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>,
<code class="docutils literal notranslate"><span class="pre">unnest()</span></code> and <code class="docutils literal notranslate"><span class="pre">generate_series()</span></code> may use this form. Column valued functions are available using the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.column_valued" title="sqlalchemy.sql.functions.FunctionElement.column_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.column_valued()</span></code></a> method of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement" title="sqlalchemy.sql.functions.FunctionElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionElement</span></code></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">json_array_elements()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">json_array_elements</span><span class="p">(</span><span class="s1">&#39;[&quot;one&quot;, &quot;two&quot;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">column_valued</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT x</span>
<span class="go">FROM json_array_elements(:json_array_elements_1) AS x</span></pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">unnest()</span></code> - in order to generate a PostgreSQL ARRAY literal, the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-func docutils literal notranslate"><span class="pre">array()</span></code></a> construct may be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">unnest</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span><span class="o">.</span><span class="n">column_valued</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT anon_1</span>
<span class="go">FROM unnest(ARRAY[%(param_1)s, %(param_2)s]) AS anon_1</span></pre></div>
</div>
<p>The function can of course be used against an existing table-bound column
that’s of type <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">,</span> <span class="n">Integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">unnest</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">column_valued</span><span class="p">(</span><span class="s2">&quot;unnested_value&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT unnested_value</span>
<span class="go">FROM unnest(t.value) AS unnested_value</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../tutorial/data_select.html#tutorial-functions-column-valued"><span class="std std-ref">Column Valued Functions - Table Valued Function as a Scalar Column</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 1.4 / 2.0 Tutorial</span></a></p>
</div>
</section>
<section id="row-types">
<h3>Row Types<a class="headerlink" href="#row-types" title="Permalink to this headline">¶</a></h3>
<p>Built-in support for rendering a <code class="docutils literal notranslate"><span class="pre">ROW</span></code> may be approximated using
<code class="docutils literal notranslate"><span class="pre">func.ROW</span></code> with the <code class="xref py py-attr docutils literal notranslate"><span class="pre">sqlalchemy.func</span></code> namespace, or by using the
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.tuple_" title="sqlalchemy.sql.expression.tuple_"><code class="xref py py-func docutils literal notranslate"><span class="pre">tuple_()</span></code></a> construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">tuple_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;fk&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">tuple_</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">fk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">func</span><span class="o">.</span><span class="n">ROW</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">fk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">func</span><span class="o">.</span><span class="n">ROW</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT t.id, t.fk</span>
<span class="go">FROM t</span>
<span class="go">WHERE (t.id, t.fk) &gt; (:param_1, :param_2) AND ROW(t.id, t.fk) &lt; ROW(:ROW_1, :ROW_2)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/sql-expressions.html#SQL-SYNTAX-ROW-CONSTRUCTORS">PostgreSQL Row Constructors</a></p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/functions-comparisons.html#ROW-WISE-COMPARISON">PostgreSQL Row Constructor Comparison</a></p>
</div>
</section>
<section id="table-types-passed-to-functions">
<h3>Table Types passed to Functions<a class="headerlink" href="#table-types-passed-to-functions" title="Permalink to this headline">¶</a></h3>
<p>PostgreSQL supports passing a table as an argument to a function, which it
refers towards as a “record” type. SQLAlchemy <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a> objects
such as <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> support this special form using the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause.table_valued" title="sqlalchemy.sql.expression.FromClause.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FromClause.table_valued()</span></code></a> method, which is comparable to the
<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.FunctionElement.table_valued" title="sqlalchemy.sql.functions.FunctionElement.table_valued"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FunctionElement.table_valued()</span></code></a> method except that the collection
of columns is already established by that of the <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.FromClause" title="sqlalchemy.sql.expression.FromClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">FromClause</span></code></a>
itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">row_to_json</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">table_valued</span><span class="p">()))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<span class="go">SELECT row_to_json(a) AS row_to_json_1</span>
<span class="go">FROM a</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.0b2.</span></p>
</div>
</section>
</section>
<section id="array-types">
<h2>ARRAY Types<a class="headerlink" href="#array-types" title="Permalink to this headline">¶</a></h2>
<p>The PostgreSQL dialect supports arrays, both as multidimensional column types
as well as array literals:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> - ARRAY datatype</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> - array literal</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg" title="sqlalchemy.dialects.postgresql.array_agg"><code class="xref py py-func docutils literal notranslate"><span class="pre">array_agg()</span></code></a> - ARRAY_AGG SQL function</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal notranslate"><span class="pre">aggregate_order_by</span></code></a> - helper for PG’s ORDER BY aggregate
function syntax.</p></li>
</ul>
</section>
<section id="json-types">
<h2>JSON Types<a class="headerlink" href="#json-types" title="Permalink to this headline">¶</a></h2>
<p>The PostgreSQL dialect supports both JSON and JSONB datatypes, including
psycopg2’s native support and support for all of PostgreSQL’s special
operators:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a></p></li>
</ul>
</section>
<section id="hstore-type">
<h2>HSTORE Type<a class="headerlink" href="#hstore-type" title="Permalink to this headline">¶</a></h2>
<p>The PostgreSQL HSTORE type as well as hstore literals are supported:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> - HSTORE datatype</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> - hstore literal</p></li>
</ul>
</section>
<section id="enum-types">
<h2>ENUM Types<a class="headerlink" href="#enum-types" title="Permalink to this headline">¶</a></h2>
<p>PostgreSQL has an independently creatable TYPE structure which is used
to implement an enumerated type.   This approach introduces significant
complexity on the SQLAlchemy side in terms of when this type should be
CREATED and DROPPED.   The type object is also an independently reflectable
entity.   The following sections should be consulted:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> - DDL and typing support for ENUM.</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.base.PGInspector.get_enums" title="sqlalchemy.dialects.postgresql.base.PGInspector.get_enums"><code class="xref py py-meth docutils literal notranslate"><span class="pre">PGInspector.get_enums()</span></code></a> - retrieve a listing of current ENUM types</p></li>
<li><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a> , <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a> - individual
CREATE and DROP commands for ENUM.</p></li>
</ul>
<section id="using-enum-with-array">
<span id="postgresql-array-of-enum"></span><h3>Using ENUM with ARRAY<a class="headerlink" href="#using-enum-with-array" title="Permalink to this headline">¶</a></h3>
<p>The combination of ENUM and ARRAY is not directly supported by backend
DBAPIs at this time.   Prior to SQLAlchemy 1.3.17, a special workaround
was needed in order to allow this combination to work, described below.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.3.17: </span>The combination of ENUM and ARRAY is now directly
handled by SQLAlchemy’s implementation without any workarounds needed.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">TypeDecorator</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">ARRAY</span>

<span class="k">class</span> <span class="nc">ArrayOfEnum</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">ARRAY</span>

    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">result_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">):</span>
        <span class="n">super_rp</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArrayOfEnum</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">result_processor</span><span class="p">(</span>
            <span class="n">dialect</span><span class="p">,</span> <span class="n">coltype</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^{(.*)}$&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">inner</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">inner</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">super_rp</span><span class="p">(</span><span class="n">handle_raw_string</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">process</span></pre></div>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;mydata&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">ArrayOfEnum</span><span class="p">(</span><span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b, &#39;</span><span class="n">c</span><span class="s1">&#39;, name=&#39;</span><span class="n">myenum</span><span class="s1">&#39;)))</span>

<span class="p">)</span></pre></div>
</div>
<p>This type is not included as a built-in type as it would be incompatible
with a DBAPI that suddenly decides to support ARRAY of ENUM directly in
a new version.</p>
</section>
<section id="using-json-jsonb-with-array">
<span id="postgresql-array-of-json"></span><h3>Using JSON/JSONB with ARRAY<a class="headerlink" href="#using-json-jsonb-with-array" title="Permalink to this headline">¶</a></h3>
<p>Similar to using ENUM, prior to SQLAlchemy 1.3.17, for an ARRAY of JSON/JSONB
we need to render the appropriate CAST.   Current psycopg2 drivers accommodate
the result set correctly without any special steps.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.3.17: </span>The combination of JSON/JSONB and ARRAY is now
directly handled by SQLAlchemy’s implementation without any workarounds
needed.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CastingArray</span><span class="p">(</span><span class="n">ARRAY</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bind_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bindvalue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sa</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bindvalue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></pre></div>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;mydata&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">CastingArray</span><span class="p">(</span><span class="n">JSONB</span><span class="p">))</span>
<span class="p">)</span></pre></div>
</div>
</section>
</section>
<section id="postgresql-data-types-and-custom-sql-constructs">
<h2>PostgreSQL Data Types and Custom SQL Constructs<a class="headerlink" href="#postgresql-data-types-and-custom-sql-constructs" title="Permalink to this headline">¶</a></h2>
<p>As with all SQLAlchemy dialects, all UPPERCASE types that are known to be
valid with PostgreSQL are importable from the top level dialect, whether
they originate from <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.types</span></code></a> or from the local dialect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> \
    <span class="n">ARRAY</span><span class="p">,</span> <span class="n">BIGINT</span><span class="p">,</span> <span class="n">BIT</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">BYTEA</span><span class="p">,</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">CIDR</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> \
    <span class="n">DOUBLE_PRECISION</span><span class="p">,</span> <span class="n">ENUM</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> <span class="n">HSTORE</span><span class="p">,</span> <span class="n">INET</span><span class="p">,</span> <span class="n">INTEGER</span><span class="p">,</span> \
    <span class="n">INTERVAL</span><span class="p">,</span> <span class="n">JSON</span><span class="p">,</span> <span class="n">JSONB</span><span class="p">,</span> <span class="n">MACADDR</span><span class="p">,</span> <span class="n">MONEY</span><span class="p">,</span> <span class="n">NUMERIC</span><span class="p">,</span> <span class="n">OID</span><span class="p">,</span> <span class="n">REAL</span><span class="p">,</span> <span class="n">SMALLINT</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> \
    <span class="n">TIME</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">VARCHAR</span><span class="p">,</span> <span class="n">INT4RANGE</span><span class="p">,</span> <span class="n">INT8RANGE</span><span class="p">,</span> <span class="n">NUMRANGE</span><span class="p">,</span> \
    <span class="n">DATERANGE</span><span class="p">,</span> <span class="n">TSRANGE</span><span class="p">,</span> <span class="n">TSTZRANGE</span><span class="p">,</span> <span class="n">TSVECTOR</span></pre></div>
</div>
<p>Types which are specific to PostgreSQL, or have PostgreSQL-specific
construction arguments, are as follows:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by"><span class="sig-name descname">aggregate_order_by</span></a></p></td>
<td><p>Represent a PostgreSQL aggregate order by expression.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.All"><span class="sig-name descname">All</span></a>(other, arrexpr[, operator])</p></td>
<td><p>A synonym for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a> method.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Any"><span class="sig-name descname">Any</span></a>(other, arrexpr[, operator])</p></td>
<td><p>A synonym for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> method.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array"><span class="sig-name descname">array</span></a></p></td>
<td><p>A PostgreSQL ARRAY literal.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY"><span class="sig-name descname">ARRAY</span></a></p></td>
<td><p>PostgreSQL ARRAY type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array_agg"><span class="sig-name descname">array_agg</span></a>(*arg, **kw)</p></td>
<td><p>PostgreSQL-specific form of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a>, ensures
return type is <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and not
the plain <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>, unless an explicit <code class="docutils literal notranslate"><span class="pre">type_</span></code>
is passed.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BIT"><span class="sig-name descname">BIT</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA"><span class="sig-name descname">BYTEA</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR"><span class="sig-name descname">CIDR</span></a></p></td>
<td></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION"><span class="sig-name descname">DOUBLE_PRECISION</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><span class="sig-name descname">ENUM</span></a></p></td>
<td><p>PostgreSQL ENUM type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><span class="sig-name descname">HSTORE</span></a></p></td>
<td><p>Represent the PostgreSQL HSTORE type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><span class="sig-name descname">hstore</span></a></p></td>
<td><p>Construct an hstore value within a SQL expression using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET"><span class="sig-name descname">INET</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL"><span class="sig-name descname">INTERVAL</span></a></p></td>
<td><p>PostgreSQL INTERVAL type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><span class="sig-name descname">JSON</span></a></p></td>
<td><p>Represent the PostgreSQL JSON type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB"><span class="sig-name descname">JSONB</span></a></p></td>
<td><p>Represent the PostgreSQL JSONB type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR"><span class="sig-name descname">MACADDR</span></a></p></td>
<td></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.MONEY"><span class="sig-name descname">MONEY</span></a></p></td>
<td><p>Provide the PostgreSQL MONEY type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.OID"><span class="sig-name descname">OID</span></a></p></td>
<td><p>Provide the PostgreSQL OID type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REAL"><span class="sig-name descname">REAL</span></a></p></td>
<td><p>The SQL REAL type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCLASS"><span class="sig-name descname">REGCLASS</span></a></p></td>
<td><p>Provide the PostgreSQL REGCLASS type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR"><span class="sig-name descname">TSVECTOR</span></a></p></td>
<td><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type implements the PostgreSQL
text search type TSVECTOR.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.UUID"><span class="sig-name descname">UUID</span></a></p></td>
<td><p>PostgreSQL UUID type.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.aggregate_order_by">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">aggregate_order_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">order_by</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a PostgreSQL aggregate order by expression.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">aggregate_order_by</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">array_agg</span><span class="p">(</span><span class="n">aggregate_order_by</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></pre></div>
</div>
<p>would represent the expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">array_agg</span><span class="p">(</span><span class="n">a</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">b</span> <span class="n">DESC</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">table</span><span class="p">;</span></pre></div>
</div>
<p>Similarly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expr</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">string_agg</span><span class="p">(</span>
    <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">,</span>
    <span class="n">aggregate_order_by</span><span class="p">(</span><span class="n">literal_column</span><span class="p">(</span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="p">),</span> <span class="n">table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></pre></div>
</div>
<p>Would represent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">string_agg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span> <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">a</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">table</span><span class="p">;</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.2.13: </span>- the ORDER BY argument may be multiple terms</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.aggregate_order_by" title="sqlalchemy.dialects.postgresql.aggregate_order_by"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.aggregate_order_by</span></code></a> (<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.ColumnElement</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.array">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clauses</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.array" title="Permalink to this definition">¶</a></dt>
<dd><p>A PostgreSQL ARRAY literal.</p>
<p>This is used to produce ARRAY literals in SQL expressions, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">postgresql</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>Produces the SQL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">param_2</span><span class="p">)</span><span class="n">s</span><span class="p">]</span> <span class="o">||</span>
    <span class="n">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_3</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">param_4</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">param_5</span><span class="p">)</span><span class="n">s</span><span class="p">])</span> <span class="n">AS</span> <span class="n">anon_1</span></pre></div>
</div>
<p>An instance of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> will always have the datatype
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>.  The “inner” type of the array is inferred from
the values present, unless the <code class="docutils literal notranslate"><span class="pre">type_</span></code> keyword argument is passed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span> <span class="n">type_</span><span class="o">=</span><span class="n">CHAR</span><span class="p">)</span></pre></div>
</div>
<p>Multidimensional arrays are produced by nesting <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> constructs.
The dimensionality of the final <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type is calculated by
recursively adding the dimensions of the inner <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span>
    <span class="n">array</span><span class="p">([</span>
        <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> <span class="n">array</span><span class="p">([</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">),</span> <span class="n">column</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)])</span>
    <span class="p">])</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dialect</span><span class="o">=</span><span class="n">postgresql</span><span class="o">.</span><span class="n">dialect</span><span class="p">()))</span></pre></div>
</div>
<p>Produces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">ARRAY</span><span class="p">[</span><span class="n">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_1</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">param_2</span><span class="p">)</span><span class="n">s</span><span class="p">],</span>
<span class="n">ARRAY</span><span class="p">[</span><span class="o">%</span><span class="p">(</span><span class="n">param_3</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="o">%</span><span class="p">(</span><span class="n">param_4</span><span class="p">)</span><span class="n">s</span><span class="p">],</span> <span class="n">ARRAY</span><span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">]]</span> <span class="n">AS</span> <span class="n">anon_1</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.6: </span>added support for multidimensional array literals</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.array</span></code></a> (<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ClauseList" title="sqlalchemy.sql.expression.ClauseList"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.ClauseList</span></code></a>, <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement" title="sqlalchemy.sql.expression.ColumnElement"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.ColumnElement</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ARRAY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_tuple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_indexes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL ARRAY type.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type is now
a subclass of the core <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type.</p>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type is constructed in the same way
as the core <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type; a member type is required, and a
number of dimensions is recommended if the type is to be used for more
than one dimension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects</span> <span class="kn">import</span> <span class="n">postgresql</span>

<span class="n">mytable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s2">&quot;mytable&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">postgresql</span><span class="o">.</span><span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type provides all operations defined on the
core <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type, including support for “dimensions”,
indexed access, and simple matching such as
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> and
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a>.  <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
class also
provides PostgreSQL-specific methods for containment operations, including
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contains()</span></code></a>
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contained_by()</span></code></a>, and
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.overlap()</span></code></a>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mytable</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">contains</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> type may not be supported on all
PostgreSQL DBAPIs; it is currently known to work on psycopg2 only.</p>
<p>Additionally, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>
type does not work directly in
conjunction with the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> type.  For a workaround, see the
special type at <a class="reference internal" href="#postgresql-array-of-enum"><span class="std std-ref">Using ENUM with ARRAY</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> - base array type</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.array" title="sqlalchemy.dialects.postgresql.array"><code class="xref py py-class docutils literal notranslate"><span class="pre">array</span></code></a> - produces a literal array value.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.ARRAY</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">Comparator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator" title="Permalink to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>.</p>
<p>Note that these operations are in addition to those provided
by the base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator" title="sqlalchemy.types.ARRAY.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Comparator</span></code></a> class, including
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> and
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator" title="sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contained_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if elements are a proper subset of the
elements of the argument array expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if elements are a superset of the
elements of the argument array expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">overlap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.Comparator.overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if array has elements in common with
an argument array expression.</p>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ARRAY.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ARRAY.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">item_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_tuple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dimensions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zero_indexes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ARRAY.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an ARRAY.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;myarray&#39;</span><span class="p">,</span> <span class="n">ARRAY</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span></pre></div>
</div>
<p>Arguments are:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.item_type"></span><strong>item_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.item_type">¶</a> – The data type of items of this array. Note that
dimensionality is irrelevant here, so multi-dimensional arrays like
<code class="docutils literal notranslate"><span class="pre">INTEGER[][]</span></code>, are constructed as <code class="docutils literal notranslate"><span class="pre">ARRAY(Integer)</span></code>, not as
<code class="docutils literal notranslate"><span class="pre">ARRAY(ARRAY(Integer))</span></code> or such.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.as_tuple"></span><strong>as_tuple=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.as_tuple">¶</a> – Specify whether return results
should be converted to tuples from lists. DBAPIs such
as psycopg2 return lists by default. When tuples are
returned, the results are hashable.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.dimensions"></span><strong>dimensions</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.dimensions">¶</a> – if non-None, the ARRAY will assume a fixed
number of dimensions.  This will cause the DDL emitted for this
ARRAY to include the exact number of bracket clauses <code class="docutils literal notranslate"><span class="pre">[]</span></code>,
and will also optimize the performance of the type overall.
Note that PG arrays are always implicitly “non-dimensioned”,
meaning they can store any number of dimensions no matter how
they were declared.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ARRAY.params.zero_indexes"></span><strong>zero_indexes=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY.params.zero_indexes">¶</a> – <p>when True, index values will be converted
between Python zero-based and PostgreSQL one-based indexes, e.g.
a value of one will be added to all index values before passing
to the database.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.5.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.array_agg">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">array_agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.array_agg" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL-specific form of <a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.array_agg" title="sqlalchemy.sql.functions.array_agg"><code class="xref py py-class docutils literal notranslate"><span class="pre">array_agg</span></code></a>, ensures
return type is <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ARRAY" title="sqlalchemy.dialects.postgresql.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a> and not
the plain <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY" title="sqlalchemy.types.ARRAY"><code class="xref py py-class docutils literal notranslate"><span class="pre">ARRAY</span></code></a>, unless an explicit <code class="docutils literal notranslate"><span class="pre">type_</span></code>
is passed.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Any">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">Any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">other</span></em>, <em class="sig-param"><span class="pre">arrexpr</span></em>, <em class="sig-param"><span class="pre">operator=&lt;built-in</span> <span class="pre">function</span> <span class="pre">eq&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Any" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.any" title="sqlalchemy.types.ARRAY.Comparator.any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.any()</span></code></a> method.</p>
<p>This method is legacy and is here for backwards-compatibility.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.any_" title="sqlalchemy.sql.expression.any_"><code class="xref py py-func docutils literal notranslate"><span class="pre">any_()</span></code></a></p>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.All">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">All</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">other</span></em>, <em class="sig-param"><span class="pre">arrexpr</span></em>, <em class="sig-param"><span class="pre">operator=&lt;built-in</span> <span class="pre">function</span> <span class="pre">eq&gt;</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.All" title="Permalink to this definition">¶</a></dt>
<dd><p>A synonym for the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.ARRAY.Comparator.all" title="sqlalchemy.types.ARRAY.Comparator.all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.all()</span></code></a> method.</p>
<p>This method is legacy and is here for backwards-compatibility.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.all_" title="sqlalchemy.sql.expression.all_"><code class="xref py py-func docutils literal notranslate"><span class="pre">all_()</span></code></a></p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BIT">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">BIT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">varying</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BIT" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.BIT" title="sqlalchemy.dialects.postgresql.BIT"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BIT</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BYTEA">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">BYTEA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BYTEA" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA" title="sqlalchemy.dialects.postgresql.BYTEA"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BYTEA</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.LargeBinary</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.BYTEA.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.BYTEA.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.BYTEA.__init__" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.LargeBinary.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a></p>
</div>
<p>Construct a LargeBinary type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.BYTEA.params.length"></span><strong>length</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.BYTEA.params.length">¶</a> – optional, a length for the column for use in
DDL statements, for those binary types that accept a length,
such as the MySQL BLOB type.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.CIDR">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">CIDR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.CIDR" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.CIDR" title="sqlalchemy.dialects.postgresql.CIDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.CIDR</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DOUBLE_PRECISION</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION" title="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOUBLE_PRECISION</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Float</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.__init__" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.Float.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a></p>
</div>
<p>Construct a Float.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.precision">¶</a> – the numeric precision for use in DDL <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code>.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.asdecimal"></span><strong>asdecimal</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.asdecimal">¶</a> – the same flag as that of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, but
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.   Note that setting this flag to <code class="docutils literal notranslate"><span class="pre">True</span></code>
results in floating point conversion.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.decimal_return_scale"></span><strong>decimal_return_scale</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.DOUBLE_PRECISION.params.decimal_return_scale">¶</a> – <p>Default scale to use when converting
from floats to Python decimals.  Floating point values will typically
be much longer due to decimal inaccuracy, and most floating point
database types don’t have a notion of “scale”, so by default the
float type looks for the first ten decimal places when converting.
Specifying this value will override that length.  Note that the
MySQL float types, which do include “scale”, will use “scale”
as the default for decimal_return_scale, if not otherwise specified.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ENUM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">enums</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL ENUM type.</p>
<p>This is a subclass of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> which includes
support for PG’s <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> and <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code>.</p>
<p>When the builtin type <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> is used and the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum.params.native_enum" title="sqlalchemy.types.Enum"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Enum.native_enum</span></code></a> flag is left at its default of
True, the PostgreSQL backend will use a <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
type as the implementation, so the special create/drop rules
will be used.</p>
<p>The create/drop behavior of ENUM is necessarily intricate, due to the
awkward relationship the ENUM type has in relationship to the
parent table, in that it may be “owned” by just a single table, or
may be shared among many tables.</p>
<p>When using <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>
in an “inline” fashion, the <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> and <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is emitted
corresponding to when the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.create" title="sqlalchemy.schema.Table.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.create()</span></code></a> and
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.drop" title="sqlalchemy.schema.Table.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Table.drop()</span></code></a>
methods are called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;some_enum&#39;</span><span class="p">,</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;myenum&#39;</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">table</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit CREATE ENUM and CREATE TABLE</span>
<span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TABLE and DROP ENUM</span></pre></div>
</div>
<p>To use a common enumerated type between multiple tables, the best
practice is to declare the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a> or
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> independently, and associate it with the
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.MetaData" title="sqlalchemy.schema.MetaData"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code></a> object itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_enum</span> <span class="o">=</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;myenum&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable_one&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;some_enum&#39;</span><span class="p">,</span> <span class="n">myenum</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">t2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable_two&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;some_enum&#39;</span><span class="p">,</span> <span class="n">myenum</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>When this pattern is used, care must still be taken at the level
of individual table creates.  Emitting CREATE TABLE without also
specifying <code class="docutils literal notranslate"><span class="pre">checkfirst=True</span></code> will still cause issues:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="c1"># will fail: no such type &#39;myenum&#39;</span></pre></div>
</div>
<p>If we specify <code class="docutils literal notranslate"><span class="pre">checkfirst=True</span></code>, the individual table-level create
operation will check for the <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> and create if not exists:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># will check if enum exists, and emit CREATE TYPE if not</span>
<span class="n">t1</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>When using a metadata-level ENUM type, the type will always be created
and dropped if either the metadata-wide create/drop is called:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit CREATE TYPE</span>
<span class="n">metadata</span><span class="o">.</span><span class="n">drop_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>  <span class="c1"># will emit DROP TYPE</span></pre></div>
</div>
<p>The type can also be created and dropped directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_enum</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="n">my_enum</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.0.0: </span>The PostgreSQL <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a> type
now behaves more strictly with regards to CREATE/DROP.  A metadata-level
ENUM type will only be created and dropped at the metadata level,
not the table level, with the exception of
<code class="docutils literal notranslate"><span class="pre">table.create(checkfirst=True)</span></code>.
The <code class="docutils literal notranslate"><span class="pre">table.drop()</span></code> call will now emit a DROP TYPE for a table-level
enumerated type.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.NativeForEmulated</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Enum</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">enums</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>Arguments are the same as that of
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Enum" title="sqlalchemy.types.Enum"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a>, but also including
the following parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.params.create_type"></span><strong>create_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.params.create_type">¶</a> – Defaults to True.
Indicates that <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> should be
emitted, after optionally checking for the
presence of the type, when the parent
table is being created; and additionally
that <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is called when the table
is dropped.    When <code class="docutils literal notranslate"><span class="pre">False</span></code>, no check
will be performed and no <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code>
or <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> is emitted, unless
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a>
or <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a>
are called directly.
Setting to <code class="docutils literal notranslate"><span class="pre">False</span></code> is helpful
when invoking a creation scheme to a SQL file
without access to the actual database -
the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="sqlalchemy.dialects.postgresql.ENUM.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.create()</span></code></a> and
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="sqlalchemy.dialects.postgresql.ENUM.drop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ENUM.drop()</span></code></a> methods can
be used to emit SQL to a target bind.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.create">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">create</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Emit <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TYPE</span></code> for this
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>If the underlying dialect does not support
PostgreSQL CREATE TYPE, no action is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.create.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.create.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.create.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type does not exist already before
creating.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ENUM.drop">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ENUM.</span></code></a><span class="sig-name descname"><span class="pre">drop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checkfirst</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ENUM.drop" title="Permalink to this definition">¶</a></dt>
<dd><p>Emit <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TYPE</span></code> for this
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ENUM" title="sqlalchemy.dialects.postgresql.ENUM"><code class="xref py py-class docutils literal notranslate"><span class="pre">ENUM</span></code></a>.</p>
<p>If the underlying dialect does not support
PostgreSQL DROP TYPE, no action is taken.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.drop.params.bind"></span><strong>bind</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop.params.bind">¶</a> – a connectable <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a>,
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>, or similar object to emit
SQL.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ENUM.drop.params.checkfirst"></span><strong>checkfirst</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ENUM.drop.params.checkfirst">¶</a> – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a query against
the PG catalog will be first performed to see
if the type actually exists before dropping.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">HSTORE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL HSTORE type.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> type stores dictionaries containing strings, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;data_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">HSTORE</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
    <span class="p">)</span></pre></div>
</div>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> provides for a wide range of operations, including:</p>
<ul>
<li><p>Index operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some key&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;some value&#39;</span></pre></div>
</div>
</li>
<li><p>Containment operations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;some key&#39;</span><span class="p">)</span>

<span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">has_all</span><span class="p">([</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">])</span></pre></div>
</div>
</li>
<li><p>Concatenation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="p">{</span><span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="s2">&quot;v1&quot;</span><span class="p">}</span></pre></div>
</div>
</li>
</ul>
<p>For a full list of special methods see
<code class="xref py py-class docutils literal notranslate"><span class="pre">comparator_factory</span></code>.</p>
<p>For usage with the SQLAlchemy ORM, it may be desirable to combine
the usage of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> with <a class="reference internal" href="../orm/extensions/mutable.html#sqlalchemy.ext.mutable.MutableDict" title="sqlalchemy.ext.mutable.MutableDict"><code class="xref py py-class docutils literal notranslate"><span class="pre">MutableDict</span></code></a> dictionary
now part of the <a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a>
extension.  This extension will allow “in-place” changes to the
dictionary, e.g. addition of new keys or replacement/removal of existing
keys to/from the current dictionary, to produce events which will be
detected by the unit of work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.mutable</span> <span class="kn">import</span> <span class="n">MutableDict</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;data_table&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">MutableDict</span><span class="o">.</span><span class="n">as_mutable</span><span class="p">(</span><span class="n">HSTORE</span><span class="p">))</span>

<span class="n">my_object</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">MyClass</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

<span class="c1"># in-place mutation, requires Mutable extension</span>
<span class="c1"># in order for the ORM to detect</span>
<span class="n">my_object</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;some value&#39;</span>

<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></pre></div>
</div>
<p>When the <a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension is not used, the ORM
will not be alerted to any changes to the contents of an existing
dictionary, unless that dictionary value is re-assigned to the
HSTORE-attribute itself, thus generating a change event.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> - render the PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.Indexable" title="sqlalchemy.types.Indexable"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Indexable</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.Concatenable" title="sqlalchemy.types.Concatenable"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Concatenable</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">Comparator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="Permalink to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.array">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">array</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.array" title="Permalink to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of alternating keys and
values.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contained_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys are a proper subset of the
keys of the argument jsonb expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys (or array) are a superset
of/contained the keys of the argument jsonb expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">defined</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.defined" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a non-NULL value for
the key.  Note that the key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>HStore expression.  Returns the contents of this hstore with the
given key deleted.  Note that the key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of all keys in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of any key in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.has_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a key.  Note that the
key may be a SQLA expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of keys.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">matrix</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of [key, value] pairs.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">slice</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.slice" title="Permalink to this definition">¶</a></dt>
<dd><p>HStore expression.  Returns a subset of an hstore defined by
array of keys.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">vals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator.vals" title="Permalink to this definition">¶</a></dt>
<dd><p>Text array expression.  Returns array of values.</p>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.params.text_type"></span><strong>text_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.params.text_type">¶</a> – <p>the type that should be used for indexed values.
Defaults to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">Text</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.0.</span></p>
</div>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.bind_processor">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">bind_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a conversion function for processing bind values.</p>
<p>Returns a callable which will receive a bind parameter value
as the sole positional argument and will return a value to
send to the DB-API.</p>
<p>If processing is not necessary, the method should return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.bind_processor.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.bind_processor.params.dialect">¶</a> – Dialect instance in use.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.comparator_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.Comparator" title="sqlalchemy.dialects.postgresql.hstore.HSTORE.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore.HSTORE.Comparator</span></code></a></p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.HSTORE.</span></code></a><span class="sig-name descname"><span class="pre">result_processor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dialect</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coltype</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a conversion function for processing result row values.</p>
<p>Returns a callable which will receive a result row column
value as the sole positional argument and will return a value
to return to the user.</p>
<p>If processing is not necessary, the method should return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.dialect"></span><strong>dialect</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.dialect">¶</a> – Dialect instance in use.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.coltype"></span><strong>coltype</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE.result_processor.params.coltype">¶</a> – DBAPI coltype argument received in cursor.description.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.hstore">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">hstore</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.hstore" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an hstore value within a SQL expression using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">hstore()</span></code> function.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">hstore</span></code></a> function accepts one or two arguments as described
in the PostgreSQL documentation.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">hstore</span>

<span class="n">select</span><span class="p">(</span><span class="n">hstore</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;value1&#39;</span><span class="p">))</span>

<span class="n">select</span><span class="p">(</span>
    <span class="n">hstore</span><span class="p">(</span>
        <span class="n">array</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">,</span> <span class="s1">&#39;key3&#39;</span><span class="p">]),</span>
        <span class="n">array</span><span class="p">([</span><span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="s1">&#39;value3&#39;</span><span class="p">])</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.hstore.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">HSTORE</span></code></a> - the PostgreSQL <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> datatype.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore" title="sqlalchemy.dialects.postgresql.hstore"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore</span></code></a> (<a class="reference internal" href="../core/functions.html#sqlalchemy.sql.functions.GenericFunction" title="sqlalchemy.sql.functions.GenericFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.functions.GenericFunction</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.hstore.type">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.hstore"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore.</span></code></a><span class="sig-name descname"><span class="pre">type</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.hstore.type" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.HSTORE" title="sqlalchemy.dialects.postgresql.hstore.HSTORE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.hstore.HSTORE</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INET">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INET</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INET" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INET" title="sqlalchemy.dialects.postgresql.INET"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INET</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INTERVAL">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INTERVAL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INTERVAL" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL INTERVAL type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL" title="sqlalchemy.dialects.postgresql.INTERVAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INTERVAL</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.NativeForEmulated</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types._AbstractInterval</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INTERVAL.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INTERVAL.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INTERVAL.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an INTERVAL.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.INTERVAL.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.params.precision">¶</a> – optional integer precision value</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.INTERVAL.params.fields"></span><strong>fields</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.INTERVAL.params.fields">¶</a> – <p>string fields specifier.  allows storage of fields
to be limited, such as <code class="docutils literal notranslate"><span class="pre">&quot;YEAR&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;MONTH&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;DAY</span> <span class="pre">TO</span> <span class="pre">HOUR&quot;</span></code>,
etc.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">JSON</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">none_as_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astext_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL JSON type.</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> is used automatically whenever the base
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype is used against a PostgreSQL backend,
however base <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype does not provide Python
accessors for PostgreSQL-specific comparison methods such as
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.astext()</span></code></a>; additionally, to use
PostgreSQL <code class="docutils literal notranslate"><span class="pre">JSONB</span></code>, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> datatype should
be used explicitly.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> - main documentation for the generic
cross-platform JSON datatype.</p>
</div>
<p>The operators provided by the PostgreSQL version of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>
include:</p>
<ul>
<li><p>Index operations (the <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some key&#39;</span><span class="p">]</span>

<span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span></pre></div>
</div>
</li>
<li><p>Index operations returning text (the <code class="docutils literal notranslate"><span class="pre">-&gt;&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span> <span class="o">==</span> <span class="s1">&#39;some value&#39;</span></pre></div>
</div>
<p>Note that equivalent functionality is available via the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_string" title="sqlalchemy.types.JSON.Comparator.as_string"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.as_string</span></code></a> accessor.</p>
</li>
<li><p>Index operations with CAST
(equivalent to <code class="docutils literal notranslate"><span class="pre">CAST(col</span> <span class="pre">-&gt;&gt;</span> <span class="pre">['some</span> <span class="pre">key']</span> <span class="pre">AS</span> <span class="pre">&lt;type&gt;)</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span></pre></div>
</div>
<p>Note that equivalent functionality is available via the
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.Comparator.as_integer" title="sqlalchemy.types.JSON.Comparator.as_integer"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.as_integer</span></code></a> and similar accessors.</p>
</li>
<li><p>Path index operations (the <code class="docutils literal notranslate"><span class="pre">#&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[(</span><span class="s1">&#39;key_1&#39;</span><span class="p">,</span> <span class="s1">&#39;key_2&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;key_n&#39;</span><span class="p">)]</span></pre></div>
</div>
</li>
<li><p>Path index operations returning text (the <code class="docutils literal notranslate"><span class="pre">#&gt;&gt;</span></code> operator):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[(</span><span class="s1">&#39;key_1&#39;</span><span class="p">,</span> <span class="s1">&#39;key_2&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;key_n&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">astext</span> <span class="o">==</span> <span class="s1">&#39;some value&#39;</span></pre></div>
</div>
</li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span>The <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a>
operator on
JSON objects now requires that the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.astext</span></code></a>
modifier be called explicitly, if the cast works only from a textual
string.</p>
</div>
<p>Index operations return an expression object whose type defaults to
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> by default,
so that further JSON-oriented instructions
may be called upon the result type.</p>
<p>Custom serializers and deserializers are specified at the dialect level,
that is using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.  The reason for this is that when
using psycopg2, the DBAPI only allows serializers at the per-cursor
or per-connection level.   E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
                        <span class="n">json_serializer</span><span class="o">=</span><span class="n">my_serialize_fn</span><span class="p">,</span>
                        <span class="n">json_deserializer</span><span class="o">=</span><span class="n">my_deserialize_fn</span>
                <span class="p">)</span></pre></div>
</div>
<p>When using the psycopg2 dialect, the json_deserializer is registered
against the database using <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_json</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> - Core level JSON type</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a></p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> is now a PostgreSQL-
specific specialization of the new <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type.</p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.JSON</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.Comparator">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">Comparator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="Permalink to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="sqlalchemy.dialects.postgresql.JSON.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.Comparator.astext">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">astext</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="Permalink to this definition">¶</a></dt>
<dd><p>On an indexed expression, use the “astext” (e.g. “-&gt;&gt;”)
conversion when rendered in SQL.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">select</span><span class="p">(</span><span class="n">data_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;some key&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astext</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnElement.cast" title="sqlalchemy.sql.expression.ColumnElement.cast"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnElement.cast()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">none_as_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astext_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.JSON.params.none_as_null"></span><strong>none_as_null</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.JSON.params.none_as_null">¶</a> – <p>if True, persist the value <code class="docutils literal notranslate"><span class="pre">None</span></code> as a
SQL NULL value, not the JSON encoding of <code class="docutils literal notranslate"><span class="pre">null</span></code>.   Note that
when this flag is False, the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal notranslate"><span class="pre">null()</span></code></a> construct can still
be used to persist a NULL value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">null</span>
<span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">null</span><span class="p">())</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 0.9.8: </span>- Added <code class="docutils literal notranslate"><span class="pre">none_as_null</span></code>, and <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.null" title="sqlalchemy.sql.expression.null"><code class="xref py py-func docutils literal notranslate"><span class="pre">null()</span></code></a>
is now supported in order to persist a NULL value.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON.NULL" title="sqlalchemy.types.JSON.NULL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">JSON.NULL</span></code></a></p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.JSON.params.astext_type"></span><strong>astext_type</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.JSON.params.astext_type">¶</a> – <p>the type to use for the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator.astext" title="sqlalchemy.dialects.postgresql.JSON.Comparator.astext"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Comparator.astext</span></code></a>
accessor on indexed attributes.  Defaults to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Text" title="sqlalchemy.types.Text"><code class="xref py py-class docutils literal notranslate"><span class="pre">Text</span></code></a>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSON.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSON.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSON.comparator_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON.Comparator" title="sqlalchemy.dialects.postgresql.json.JSON.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.JSON.Comparator</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">JSONB</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">none_as_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">astext_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL JSONB type.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> type stores arbitrary JSONB format data,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;data_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">JSONB</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">data_table</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;key2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
    <span class="p">)</span></pre></div>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a> type includes all operations provided by
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>, including the same behaviors for indexing
operations.
It also adds additional operators specific to JSONB, including
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_key()</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_all()</span></code></a>,
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.has_any()</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.contains"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contains()</span></code></a>,
and <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by" title="sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Comparator.contained_by()</span></code></a>.</p>
<p>Like the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type, the <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSONB</span></code></a>
type does not detect
in-place changes when used with the ORM, unless the
<a class="reference internal" href="../orm/extensions/mutable.html#module-sqlalchemy.ext.mutable" title="sqlalchemy.ext.mutable"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.ext.mutable</span></code></a> extension is used.</p>
<p>Custom serializers and deserializers
are shared with the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> class,
using the <code class="docutils literal notranslate"><span class="pre">json_serializer</span></code>
and <code class="docutils literal notranslate"><span class="pre">json_deserializer</span></code> keyword arguments.  These must be specified
at the dialect level using <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.  When using
psycopg2, the serializers are associated with the jsonb type using
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_jsonb</span></code> on a per-connection basis,
in the same way that <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_default_json</span></code> is used
to register these handlers with the json type.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.7.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB" title="sqlalchemy.dialects.postgresql.JSONB"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSON" title="sqlalchemy.dialects.postgresql.json.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.JSON</span></code></a>)</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">Comparator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="Permalink to this definition">¶</a></dt>
<dd><p>Define comparison operations for <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contained_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys are a proper subset of the
keys of the argument jsonb expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test if keys (or array) are a superset
of/contained the keys of the argument jsonb expression.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of all keys in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of any key in jsonb</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.Comparator.</span></code></a><span class="sig-name descname"><span class="pre">has_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator.has_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression.  Test for presence of a key.  Note that the
key may be a SQLA expression.</p>
</dd></dl>

</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.JSONB.comparator_factory">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.JSONB.</span></code></a><span class="sig-name descname"><span class="pre">comparator_factory</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.JSONB.comparator_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <a class="reference internal" href="#sqlalchemy.dialects.postgresql.JSONB.Comparator" title="sqlalchemy.dialects.postgresql.json.JSONB.Comparator"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.json.JSONB.Comparator</span></code></a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MACADDR">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MACADDR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MACADDR" title="Permalink to this definition">¶</a></dt>
<dd><div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MACADDR" title="sqlalchemy.dialects.postgresql.MACADDR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MACADDR</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.MONEY">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">MONEY</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.MONEY" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL MONEY type.</p>
<p>Depending on driver, result rows using this type may return a
string value which includes currency symbols.</p>
<p>For this reason, it may be preferable to provide conversion to a
numerically-based currency datatype using <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator" title="sqlalchemy.types.TypeDecorator"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeDecorator</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">TypeDecorator</span>

<span class="k">class</span> <span class="nc">NumericMoney</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">MONEY</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dialect</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># adjust this for the currency and numeric</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\$([\d.]+)&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span></pre></div>
</div>
<p>Alternatively, the conversion may be applied as a CAST using
the <a class="reference internal" href="../core/custom_types.html#sqlalchemy.types.TypeDecorator.column_expression" title="sqlalchemy.types.TypeDecorator.column_expression"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeDecorator.column_expression()</span></code></a> method as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">cast</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">TypeDecorator</span>

<span class="k">class</span> <span class="nc">NumericMoney</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">MONEY</span>

    <span class="k">def</span> <span class="nf">column_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">())</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.MONEY" title="sqlalchemy.dialects.postgresql.MONEY"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.MONEY</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.OID">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">OID</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.OID" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL OID type.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.5.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.OID" title="sqlalchemy.dialects.postgresql.OID"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.OID</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.REAL">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">REAL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.REAL" title="Permalink to this definition">¶</a></dt>
<dd><p>The SQL REAL type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REAL" title="sqlalchemy.dialects.postgresql.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REAL</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Float</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.REAL.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.REAL"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REAL.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precision</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">asdecimal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimal_return_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.REAL.__init__" title="Permalink to this definition">¶</a></dt>
<dd><div class="inherited-member docutils container">
<p><em>inherited from the</em> <code class="docutils literal notranslate"><span class="pre">sqlalchemy.types.Float.__init__</span></code> <em>method of</em> <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Float" title="sqlalchemy.types.Float"><code class="xref py py-class docutils literal notranslate"><span class="pre">Float</span></code></a></p>
</div>
<p>Construct a Float.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.precision"></span><strong>precision</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.precision">¶</a> – the numeric precision for use in DDL <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code>.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.asdecimal"></span><strong>asdecimal</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.asdecimal">¶</a> – the same flag as that of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Numeric" title="sqlalchemy.types.Numeric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Numeric</span></code></a>, but
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.   Note that setting this flag to <code class="docutils literal notranslate"><span class="pre">True</span></code>
results in floating point conversion.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.REAL.params.decimal_return_scale"></span><strong>decimal_return_scale</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.REAL.params.decimal_return_scale">¶</a> – <p>Default scale to use when converting
from floats to Python decimals.  Floating point values will typically
be much longer due to decimal inaccuracy, and most floating point
database types don’t have a notion of “scale”, so by default the
float type looks for the first ten decimal places when converting.
Specifying this value will override that length.  Note that the
MySQL float types, which do include “scale”, will use “scale”
as the default for decimal_return_scale, if not otherwise specified.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.0.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.REGCLASS">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">REGCLASS</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.REGCLASS" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the PostgreSQL REGCLASS type.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.2.7.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.REGCLASS" title="sqlalchemy.dialects.postgresql.REGCLASS"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.REGCLASS</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSVECTOR">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSVECTOR</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">TSVECTOR</span></code></a> type implements the PostgreSQL
text search type TSVECTOR.</p>
<p>It can be used to do full text queries on natural language
documents.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-match"><span class="std std-ref">Full Text Search</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSVECTOR" title="sqlalchemy.dialects.postgresql.TSVECTOR"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSVECTOR</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.UUID">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">UUID</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">as_uuid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.UUID" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL UUID type.</p>
<p>Represents the UUID column type, interpreting
data either as natively returned by the DBAPI
or as Python uuid objects.</p>
<p>The UUID type is currently known to work within the prominent DBAPI
drivers supported by SQLAlchemy including psycopg2, pg8000 and
asyncpg. Support for other DBAPI drivers may be incomplete or non-present.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.UUID" title="sqlalchemy.dialects.postgresql.UUID"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.UUID</span></code></a> (<a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.UUID.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.UUID"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.UUID.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">as_uuid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.UUID.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a UUID type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><span class="target" id="sqlalchemy.dialects.postgresql.UUID.params.as_uuid"></span><strong>as_uuid=False</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.UUID.params.as_uuid">¶</a> – if True, values will be interpreted
as Python uuid objects, converting to/from string via the
DBAPI.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<section id="range-types">
<h3>Range Types<a class="headerlink" href="#range-types" title="Permalink to this headline">¶</a></h3>
<p>The new range column types found in PostgreSQL 9.2 onwards are
catered for by the following types:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE"><span class="sig-name descname">DATERANGE</span></a></p></td>
<td><p>Represent the PostgreSQL DATERANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE"><span class="sig-name descname">INT4RANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT4RANGE type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE"><span class="sig-name descname">INT8RANGE</span></a></p></td>
<td><p>Represent the PostgreSQL INT8RANGE type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE"><span class="sig-name descname">NUMRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL NUMRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators"><span class="sig-name descname">RangeOperators</span></a></p></td>
<td><p>This mixin provides functionality for the Range Operators
listed in Table 9-44 of the <a class="reference external" href="https://www.postgresql.org/docs/devel/static/functions-range.html">PostgreSQL documentation</a> for Range
Functions and Operators. It is used by all the range types
provided in the <code class="docutils literal notranslate"><span class="pre">postgres</span></code> dialect and can likely be used for
any range types you create yourself.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE"><span class="sig-name descname">TSRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSRANGE type.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE"><span class="sig-name descname">TSTZRANGE</span></a></p></td>
<td><p>Represent the PostgreSQL TSTZRANGE type.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT4RANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT4RANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT4RANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT4RANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT4RANGE" title="sqlalchemy.dialects.postgresql.INT4RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT4RANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.INT8RANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">INT8RANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.INT8RANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL INT8RANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.INT8RANGE" title="sqlalchemy.dialects.postgresql.INT8RANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.INT8RANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.NUMRANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">NUMRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.NUMRANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL NUMRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.NUMRANGE" title="sqlalchemy.dialects.postgresql.NUMRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.NUMRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.DATERANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">DATERANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.DATERANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL DATERANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.DATERANGE" title="sqlalchemy.dialects.postgresql.DATERANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.DATERANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSRANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSRANGE" title="sqlalchemy.dialects.postgresql.TSRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.TSTZRANGE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">TSTZRANGE</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.TSTZRANGE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent the PostgreSQL TSTZRANGE type.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.TSTZRANGE" title="sqlalchemy.dialects.postgresql.TSTZRANGE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.TSTZRANGE</span></code></a> (<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators</span></code></a>, <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine" title="sqlalchemy.types.TypeEngine"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.TypeEngine</span></code></a>)</p>
</div>
</dd></dl>

<p>The types above get most of their functionality from the following
mixin:</p>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.ranges.</span></span><span class="sig-name descname"><span class="pre">RangeOperators</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin provides functionality for the Range Operators
listed in Table 9-44 of the <a class="reference external" href="https://www.postgresql.org/docs/devel/static/functions-range.html">PostgreSQL documentation</a> for Range
Functions and Operators. It is used by all the range types
provided in the <code class="docutils literal notranslate"><span class="pre">postgres</span></code> dialect and can likely be used for
any range types you create yourself.</p>
<p>No extra support is provided for the Range Functions listed in
Table 9-45 of the PostgreSQL documentation. For these, the normal
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.func" title="sqlalchemy.sql.expression.func"><code class="xref py py-func docutils literal notranslate"><span class="pre">func()</span></code></a> object should be used.</p>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory">
<em class="property"><span class="pre">class</span> </em><span class="sig-name descname"><span class="pre">comparator_factory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory" title="Permalink to this definition">¶</a></dt>
<dd><p>Define comparison operations for range types.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory" title="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory</span></code></a> (<code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Comparator</span></code>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.__ne__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">__ne__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.__ne__" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if two ranges are not equal</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.adjacent_to">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">adjacent_to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.adjacent_to" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
is adjacent to the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.contained_by">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">contained_by</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.contained_by" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is contained
within the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.contains">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">contains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the right hand operand,
which can be an element or a range, is contained within the
column.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.not_extend_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.not_extend_left_of" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
does not extend left of the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.not_extend_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">not_extend_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.not_extend_right_of" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the range in the column
does not extend right of the range in the operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.overlaps">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">overlaps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.overlaps" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column overlaps
(has points in common with) the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.strictly_left_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">strictly_left_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.strictly_left_of" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is strictly
left of the right hand operand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.strictly_right_of">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.</span></code></a><span class="sig-name descname"><span class="pre">strictly_right_of</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ranges.RangeOperators.comparator_factory.strictly_right_of" title="Permalink to this definition">¶</a></dt>
<dd><p>Boolean expression. Returns true if the column is strictly
right of the right hand operand.</p>
</dd></dl>

</dd></dl>

</dd></dl>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The range type DDL support should work with any PostgreSQL DBAPI
driver, however the data types returned may vary. If you are using
<code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, it’s recommended to upgrade to version 2.5 or later
before using these column types.</p>
</div>
<p>When instantiating models that use these column types, you should pass
whatever data type is expected by the DBAPI driver you’re using for
the column type. For <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> these are
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.NumericRange</span></code>,
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.DateRange</span></code>,
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.DateTimeRange</span></code> and
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.DateTimeTZRange</span></code> or the class you’ve
registered with <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.register_range</span></code>.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psycopg2.extras</span> <span class="kn">import</span> <span class="n">DateTimeRange</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">TSRANGE</span>

<span class="k">class</span> <span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;room_booking&#39;</span>

    <span class="n">room</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">())</span>

<span class="n">booking</span> <span class="o">=</span> <span class="n">RoomBooking</span><span class="p">(</span>
    <span class="n">room</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
    <span class="n">during</span><span class="o">=</span><span class="n">DateTimeRange</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">23</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
</section>
</section>
<section id="postgresql-constraint-types">
<h2>PostgreSQL Constraint Types<a class="headerlink" href="#postgresql-constraint-types" title="Permalink to this headline">¶</a></h2>
<p>SQLAlchemy supports PostgreSQL EXCLUDE constraints via the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> class:</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint"><span class="sig-name descname">ExcludeConstraint</span></a></p></td>
<td><p>A table-level EXCLUDE constraint.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ExcludeConstraint">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">ExcludeConstraint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">elements</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="Permalink to this definition">¶</a></dt>
<dd><p>A table-level EXCLUDE constraint.</p>
<p>Defines an EXCLUDE constraint as described in the <a class="reference external" href="https://www.postgresql.org/docs/9.0/static/sql-createtable.html#SQL-CREATETABLE-EXCLUDE">PostgreSQL
documentation</a>.</p>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint</span></code></a> (<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.ColumnCollectionConstraint" title="sqlalchemy.schema.ColumnCollectionConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.schema.ColumnCollectionConstraint</span></code></a>)</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.__init__">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.ExcludeConstraint.</span></code></a><span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">elements</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create an <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> object.</p>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="o">=</span> <span class="n">ExcludeConstraint</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">),</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">),</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span>
    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;some group&#39;</span><span class="p">),</span>
    <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="s1">&#39;my_operator_class&#39;</span><span class="p">}</span>
<span class="p">)</span></pre></div>
</div>
<p>The constraint is normally embedded into the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>
construct
directly, or added later using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.append_constraint" title="sqlalchemy.schema.Table.append_constraint"><code class="xref py py-meth docutils literal notranslate"><span class="pre">append_constraint()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="n">TSRANGE</span><span class="p">()),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">some_table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
    <span class="n">ExcludeConstraint</span><span class="p">(</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span>
        <span class="n">where</span><span class="o">=</span><span class="n">some_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">group</span> <span class="o">!=</span> <span class="s1">&#39;some group&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;some_table_excl_const&#39;</span><span class="p">,</span>
        <span class="n">ops</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="s1">&#39;my_operator_class&#39;</span><span class="p">}</span>
    <span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements"></span><strong>*elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.*elements">¶</a> – A sequence of two tuples of the form <code class="docutils literal notranslate"><span class="pre">(column,</span> <span class="pre">operator)</span></code> where
“column” is a SQL expression element or a raw SQL string, most
typically a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object,
and “operator” is a string
containing the operator to use.   In order to specify a column name
when a  <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object is not available,
while ensuring
that any necessary quoting rules take effect, an ad-hoc
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> or <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.column" title="sqlalchemy.sql.expression.column"><code class="xref py py-func docutils literal notranslate"><span class="pre">column()</span></code></a>
object should be
used.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name"></span><strong>name</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.name">¶</a> – Optional, the in-database name of this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable"></span><strong>deferrable</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.deferrable">¶</a> – Optional bool.  If set, emit DEFERRABLE or NOT DEFERRABLE when
issuing DDL for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially"></span><strong>initially</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.initially">¶</a> – Optional string.  If set, emit INITIALLY &lt;value&gt; when issuing DDL
for this constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using"></span><strong>using</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.using">¶</a> – Optional string.  If set, emit USING &lt;index_method&gt; when issuing DDL
for this constraint. Defaults to ‘gist’.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where">¶</a> – <p>Optional SQL expression construct or literal SQL string.
If set, emit WHERE &lt;predicate&gt; when issuing DDL
for this constraint.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.where" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">ExcludeConstraint.where</span></code></a> argument to <a class="reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint" title="sqlalchemy.dialects.postgresql.ExcludeConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExcludeConstraint</span></code></a> can be passed as a Python string argument, which will be treated as <strong>trusted SQL text</strong> and rendered as given.  <strong>DO NOT PASS UNTRUSTED INPUT TO THIS PARAMETER</strong>.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops"></span><strong>ops</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.ExcludeConstraint.params.ops">¶</a> – <p>Optional dictionary.  Used to define operator classes for the
elements; works the same way as that of the
<a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">postgresql_ops</span></a>
parameter specified to the <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.Index" title="sqlalchemy.schema.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> construct.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.21.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-operator-classes"><span class="std std-ref">Operator Classes</span></a> - general description of how
PostgreSQL operator classes are specified.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.postgresql</span> <span class="kn">import</span> <span class="n">ExcludeConstraint</span><span class="p">,</span> <span class="n">TSRANGE</span>

<span class="k">class</span> <span class="nc">RoomBooking</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;room_booking&#39;</span>

    <span class="n">room</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">during</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">TSRANGE</span><span class="p">())</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ExcludeConstraint</span><span class="p">((</span><span class="s1">&#39;room&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;during&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">)),</span>
    <span class="p">)</span></pre></div>
</div>
</section>
<section id="postgresql-dml-constructs">
<h2>PostgreSQL DML Constructs<a class="headerlink" href="#postgresql-dml-constructs" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert"><span class="sig-name descname">insert</span></a>(table[, values, inline, bind, ...], **dialect_kw)</p></td>
<td><p>Construct an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><span class="sig-name descname">Insert</span></a></p></td>
<td><p>PostgreSQL-specific implementation of INSERT.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.insert">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefixes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">dialect_kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object.</p>
<div class="inherited-member docutils container">
<p>This documentation is inherited from <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.insert()</span></code></a>; this constructor, <a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.insert()</span></code></a>,   creates a <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert</span></code></a> object.  See that class for additional details describing this subclass.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">insert</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">insert</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span><span class="o">.</span>
    <span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="o">=</span><span class="s1">&#39;Full Username&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Similar functionality is available via the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableClause.insert" title="sqlalchemy.sql.expression.TableClause.insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TableClause.insert()</span></code></a> method on
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/tutorial.html#coretutorial-insert-expressions"><span class="std std-ref">Insert Expressions</span></a> - in the
<a class="reference internal" href="../core/tutorial.html"><span class="std std-ref">1.x tutorial</span></a></p>
<p><a class="reference internal" href="../tutorial/data_insert.html#tutorial-core-insert"><span class="std std-ref">Inserting Rows with Core</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 1.4 / 2.0 Tutorial</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.insert.params.table"></span><strong>table</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.insert.params.table">¶</a> – <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableClause" title="sqlalchemy.sql.expression.TableClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableClause</span></code></a>
which is the subject of the
insert.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.insert.params.values"></span><strong>values</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.insert.params.values">¶</a> – <p>collection of values to be inserted; see
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a>
for a description of allowed formats here.
Can be omitted entirely; a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct
will also dynamically render the VALUES clause at execution time
based on the parameters passed to <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert.params.values" title="sqlalchemy.sql.expression.insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">insert.values</span></code></a> parameter will be removed in SQLAlchemy 2.0.  Please refer to the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.insert.params.inline"></span><strong>inline</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.insert.params.inline">¶</a> – <p>if True, no attempt will be made to retrieve the
SQL-generated default values to be provided within the statement;
in particular,
this allows SQL expressions to be rendered ‘inline’ within the
statement without the need to pre-execute them beforehand; for
backends that support “returning”, this turns off the “implicit
returning” feature for the statement.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert.params.inline" title="sqlalchemy.sql.expression.insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">insert.inline</span></code></a> parameter will be removed in SQLAlchemy 2.0.  Please use the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.inline" title="sqlalchemy.sql.expression.Insert.inline"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.inline()</span></code></a> method.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
<p>If both <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> and compile-time bind
parameters are present, the compile-time bind parameters override the
information specified within <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> on a
per-key basis.</p>
<p>The keys within <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> can be either
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects or their string
identifiers. Each key may reference one of:</p>
<ul class="simple">
<li><p>a literal data value (i.e. string, number, etc.);</p></li>
<li><p>a Column object;</p></li>
<li><p>a SELECT statement.</p></li>
</ul>
<p>If a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement is specified which references this
<code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement’s table, the statement will be correlated
against the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/tutorial.html#coretutorial-insert-expressions"><span class="std std-ref">Insert Expressions</span></a> - SQL Expression Tutorial</p>
<p><a class="reference internal" href="../core/tutorial.html#inserts-and-updates"><span class="std std-ref">Inserts, Updates and Deletes</span></a> - SQL Expression Tutorial</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.postgresql.</span></span><span class="sig-name descname"><span class="pre">Insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefixes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">dialect_kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert" title="Permalink to this definition">¶</a></dt>
<dd><p>PostgreSQL-specific implementation of INSERT.</p>
<p>Adds methods for PG-specific syntaxes such as ON CONFLICT.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object is created using the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.insert" title="sqlalchemy.dialects.postgresql.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.insert()</span></code></a> function.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert" title="sqlalchemy.dialects.postgresql.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert</span></code></a> (<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.Insert</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.excluded">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">excluded</span></span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the <code class="docutils literal notranslate"><span class="pre">excluded</span></code> namespace for an ON CONFLICT statement</p>
<p>PG’s ON CONFLICT clause allows reference to the row that would
be inserted, known as <code class="docutils literal notranslate"><span class="pre">excluded</span></code>.  This attribute provides
all columns in this row to be referenceable.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.excluded" title="sqlalchemy.dialects.postgresql.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> attribute is an
instance of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>, which provides
an interface the same as that of the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.c" title="sqlalchemy.schema.Table.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.c</span></code></a>
collection described at <a class="reference internal" href="../core/metadata.html#metadata-tables-and-columns"><span class="std std-ref">Accessing Tables and Columns</span></a>.
With this collection, ordinary names are accessible like attributes
(e.g. <code class="docutils literal notranslate"><span class="pre">stmt.excluded.some_column</span></code>), but special names and
dictionary method names should be accessed using indexed access,
such as <code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;column</span> <span class="pre">name&quot;]</span></code> or
<code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;values&quot;]</span></code>.   See the docstring for
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> for further examples.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a> - example of how
to use <code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_nothing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a DO NOTHING action for ON CONFLICT clause.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">constraint</span></code> and <code class="docutils literal notranslate"><span class="pre">index_elements</span></code> arguments
are optional, but only one of these can be specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.constraint"></span><strong>constraint</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.constraint">¶</a> – The name of a unique or exclusion constraint on the table,
or the constraint object itself if it has a .name attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_nothing.params.index_where">¶</a> – <p>Additional WHERE criterion that can be used to infer a
conditional target index.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">constraint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a DO UPDATE SET action for ON CONFLICT clause.</p>
<p>Either the <code class="docutils literal notranslate"><span class="pre">constraint</span></code> or <code class="docutils literal notranslate"><span class="pre">index_elements</span></code> argument is
required, but only one of these can be specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint"></span><strong>constraint</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.constraint">¶</a> – The name of a unique or exclusion constraint on the table,
or the constraint object itself if it has a .name attribute.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.index_where">¶</a> – Additional WHERE criterion that can be used to infer a
conditional target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_"></span><strong>set_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_">¶</a> – <p>A dictionary or other mapping object
where the keys are either names of columns in the target table,
or <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects or other ORM-mapped columns
matching that of the target table, and expressions or literals
as values, specifying the <code class="docutils literal notranslate"><span class="pre">SET</span></code> actions to take.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>The
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a>
parameter supports <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects from the target
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as keys.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This dictionary does <strong>not</strong> take into account
Python-specified default UPDATE values or generation functions,
e.g. those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>.
These values will not be exercised for an ON CONFLICT style of
UPDATE, unless they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.postgresql.Insert.on_conflict_do_update.params.where">¶</a> – <p>Optional argument. If present, can be a literal SQL
string or an acceptable expression for a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause
that restricts the rows affected by <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">UPDATE</span> <span class="pre">SET</span></code>. Rows
not meeting the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition will not be updated
(effectively a <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> for those rows).</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.1.</span></p>
</div>
</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-insert-on-conflict"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a></p>
</div>
</dd></dl>

</dd></dl>

</section>
<section id="module-sqlalchemy.dialects.postgresql.psycopg2">
<span id="psycopg2"></span><span id="postgresql-psycopg2"></span><h2>psycopg2<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.psycopg2" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the psycopg2 driver.</p>
<section id="dialect-postgresql-psycopg2-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-psycopg2-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for psycopg2 is available at:
<a class="reference external" href="https://pypi.org/project/psycopg2/">https://pypi.org/project/psycopg2/</a></p>
</section>
<section id="dialect-postgresql-psycopg2-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-psycopg2-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+psycopg2://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<section id="psycopg2-connect-arguments">
<h3>psycopg2 Connect Arguments<a class="headerlink" href="#psycopg2-connect-arguments" title="Permalink to this headline">¶</a></h3>
<p>Keyword arguments that are specific to the SQLAlchemy psycopg2 dialect
may be passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>, and include the following:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">isolation_level</span></code>: This option, available for all PostgreSQL dialects,
includes the <code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code> isolation level when using the psycopg2
dialect.   This option sets the <strong>default</strong> isolation level for the
connection that is set immediately upon connection to the database before
the connection is pooled.  This option is generally superseded by the more
modern <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a>
execution option, detailed at <a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">Setting Transaction Isolation Levels including DBAPI Autocommit</span></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">Setting Transaction Isolation Levels including DBAPI Autocommit</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">client_encoding</span></code>: sets the client encoding in a libpq-agnostic way,
using psycopg2’s <code class="docutils literal notranslate"><span class="pre">set_client_encoding()</span></code> method.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#psycopg2-unicode"><span class="std std-ref">Unicode with Psycopg2</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_native_unicode</span></code>: Under Python 2 only, this can be set to False to
disable the use of psycopg2’s native Unicode support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#psycopg2-disable-native-unicode"><span class="std std-ref">Disabling Native Unicode</span></a></p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code>, <code class="docutils literal notranslate"><span class="pre">executemany_batch_page_size</span></code>,
<code class="docutils literal notranslate"><span class="pre">executemany_values_page_size</span></code>: Allows use of psycopg2
extensions for optimizing “executemany”-stye queries.  See the referenced
section below for details.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#psycopg2-executemany-mode"><span class="std std-ref">Psycopg2 Fast Execution Helpers</span></a></p>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The above keyword arguments are <strong>dialect</strong> keyword arguments, meaning
that they are passed as explicit keyword arguments to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
    <span class="n">isolation_level</span><span class="o">=</span><span class="s2">&quot;SERIALIZABLE&quot;</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>These should not be confused with <strong>DBAPI</strong> connect arguments, which
are passed as part of the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a>
dictionary and/or are passed in the URL query string, as detailed in
the section <a class="reference internal" href="../core/engines.html#custom-dbapi-args"><span class="std std-ref">Custom DBAPI connect() arguments / on-connect routines</span></a>.</p>
</div>
</section>
<section id="ssl-connections">
<span id="psycopg2-ssl"></span><h3>SSL Connections<a class="headerlink" href="#ssl-connections" title="Permalink to this headline">¶</a></h3>
<p>The psycopg2 module has a connection argument named <code class="docutils literal notranslate"><span class="pre">sslmode</span></code> for
controlling its behavior regarding secure (SSL) connections. The default is
<code class="docutils literal notranslate"><span class="pre">sslmode=prefer</span></code>; it will attempt an SSL connection and if that fails it
will fall back to an unencrypted connection. <code class="docutils literal notranslate"><span class="pre">sslmode=require</span></code> may be used
to ensure that only secure connections are established.  Consult the
psycopg2 / libpq documentation for further options that are available.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">sslmode</span></code> is specific to psycopg2 so it is included in the
connection URI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@192.168.0.199:5432/test?sslmode=require&quot;</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="unix-domain-connections">
<h3>Unix Domain Connections<a class="headerlink" href="#unix-domain-connections" title="Permalink to this headline">¶</a></h3>
<p>psycopg2 supports connecting via Unix domain connections.   When the <code class="docutils literal notranslate"><span class="pre">host</span></code>
portion of the URL is omitted, SQLAlchemy passes <code class="docutils literal notranslate"><span class="pre">None</span></code> to psycopg2,
which specifies Unix-domain communication rather than TCP/IP communication:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://user:password@/dbname&quot;</span><span class="p">)</span></pre></div>
</div>
<p>By default, the socket file used is to connect to a Unix-domain socket
in <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>, or whatever socket directory was specified when PostgreSQL
was built.  This value can be overridden by passing a pathname to psycopg2,
using <code class="docutils literal notranslate"><span class="pre">host</span></code> as an additional keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=/var/lib/postgresql&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/9.1/static/libpq-connect.html#LIBPQ-PQCONNECTDBPARAMS">PQconnectdbParams </a></p>
</div>
</section>
<section id="specifying-multiple-fallback-hosts">
<span id="psycopg2-multi-host"></span><h3>Specifying multiple fallback hosts<a class="headerlink" href="#specifying-multiple-fallback-hosts" title="Permalink to this headline">¶</a></h3>
<p>psycopg2 supports multiple connection points in the connection string.
When the <code class="docutils literal notranslate"><span class="pre">host</span></code> parameter is used multiple times in the query section of
the URL, SQLAlchemy will create a single string of the host and port
information provided to make the connections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:password@/dbname?host=HostA:port1&amp;host=HostB&amp;host=HostC&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>A connection to each host is then attempted until either a connection is successful
or all connections are unsuccessful in which case an error is raised.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.20: </span>Support for multiple hosts in PostgreSQL connection
string.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/10/libpq-connect.html#LIBPQ-CONNSTRING">PQConnString </a></p>
</div>
</section>
<section id="empty-dsn-connections-environment-variable-connections">
<h3>Empty DSN Connections / Environment Variable Connections<a class="headerlink" href="#empty-dsn-connections-environment-variable-connections" title="Permalink to this headline">¶</a></h3>
<p>The psycopg2 DBAPI can connect to PostgreSQL by passing an empty DSN to the
libpq client library, which by default indicates to connect to a localhost
PostgreSQL database that is open for “trust” connections.  This behavior can be
further tailored using a particular set of environment variables which are
prefixed with <code class="docutils literal notranslate"><span class="pre">PG_...</span></code>, which are  consumed by <code class="docutils literal notranslate"><span class="pre">libpq</span></code> to take the place of
any or all elements of the connection string.</p>
<p>For this form, the URL can be passed without any elements other than the
initial scheme:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;postgresql+psycopg2://&#39;</span><span class="p">)</span></pre></div>
</div>
<p>In the above form, a blank “dsn” string is passed to the <code class="docutils literal notranslate"><span class="pre">psycopg2.connect()</span></code>
function which in turn represents an empty DSN passed to libpq.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.2: </span>support for parameter-less connections with psycopg2.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.postgresql.org/docs/current/libpq-envars.html">Environment Variables</a> -
PostgreSQL documentation on how to use <code class="docutils literal notranslate"><span class="pre">PG_...</span></code>
environment variables for connections.</p>
</div>
</section>
<section id="per-statement-connection-execution-options">
<span id="psycopg2-execution-options"></span><h3>Per-Statement/Connection Execution Options<a class="headerlink" href="#per-statement-connection-execution-options" title="Permalink to this headline">¶</a></h3>
<p>The following DBAPI-specific options are respected when used with
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>,
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.Executable.execution_options" title="sqlalchemy.sql.expression.Executable.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Executable.execution_options()</span></code></a>,
<a class="reference internal" href="../orm/query.html#sqlalchemy.orm.Query.execution_options" title="sqlalchemy.orm.Query.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Query.execution_options()</span></code></a>,
in addition to those not specific to DBAPIs:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> - Set the transaction isolation level for the lifespan
of a <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> (can only be set on a connection,
not a statement
or query).   See <a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stream_results</span></code> - Enable or disable usage of psycopg2 server side
cursors - this feature makes use of “named” cursors in combination with
special result handling methods so that result rows are not fully buffered.
Defaults to False, meaning cursors are buffered by default.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_row_buffer</span></code> - when using <code class="docutils literal notranslate"><span class="pre">stream_results</span></code>, an integer value that
specifies the maximum number of rows to buffer at a time.  This is
interpreted by the <code class="xref py py-class docutils literal notranslate"><span class="pre">BufferedRowCursorResult</span></code>, and if omitted the
buffer will grow to ultimately store 1000 rows at a time.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The <code class="docutils literal notranslate"><span class="pre">max_row_buffer</span></code> size can now be greater than
1000, and the buffer will grow to that size.</p>
</div>
</li>
</ul>
</section>
<section id="psycopg2-fast-execution-helpers">
<span id="psycopg2-executemany-mode"></span><span id="psycopg2-batch-mode"></span><h3>Psycopg2 Fast Execution Helpers<a class="headerlink" href="#psycopg2-fast-execution-helpers" title="Permalink to this headline">¶</a></h3>
<p>Modern versions of psycopg2 include a feature known as
<a class="reference external" href="https://initd.org/psycopg/docs/extras.html#fast-execution-helpers">Fast Execution Helpers </a>, which
have been shown in benchmarking to improve psycopg2’s executemany()
performance, primarily with INSERT statements, by multiple orders of magnitude.
SQLAlchemy internally makes use of these extensions for <code class="docutils literal notranslate"><span class="pre">executemany()</span></code> style
calls, which correspond to lists of parameters being passed to
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a> as detailed in <a class="reference internal" href="../core/tutorial.html#execute-multiple"><span class="std std-ref">multiple parameter
sets</span></a>.   The ORM also uses this mode internally whenever
possible.</p>
<p>The two available extensions on the psycopg2 side are the <code class="docutils literal notranslate"><span class="pre">execute_values()</span></code>
and <code class="docutils literal notranslate"><span class="pre">execute_batch()</span></code> functions.  The psycopg2 dialect defaults to using the
<code class="docutils literal notranslate"><span class="pre">execute_values()</span></code> extension for all qualifying INSERT statements.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The psycopg2 dialect now defaults to a new mode
<code class="docutils literal notranslate"><span class="pre">&quot;values_only&quot;</span></code> for <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code>, which allows an order of
magnitude performance improvement for INSERT statements, but does not
include “batch” mode for UPDATE and DELETE statements which removes the
ability of <code class="docutils literal notranslate"><span class="pre">cursor.rowcount</span></code> to function correctly.</p>
</div>
<p>The use of these extensions is controlled by the <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code> flag
which may be passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">executemany_mode</span><span class="o">=</span><span class="s1">&#39;values_plus_batch&#39;</span><span class="p">)</span></pre></div>
</div>
<p>Possible options for <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code> include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">values_only</span></code> - this is the default value.  the psycopg2 execute_values()
extension is used for qualifying INSERT statements, which rewrites the INSERT
to include multiple VALUES clauses so that many parameter sets can be
inserted with one statement.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>Added <code class="docutils literal notranslate"><span class="pre">&quot;values_only&quot;</span></code> setting for <code class="docutils literal notranslate"><span class="pre">executemany_mode</span></code>
which is also now the default.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code> - No psycopg2 extensions are not used, and the usual
<code class="docutils literal notranslate"><span class="pre">cursor.executemany()</span></code> method is used when invoking statements with
multiple parameter sets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'batch'</span></code> - Uses <code class="docutils literal notranslate"><span class="pre">psycopg2.extras.execute_batch</span></code> for all qualifying
INSERT, UPDATE and DELETE statements, so that multiple copies
of a SQL query, each one corresponding to a parameter set passed to
<code class="docutils literal notranslate"><span class="pre">executemany()</span></code>, are joined into a single SQL string separated by a
semicolon.  When using this mode, the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>
attribute will not contain a value for executemany-style executions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'values_plus_batch'</span></code>- <code class="docutils literal notranslate"><span class="pre">execute_values</span></code> is used for qualifying INSERT
statements, <code class="docutils literal notranslate"><span class="pre">execute_batch</span></code> is used for UPDATE and DELETE.
When using this mode, the <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.rowcount" title="sqlalchemy.engine.CursorResult.rowcount"><code class="xref py py-attr docutils literal notranslate"><span class="pre">CursorResult.rowcount</span></code></a>
attribute will not contain a value for executemany-style executions against
UPDATE and DELETE statements.</p></li>
</ul>
<p>By “qualifying statements”, we mean that the statement being executed
must be a Core <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a>, <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.update" title="sqlalchemy.sql.expression.update"><code class="xref py py-func docutils literal notranslate"><span class="pre">update()</span></code></a>
or <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.delete" title="sqlalchemy.sql.expression.delete"><code class="xref py py-func docutils literal notranslate"><span class="pre">delete()</span></code></a> construct, and not a plain textual SQL
string or one constructed using <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.text" title="sqlalchemy.sql.expression.text"><code class="xref py py-func docutils literal notranslate"><span class="pre">text()</span></code></a>.  When using the
ORM, all insert/update/delete statements used by the ORM flush process
are qualifying.</p>
<p>The “page size” for the “values” and “batch” strategies can be affected
by using the <code class="docutils literal notranslate"><span class="pre">executemany_batch_page_size</span></code> and
<code class="docutils literal notranslate"><span class="pre">executemany_values_page_size</span></code> engine parameters.  These
control how many parameter sets
should be represented in each execution.    The “values” page size defaults
to 1000, which is different that psycopg2’s default.  The “batch” page
size defaults to 100.  These can be affected by passing new values to
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://scott:tiger@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">executemany_mode</span><span class="o">=</span><span class="s1">&#39;values&#39;</span><span class="p">,</span>
    <span class="n">executemany_values_page_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">executemany_batch_page_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The default for <code class="docutils literal notranslate"><span class="pre">executemany_values_page_size</span></code> is now 1000, up from
100.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/tutorial.html#execute-multiple"><span class="std std-ref">Executing Multiple Statements</span></a> - General information on using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a>
object to execute statements in such a way as to make
use of the DBAPI <code class="docutils literal notranslate"><span class="pre">.executemany()</span></code> method.</p>
</div>
</section>
<section id="unicode-with-psycopg2">
<span id="psycopg2-unicode"></span><h3>Unicode with Psycopg2<a class="headerlink" href="#unicode-with-psycopg2" title="Permalink to this headline">¶</a></h3>
<p>The psycopg2 DBAPI driver supports Unicode data transparently.   Under Python 2
only, the SQLAlchemy psycopg2 dialect will enable the
<code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.UNICODE</span></code> extension by default to ensure Unicode is
handled properly; under Python 3, this is psycopg2’s default behavior.</p>
<p>The client character encoding can be controlled for the psycopg2 dialect
in the following ways:</p>
<ul>
<li><p>For PostgreSQL 9.1 and above, the <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter may be
passed in the database URL; this parameter is consumed by the underlying
<code class="docutils literal notranslate"><span class="pre">libpq</span></code> PostgreSQL client library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname?client_encoding=utf8&quot;</span><span class="p">)</span></pre></div>
</div>
<p>Alternatively, the above <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> value may be passed using
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> for programmatic establishment with
<code class="docutils literal notranslate"><span class="pre">libpq</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;client_encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;utf8&#39;</span><span class="p">}</span>
<span class="p">)</span></pre></div>
</div>
</li>
<li><p>For all PostgreSQL versions, psycopg2 supports a client-side encoding
value that will be passed to database connections when they are first
established.  The SQLAlchemy psycopg2 dialect supports this using the
<code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+psycopg2://user:pass@host/dbname&quot;</span><span class="p">,</span>
    <span class="n">client_encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The above <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter admittedly is very similar
in appearance to usage of the parameter within the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary; the difference
above is that the parameter is consumed by psycopg2 and is
passed to the database connection using <code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">client_encoding</span> <span class="pre">TO</span>
<span class="pre">'utf8'</span></code>; in the previously mentioned style, the parameter is instead
passed through psycopg2 and consumed by the <code class="docutils literal notranslate"><span class="pre">libpq</span></code> library.</p>
</div>
</li>
<li><p>A common way to set up client encoding with PostgreSQL databases is to
ensure it is configured within the server-side postgresql.conf file;
this is the recommended way to set encoding for a server that is
consistently of one encoding in all databases:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># postgresql.conf file</span>

<span class="c1"># client_encoding = sql_ascii # actually, defaults to database</span>
                             <span class="c1"># encoding</span>
<span class="n">client_encoding</span> <span class="o">=</span> <span class="n">utf8</span></pre></div>
</div>
</li>
</ul>
<section id="disabling-native-unicode">
<span id="psycopg2-disable-native-unicode"></span><h4>Disabling Native Unicode<a class="headerlink" href="#disabling-native-unicode" title="Permalink to this headline">¶</a></h4>
<p>Under Python 2 only, SQLAlchemy can also be instructed to skip the usage of the
psycopg2 <code class="docutils literal notranslate"><span class="pre">UNICODE</span></code> extension and to instead utilize its own unicode
encode/decode services, which are normally reserved only for those DBAPIs that
don’t fully support unicode directly.  Passing <code class="docutils literal notranslate"><span class="pre">use_native_unicode=False</span></code> to
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> will disable usage of <code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.</span>
<span class="pre">UNICODE</span></code>. SQLAlchemy will instead encode data itself into Python bytestrings
on the way in and coerce from bytes on the way back, using the value of the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> <code class="docutils literal notranslate"><span class="pre">encoding</span></code> parameter, which defaults to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>.
SQLAlchemy’s own unicode encode/decode functionality is steadily becoming
obsolete as most DBAPIs now support unicode fully.</p>
</section>
</section>
<section id="transactions">
<h3>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h3>
<p>The psycopg2 dialect fully supports SAVEPOINT and two-phase commit operations.</p>
</section>
<section id="psycopg2-transaction-isolation-level">
<span id="psycopg2-isolation-level"></span><h3>Psycopg2 Transaction Isolation Level<a class="headerlink" href="#psycopg2-transaction-isolation-level" title="Permalink to this headline">¶</a></h3>
<p>As discussed in <a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a>,
all PostgreSQL dialects support setting of transaction isolation level
both via the <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> parameter passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>
,
as well as the <code class="docutils literal notranslate"><span class="pre">isolation_level</span></code> argument used by
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execution_options()</span></code></a>.  When using the psycopg2 dialect
, these
options make use of psycopg2’s <code class="docutils literal notranslate"><span class="pre">set_isolation_level()</span></code> connection method,
rather than emitting a PostgreSQL directive; this is because psycopg2’s
API-level setting is always emitted at the start of each transaction in any
case.</p>
<p>The psycopg2 dialect supports these constants for isolation level:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#pg8000-isolation-level"><span class="std std-ref">pg8000 Transaction Isolation Level</span></a></p>
</div>
</section>
<section id="notice-logging">
<h3>NOTICE logging<a class="headerlink" href="#notice-logging" title="Permalink to this headline">¶</a></h3>
<p>The psycopg2 dialect will log PostgreSQL NOTICE messages
via the <code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql</span></code> logger.  When this logger
is set to the <code class="docutils literal notranslate"><span class="pre">logging.INFO</span></code> level, notice messages will be logged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sqlalchemy.dialects.postgresql&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span></pre></div>
</div>
<p>Above, it is assumed that logging is configured externally.  If this is not
the case, configuration such as <code class="docutils literal notranslate"><span class="pre">logging.basicConfig()</span></code> must be utilized:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>   <span class="c1"># log messages to stdout</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sqlalchemy.dialects.postgresql&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.python.org/3/howto/logging.html">Logging HOWTO</a> - on the python.org website</p>
</div>
</section>
<section id="psycopg2-hstore">
<span id="id5"></span><h3>HSTORE type<a class="headerlink" href="#psycopg2-hstore" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code> DBAPI includes an extension to natively handle marshalling of
the HSTORE type.   The SQLAlchemy psycopg2 dialect will enable this extension
by default when psycopg2 version 2.4 or greater is used, and
it is detected that the target database has the HSTORE type set up for use.
In other words, when the dialect makes the first
connection, a sequence like the following is performed:</p>
<ol class="arabic simple">
<li><p>Request the available HSTORE oids using
<code class="docutils literal notranslate"><span class="pre">psycopg2.extras.HstoreAdapter.get_oids()</span></code>.
If this function returns a list of HSTORE identifiers, we then determine
that the <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> extension is present.
This function is <strong>skipped</strong> if the version of psycopg2 installed is
less than version 2.4.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">use_native_hstore</span></code> flag is at its default of <code class="docutils literal notranslate"><span class="pre">True</span></code>, and
we’ve detected that <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> oids are available, the
<code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.register_hstore()</span></code> extension is invoked for all
connections.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">register_hstore()</span></code> extension has the effect of <strong>all Python
dictionaries being accepted as parameters regardless of the type of target
column in SQL</strong>. The dictionaries are converted by this extension into a
textual HSTORE expression.  If this behavior is not desired, disable the
use of the hstore extension by setting <code class="docutils literal notranslate"><span class="pre">use_native_hstore</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+psycopg2://scott:tiger@localhost/test&quot;</span><span class="p">,</span>
            <span class="n">use_native_hstore</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">HSTORE</span></code> type is <strong>still supported</strong> when the
<code class="docutils literal notranslate"><span class="pre">psycopg2.extensions.register_hstore()</span></code> extension is not used.  It merely
means that the coercion between Python dictionaries and the HSTORE
string format, on both the parameter side and the result side, will take
place within SQLAlchemy’s own marshalling logic, and not that of <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>
which may be more performant.</p>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.pg8000">
<span id="pg8000"></span><h2>pg8000<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.pg8000" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the pg8000 driver.</p>
<section id="dialect-postgresql-pg8000-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-pg8000-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pg8000 is available at:
<a class="reference external" href="https://pypi.org/project/pg8000/">https://pypi.org/project/pg8000/</a></p>
</section>
<section id="dialect-postgresql-pg8000-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-pg8000-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+pg8000://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4: </span>The pg8000 dialect has been updated for version
1.16.6 and higher, and is again part of SQLAlchemy’s continuous integration
with full feature support.</p>
</div>
<section id="unicode">
<span id="pg8000-unicode"></span><h3>Unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h3>
<p>pg8000 will encode / decode string values between it and the server using the
PostgreSQL <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter; by default this is the value in
the <code class="docutils literal notranslate"><span class="pre">postgresql.conf</span></code> file, which often defaults to <code class="docutils literal notranslate"><span class="pre">SQL_ASCII</span></code>.
Typically, this can be changed to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>, as a more useful default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#client_encoding = sql_ascii # actually, defaults to database</span>
                             <span class="c1"># encoding</span>
<span class="n">client_encoding</span> <span class="o">=</span> <span class="n">utf8</span></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> can be overridden for a session by executing the SQL:</p>
<p>SET CLIENT_ENCODING TO ‘utf8’;</p>
<p>SQLAlchemy will execute this SQL on all new connections based on the value
passed to <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> using the <code class="docutils literal notranslate"><span class="pre">client_encoding</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://user:pass@host/dbname&quot;</span><span class="p">,</span> <span class="n">client_encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="pg8000-ssl">
<span id="id6"></span><h3>SSL Connections<a class="headerlink" href="#pg8000-ssl" title="Permalink to this headline">¶</a></h3>
<p>pg8000 accepts a Python <code class="docutils literal notranslate"><span class="pre">SSLContext</span></code> object which may be specified using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@192.168.0.199/test&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ssl_context&quot;</span><span class="p">:</span> <span class="n">ssl_context</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
<p>If the server uses an automatically-generated certificate that is self-signed
or does not match the host name (as seen from the client), it may also be
necessary to disable hostname checking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
<span class="n">ssl_context</span><span class="o">.</span><span class="n">check_hostname</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">ssl_context</span><span class="o">.</span><span class="n">verify_mode</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">CERT_NONE</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;postgresql+pg8000://scott:tiger@192.168.0.199/test&quot;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ssl_context&quot;</span><span class="p">:</span> <span class="n">ssl_context</span><span class="p">},</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="pg8000-transaction-isolation-level">
<span id="pg8000-isolation-level"></span><h3>pg8000 Transaction Isolation Level<a class="headerlink" href="#pg8000-transaction-isolation-level" title="Permalink to this headline">¶</a></h3>
<p>The pg8000 dialect offers the same isolation level settings as that
of the <a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">psycopg2</span></a> dialect:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">COMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEATABLE</span> <span class="pre">READ</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AUTOCOMMIT</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#postgresql-isolation-level"><span class="std std-ref">Transaction Isolation Level</span></a></p>
<p><a class="reference internal" href="#psycopg2-isolation-level"><span class="std std-ref">Psycopg2 Transaction Isolation Level</span></a></p>
</div>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.asyncpg">
<span id="asyncpg"></span><span id="dialect-postgresql-asyncpg"></span><h2>asyncpg<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.asyncpg" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the asyncpg driver.</p>
<section id="dialect-postgresql-asyncpg-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-asyncpg-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for asyncpg is available at:
<a class="reference external" href="https://magicstack.github.io/asyncpg/">https://magicstack.github.io/asyncpg/</a></p>
</section>
<section id="dialect-postgresql-asyncpg-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-asyncpg-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+asyncpg://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<p>The asyncpg dialect is SQLAlchemy’s first Python asyncio dialect.</p>
<p>Using a special asyncio mediation layer, the asyncpg dialect is usable
as the backend for the <a class="reference internal" href="../orm/extensions/asyncio.html"><span class="std std-ref">SQLAlchemy asyncio</span></a>
extension package.</p>
<p>This dialect should normally be used only with the
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> engine creation function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">create_async_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The dialect can also be run as a “synchronous” dialect within the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> function, which will pass “await” calls into
an ad-hoc event loop.  This mode of operation is of <strong>limited use</strong>
and is for special testing scenarios only.  The mode can be enabled by
adding the SQLAlchemy-specific flag <code class="docutils literal notranslate"><span class="pre">async_fallback</span></code> to the URL
in conjunction with <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># for testing purposes only; do not use in production!</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname?async_fallback=true&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default asyncpg does not decode the <code class="docutils literal notranslate"><span class="pre">json</span></code> and <code class="docutils literal notranslate"><span class="pre">jsonb</span></code> types and
returns them as strings. SQLAlchemy sets default type decoder for <code class="docutils literal notranslate"><span class="pre">json</span></code>
and <code class="docutils literal notranslate"><span class="pre">jsonb</span></code> types using the python builtin <code class="docutils literal notranslate"><span class="pre">json.loads</span></code> function.
The json implementation used can be changed by setting the attribute
<code class="docutils literal notranslate"><span class="pre">json_deserializer</span></code> when creating the engine with
<code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code>.</p>
</div>
<section id="prepared-statement-cache">
<span id="asyncpg-prepared-statement-cache"></span><h3>Prepared Statement Cache<a class="headerlink" href="#prepared-statement-cache" title="Permalink to this headline">¶</a></h3>
<p>The asyncpg SQLAlchemy dialect makes use of <code class="docutils literal notranslate"><span class="pre">asyncpg.connection.prepare()</span></code>
for all statements.   The prepared statement objects are cached after
construction which appears to grant a 10% or more performance improvement for
statement invocation.   The cache is on a per-DBAPI connection basis, which
means that the primary storage for prepared statements is within DBAPI
connections pooled within the connection pool.   The size of this cache
defaults to 100 statements per DBAPI connection and may be adjusted using the
<code class="docutils literal notranslate"><span class="pre">prepared_statement_cache_size</span></code> DBAPI argument (note that while this argument
is implemented by SQLAlchemy, it is part of the DBAPI emulation portion of the
asyncpg dialect, therefore is handled as a DBAPI argument, not a dialect
argument):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname?prepared_statement_cache_size=500&quot;</span><span class="p">)</span></pre></div>
</div>
<p>To disable the prepared statement cache, use a value of zero:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;postgresql+asyncpg://user:pass@hostname/dbname?prepared_statement_cache_size=0&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.0b2: </span>Added <code class="docutils literal notranslate"><span class="pre">prepared_statement_cache_size</span></code> for asyncpg.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">asyncpg</span></code> database driver necessarily uses caches for
PostgreSQL type OIDs, which become stale when custom PostgreSQL datatypes
such as <code class="docutils literal notranslate"><span class="pre">ENUM</span></code> objects are changed via DDL operations.   Additionally,
prepared statements themselves which are optionally cached by SQLAlchemy’s
driver as described above may also become “stale” when DDL has been emitted
to the PostgreSQL database which modifies the tables or other objects
involved in a particular prepared statement.</p>
<p>The SQLAlchemy asyncpg dialect will invalidate these caches within its local
process when statements that represent DDL are emitted on a local
connection, but this is only controllable within a single Python process /
database engine.     If DDL changes are made from other database engines
and/or processes, a running application may encounter asyncpg exceptions
<code class="docutils literal notranslate"><span class="pre">InvalidCachedStatementError</span></code> and/or <code class="docutils literal notranslate"><span class="pre">InternalServerError(&quot;cache</span> <span class="pre">lookup</span>
<span class="pre">failed</span> <span class="pre">for</span> <span class="pre">type</span> <span class="pre">&lt;oid&gt;&quot;)</span></code> if it refers to pooled database connections which
operated upon the previous structures. The SQLAlchemy asyncpg dialect will
recover from these error cases when the driver raises these exceptions by
clearing its internal caches as well as those of the asyncpg driver in
response to them, but cannot prevent them from being raised in the first
place if the cached prepared statement or asyncpg type caches have gone
stale, nor can it retry the statement as the PostgreSQL transaction is
invalidated when these errors occur.</p>
</div>
</section>
</section>
<section id="module-sqlalchemy.dialects.postgresql.psycopg2cffi">
<span id="psycopg2cffi"></span><h2>psycopg2cffi<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.psycopg2cffi" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the psycopg2cffi driver.</p>
<section id="dialect-postgresql-psycopg2cffi-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-psycopg2cffi-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for psycopg2cffi is available at:
<a class="reference external" href="https://pypi.org/project/psycopg2cffi/">https://pypi.org/project/psycopg2cffi/</a></p>
</section>
<section id="dialect-postgresql-psycopg2cffi-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-psycopg2cffi-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+psycopg2cffi://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<p><code class="docutils literal notranslate"><span class="pre">psycopg2cffi</span></code> is an adaptation of <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>, using CFFI for the C
layer. This makes it suitable for use in e.g. PyPy. Documentation
is as per <code class="docutils literal notranslate"><span class="pre">psycopg2</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.0.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#module-sqlalchemy.dialects.postgresql.psycopg2" title="sqlalchemy.dialects.postgresql.psycopg2"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.dialects.postgresql.psycopg2</span></code></a></p>
</div>
</section>
<section id="module-sqlalchemy.dialects.postgresql.pypostgresql">
<span id="py-postgresql"></span><h2>py-postgresql<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.pypostgresql" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the py-postgresql driver.</p>
<section id="dialect-postgresql-pypostgresql-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-pypostgresql-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for py-postgresql is available at:
<a class="reference external" href="https://python.projects.pgfoundry.org/">https://python.projects.pgfoundry.org/</a></p>
</section>
<section id="dialect-postgresql-pypostgresql-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-pypostgresql-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+pypostgresql://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pypostgresql dialect is <strong>not tested as part of SQLAlchemy’s continuous
integration</strong> and may have unresolved issues.  The recommended PostgreSQL
driver is psycopg2.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The py-postgresql DBAPI is deprecated and will be removed
in a future version. This DBAPI is superseded by the external
 version available at <a class="reference external" href="https://github.com/PyGreSQL">external-dialect</a>. Please use the external version or
 one of the supported DBAPIs to connect to PostgreSQL.</p>
</div>
</section>
<section id="module-sqlalchemy.dialects.postgresql.pygresql">
<span id="pygresql"></span><span id="dialect-postgresql-pygresql"></span><h2>pygresql<a class="headerlink" href="#module-sqlalchemy.dialects.postgresql.pygresql" title="Permalink to this headline">¶</a></h2>
<p>Support for the PostgreSQL database via the pygresql driver.</p>
<section id="dialect-postgresql-pygresql-url">
<h3>DBAPI<a class="headerlink" href="#dialect-postgresql-pygresql-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pygresql is available at:
<a class="reference external" href="https://www.pygresql.org/">https://www.pygresql.org/</a></p>
</section>
<section id="dialect-postgresql-pygresql-connect">
<h3>Connecting<a class="headerlink" href="#dialect-postgresql-pygresql-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql+pygresql://user:password@host:port/dbname[?key=value&amp;key=value...]</pre></div>
</div>
</p>
</section>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pygresql dialect is <strong>not tested as part of SQLAlchemy’s continuous
integration</strong> and may have unresolved issues.  The recommended PostgreSQL
dialect is psycopg2.</p>
</div>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The pygresql DBAPI is deprecated and will be removed
in a future version. Please use one of the supported DBAPIs to
connect to PostgreSQL.</p>
</div>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="index.html" title="previous chapter">Dialects</a>
        Next:
        <a href="mysql.html" title="next chapter">MySQL and MariaDB</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2021, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.1.2.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.4.23',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


