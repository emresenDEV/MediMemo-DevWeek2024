<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

        <title>
            
    
    SQLite
 &mdash;
    SQLAlchemy 1.4 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/default.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.4 Documentation" href="../index.html" />
        <link rel="up" title="Dialects" href="index.html" />
        <link rel="next" title="Oracle" href="oracle.html" />
        <link rel="prev" title="MySQL and MariaDB" href="mysql.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.4.23</span>


        | Release Date: August 18, 2021

    </div>

    <h1><a href="../index.html">SQLAlchemy 1.4 Documentation</a></h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.4 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="Dialects">Dialects</a>
        </h3>

        <ul>
<li><span class="link-container"><a class="reference external" href="postgresql.html">PostgreSQL</a></span></li>
<li><span class="link-container"><a class="reference external" href="mysql.html">MySQL and MariaDB</a></span></li>
<li class="selected"><span class="link-container"><strong>SQLite</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite">Support for the SQLite database.</a></span></li>
<li><span class="link-container"><a class="reference external" href="#date-and-time-types">Date and Time Types</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#ensuring-text-affinity">Ensuring Text affinity</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#sqlite-auto-incrementing-behavior">SQLite Auto Incrementing Behavior</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-the-autoincrement-keyword">Using the AUTOINCREMENT Keyword</a></span></li>
<li><span class="link-container"><a class="reference external" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#database-locking-behavior-concurrency">Database Locking Behavior / Concurrency</a></span></li>
<li><span class="link-container"><a class="reference external" href="#transaction-isolation-level-autocommit">Transaction Isolation Level / Autocommit</a></span></li>
<li><span class="link-container"><a class="reference external" href="#savepoint-support">SAVEPOINT Support</a></span></li>
<li><span class="link-container"><a class="reference external" href="#transactional-ddl">Transactional DDL</a></span></li>
<li><span class="link-container"><a class="reference external" href="#foreign-key-support">Foreign Key Support</a></span></li>
<li><span class="link-container"><a class="reference external" href="#on-conflict-support-for-constraints">ON CONFLICT support for constraints</a></span></li>
<li><span class="link-container"><a class="reference external" href="#insert-on-conflict-upsert">INSERT…ON CONFLICT (Upsert)</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#specifying-the-target">Specifying the Target</a></span></li>
<li><span class="link-container"><a class="reference external" href="#the-set-clause">The SET Clause</a></span></li>
<li><span class="link-container"><a class="reference external" href="#updating-using-the-excluded-insert-values">Updating using the Excluded INSERT Values</a></span></li>
<li><span class="link-container"><a class="reference external" href="#additional-where-criteria">Additional WHERE Criteria</a></span></li>
<li><span class="link-container"><a class="reference external" href="#skipping-rows-with-do-nothing">Skipping Rows with DO NOTHING</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#type-reflection">Type Reflection</a></span></li>
<li><span class="link-container"><a class="reference external" href="#partial-indexes">Partial Indexes</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dotted-column-names">Dotted Column Names</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlite-specific-table-options">SQLite-specific table options</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlite-data-types">SQLite Data Types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#sqlite-dml-constructs">SQLite DML Constructs</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pysqlite">Pysqlite</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlite-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlite-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#driver">Driver</a></span></li>
<li><span class="link-container"><a class="reference external" href="#connect-strings">Connect Strings</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#uri-connections">URI Connections</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#regular-expression-support">Regular Expression Support</a></span></li>
<li><span class="link-container"><a class="reference external" href="#compatibility-with-sqlite3-native-date-and-datetime-types">Compatibility with sqlite3 “native” date and datetime types</a></span></li>
<li><span class="link-container"><a class="reference external" href="#threading-pooling-behavior">Threading/Pooling Behavior</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#using-a-memory-database-in-multiple-threads">Using a Memory Database in Multiple Threads</a></span></li>
<li><span class="link-container"><a class="reference external" href="#using-temporary-tables-with-sqlite">Using Temporary Tables with SQLite</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#unicode">Unicode</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dealing-with-mixed-string-binary-columns-in-python-3">Dealing with Mixed String / Binary Columns in Python 3</a></span></li>
<li><span class="link-container"><a class="reference external" href="#serializable-isolation-savepoints-transactional-ddl">Serializable isolation / Savepoints / Transactional DDL</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#aiosqlite">Aiosqlite</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-aiosqlite-url">DBAPI</a></span></li>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-aiosqlite-connect">Connecting</a></span></li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="#pysqlcipher">Pysqlcipher</a></span><ul>
<li><span class="link-container"><a class="reference external" href="#dialect-sqlite-pysqlcipher-connect">Connecting</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id6">Driver</a></span></li>
<li><span class="link-container"><a class="reference external" href="#id7">Connect Strings</a></span></li>
<li><span class="link-container"><a class="reference external" href="#pooling-behavior">Pooling Behavior</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container"><a class="reference external" href="oracle.html">Oracle</a></span></li>
<li><span class="link-container"><a class="reference external" href="mssql.html">Microsoft SQL Server</a></span></li>
<li><span class="link-container"><a class="reference external" href="firebird.html">Firebird</a></span></li>
<li><span class="link-container"><a class="reference external" href="sybase.html">Sybase</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar dialects-sqlite" >
        
<section id="module-sqlalchemy.dialects.sqlite.base">
<span id="sqlite"></span><span id="sqlite-toplevel"></span><h1>SQLite<a class="headerlink" href="#module-sqlalchemy.dialects.sqlite.base" title="Permalink to this headline">¶</a></h1>
<section id="dialect-sqlite">
<p>Support for the SQLite database.</p>
<p>The following table summarizes current support levels for database release versions.</p>
<p><table class="docutils align-default" id="id8">
<caption><span class="caption-text"><strong>Supported SQLite versions</strong></span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Support type</p></th>
<th class="head"><p>Versions</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#term-Fully-tested-in-CI"><span class="xref std std-term">Fully tested in CI</span></a></p></td>
<td><p>3.21, 3.28+</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="index.html#term-Normal-support"><span class="xref std std-term">Normal support</span></a></p></td>
<td><p>3.12+</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="index.html#term-Best-effort"><span class="xref std std-term">Best effort</span></a></p></td>
<td><p>3.7.16+</p></td>
</tr>
</tbody>
</table>
</p>
<h2>DBAPI Support<a class="headerlink" href="#dialect-sqlite" title="Permalink to this headline">¶</a></h2>
<p>The following dialect/DBAPI options are available.  Please refer to individual DBAPI sections for connect information.<ul class="simple">
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlite">pysqlite</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.aiosqlite">aiosqlite</a></p></li>
<li><p><a class="reference external" href="#module-sqlalchemy.dialects.sqlite.pysqlcipher">pysqlcipher</a></p></li>
</ul>
</p>
</section>
<section id="date-and-time-types">
<span id="sqlite-datetime"></span><h2>Date and Time Types<a class="headerlink" href="#date-and-time-types" title="Permalink to this headline">¶</a></h2>
<p>SQLite does not have built-in DATE, TIME, or DATETIME types, and pysqlite does
not provide out of the box functionality for translating values between Python
<cite>datetime</cite> objects and a SQLite-supported format. SQLAlchemy’s own
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTime</span></code></a> and related types provide date formatting
and parsing functionality when SQLite is used. The implementation classes are
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATE</span></code></a> and <a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIME</span></code></a>.
These types represent dates and times as ISO formatted strings, which also
nicely support ordering. There’s no reliance on typical “libc” internals for
these functions so historical dates are fully supported.</p>
<section id="ensuring-text-affinity">
<h3>Ensuring Text affinity<a class="headerlink" href="#ensuring-text-affinity" title="Permalink to this headline">¶</a></h3>
<p>The DDL rendered for these types is the standard <code class="docutils literal notranslate"><span class="pre">DATE</span></code>, <code class="docutils literal notranslate"><span class="pre">TIME</span></code>
and <code class="docutils literal notranslate"><span class="pre">DATETIME</span></code> indicators.    However, custom storage formats can also be
applied to these types.   When the
storage format is detected as containing no alpha characters, the DDL for
these types is rendered as <code class="docutils literal notranslate"><span class="pre">DATE_CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">TIME_CHAR</span></code>, and <code class="docutils literal notranslate"><span class="pre">DATETIME_CHAR</span></code>,
so that the column continues to have textual affinity.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/datatype3.html#affinity">Type Affinity</a> -
in the SQLite documentation</p>
</div>
</section>
</section>
<section id="sqlite-auto-incrementing-behavior">
<span id="sqlite-autoincrement"></span><h2>SQLite Auto Incrementing Behavior<a class="headerlink" href="#sqlite-auto-incrementing-behavior" title="Permalink to this headline">¶</a></h2>
<p>Background on SQLite’s autoincrement is at: <a class="reference external" href="https://sqlite.org/autoinc.html">https://sqlite.org/autoinc.html</a></p>
<p>Key concepts:</p>
<ul class="simple">
<li><p>SQLite has an implicit “auto increment” feature that takes place for any
non-composite primary-key column that is specifically created using
“INTEGER PRIMARY KEY” for the type + primary key.</p></li>
<li><p>SQLite also has an explicit “AUTOINCREMENT” keyword, that is <strong>not</strong>
equivalent to the implicit autoincrement feature; this keyword is not
recommended for general use.  SQLAlchemy does not render this keyword
unless a special SQLite-specific directive is used (see below).  However,
it still requires that the column’s type is named “INTEGER”.</p></li>
</ul>
<section id="using-the-autoincrement-keyword">
<h3>Using the AUTOINCREMENT Keyword<a class="headerlink" href="#using-the-autoincrement-keyword" title="Permalink to this headline">¶</a></h3>
<p>To specifically render the AUTOINCREMENT keyword on the primary key column
when rendering DDL, add the flag <code class="docutils literal notranslate"><span class="pre">sqlite_autoincrement=True</span></code> to the Table
construct:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;sometable&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
        <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">sqlite_autoincrement</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</section>
<section id="allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer">
<h3>Allowing autoincrement behavior SQLAlchemy types other than Integer/INTEGER<a class="headerlink" href="#allowing-autoincrement-behavior-sqlalchemy-types-other-than-integer-integer" title="Permalink to this headline">¶</a></h3>
<p>SQLite’s typing model is based on naming conventions.  Among other things, this
means that any type name which contains the substring <code class="docutils literal notranslate"><span class="pre">&quot;INT&quot;</span></code> will be
determined to be of “integer affinity”.  A type named <code class="docutils literal notranslate"><span class="pre">&quot;BIGINT&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;SPECIAL_INT&quot;</span></code> or even <code class="docutils literal notranslate"><span class="pre">&quot;XYZINTQPR&quot;</span></code>, will be considered by SQLite to be
of “integer” affinity.  However, <strong>the SQLite autoincrement feature, whether
implicitly or explicitly enabled, requires that the name of the column’s type
is exactly the string “INTEGER”</strong>.  Therefore, if an application uses a type
like <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> for a primary key, on SQLite this type will need to
be rendered as the name <code class="docutils literal notranslate"><span class="pre">&quot;INTEGER&quot;</span></code> when emitting the initial <code class="docutils literal notranslate"><span class="pre">CREATE</span>
<span class="pre">TABLE</span></code> statement in order for the autoincrement behavior to be available.</p>
<p>One approach to achieve this is to use <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Integer" title="sqlalchemy.types.Integer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Integer</span></code></a> on SQLite
only using <a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">BigInteger</span><span class="p">()</span><span class="o">.</span><span class="n">with_variant</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="s2">&quot;sqlite&quot;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Another is to use a subclass of <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BigInteger" title="sqlalchemy.types.BigInteger"><code class="xref py py-class docutils literal notranslate"><span class="pre">BigInteger</span></code></a> that overrides its DDL
name to be <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code> when compiled against SQLite:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">BigInteger</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.compiler</span> <span class="kn">import</span> <span class="n">compiles</span>

<span class="k">class</span> <span class="nc">SLBigInteger</span><span class="p">(</span><span class="n">BigInteger</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">,</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;INTEGER&quot;</span>

<span class="nd">@compiles</span><span class="p">(</span><span class="n">SLBigInteger</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bi_c</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">compiler</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">visit_BIGINT</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>


<span class="n">table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s2">&quot;my_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">SLBigInteger</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.TypeEngine.with_variant" title="sqlalchemy.types.TypeEngine.with_variant"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TypeEngine.with_variant()</span></code></a></p>
<p><a class="reference internal" href="../core/compiler.html"><span class="std std-ref">Custom SQL Constructs and Compilation Extension</span></a></p>
<p><a class="reference external" href="https://sqlite.org/datatype3.html">Datatypes In SQLite Version 3</a></p>
</div>
</section>
</section>
<section id="database-locking-behavior-concurrency">
<span id="sqlite-concurrency"></span><h2>Database Locking Behavior / Concurrency<a class="headerlink" href="#database-locking-behavior-concurrency" title="Permalink to this headline">¶</a></h2>
<p>SQLite is not designed for a high level of write concurrency. The database
itself, being a file, is locked completely during write operations within
transactions, meaning exactly one “connection” (in reality a file handle)
has exclusive access to the database during this period - all other
“connections” will be blocked during this time.</p>
<p>The Python DBAPI specification also calls for a connection model that is
always in a transaction; there is no <code class="docutils literal notranslate"><span class="pre">connection.begin()</span></code> method,
only <code class="docutils literal notranslate"><span class="pre">connection.commit()</span></code> and <code class="docutils literal notranslate"><span class="pre">connection.rollback()</span></code>, upon which a
new transaction is to be begun immediately.  This may seem to imply
that the SQLite driver would in theory allow only a single filehandle on a
particular database file at any time; however, there are several
factors both within SQLite itself as well as within the pysqlite driver
which loosen this restriction significantly.</p>
<p>However, no matter what locking modes are used, SQLite will still always
lock the database file once a transaction is started and DML (e.g. INSERT,
UPDATE, DELETE) has at least been emitted, and this will block
other transactions at least at the point that they also attempt to emit DML.
By default, the length of time on this block is very short before it times out
with an error.</p>
<p>This behavior becomes more critical when used in conjunction with the
SQLAlchemy ORM.  SQLAlchemy’s <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> object by default runs
within a transaction, and with its autoflush model, may emit DML preceding
any SELECT statement.   This may lead to a SQLite database that locks
more quickly than is expected.   The locking mode of SQLite and the pysqlite
driver can be manipulated to some degree, however it should be noted that
achieving a high degree of write-concurrency with SQLite is a losing battle.</p>
<p>For more information on SQLite’s lack of write concurrency by design, please
see
<a class="reference external" href="https://www.sqlite.org/whentouse.html">Situations Where Another RDBMS May Work Better - High Concurrency</a> near the bottom of the page.</p>
<p>The following subsections introduce areas that are impacted by SQLite’s
file-based architecture and additionally will usually require workarounds to
work when using the pysqlite driver.</p>
</section>
<section id="transaction-isolation-level-autocommit">
<span id="sqlite-isolation-level"></span><h2>Transaction Isolation Level / Autocommit<a class="headerlink" href="#transaction-isolation-level-autocommit" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports “transaction isolation” in a non-standard way, along two
axes.  One is that of the
<a class="reference external" href="https://www.sqlite.org/pragma.html#pragma_read_uncommitted">PRAGMA read_uncommitted</a>
instruction.   This setting can essentially switch SQLite between its
default mode of <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code> isolation, and a “dirty read” isolation
mode normally referred to as <code class="docutils literal notranslate"><span class="pre">READ</span> <span class="pre">UNCOMMITTED</span></code>.</p>
<p>SQLAlchemy ties into this PRAGMA statement using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.isolation_level" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.isolation_level</span></code></a> parameter of
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>.
Valid values for this parameter when used with SQLite are <code class="docutils literal notranslate"><span class="pre">&quot;SERIALIZABLE&quot;</span></code>
and <code class="docutils literal notranslate"><span class="pre">&quot;READ</span> <span class="pre">UNCOMMITTED&quot;</span></code> corresponding to a value of 0 and 1, respectively.
SQLite defaults to <code class="docutils literal notranslate"><span class="pre">SERIALIZABLE</span></code>, however its behavior is impacted by
the pysqlite driver’s default behavior.</p>
<p>When using the pysqlite driver, the <code class="docutils literal notranslate"><span class="pre">&quot;AUTOCOMMIT&quot;</span></code> isolation level is also
available, which will alter the pysqlite connection using the <code class="docutils literal notranslate"><span class="pre">.isolation_level</span></code>
attribute on the DBAPI connection and set it to None for the duration
of the setting.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.16: </span>added support for SQLite AUTOCOMMIT isolation level
when using the pysqlite / sqlite3 SQLite driver.</p>
</div>
<p>The other axis along which SQLite’s transactional locking is impacted is
via the nature of the <code class="docutils literal notranslate"><span class="pre">BEGIN</span></code> statement used.   The three varieties
are “deferred”, “immediate”, and “exclusive”, as described at
<a class="reference external" href="https://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>.   A straight
<code class="docutils literal notranslate"><span class="pre">BEGIN</span></code> statement uses the “deferred” mode, where the database file is
not locked until the first read or write operation, and read access remains
open to other transactions until the first write operation.  But again,
it is critical to note that the pysqlite driver interferes with this behavior
by <em>not even emitting BEGIN</em> until the first write operation.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s transactional scope is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/connections.html#dbapi-autocommit"><span class="std std-ref">Setting Transaction Isolation Levels including DBAPI Autocommit</span></a></p>
</div>
</section>
<section id="savepoint-support">
<h2>SAVEPOINT Support<a class="headerlink" href="#savepoint-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports SAVEPOINTs, which only function once a transaction is
begun.   SQLAlchemy’s SAVEPOINT support is available using the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.begin_nested" title="sqlalchemy.engine.Connection.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.begin_nested()</span></code></a> method at the Core level, and
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.begin_nested" title="sqlalchemy.orm.Session.begin_nested"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.begin_nested()</span></code></a> at the ORM level.   However, SAVEPOINTs
won’t work at all with pysqlite unless workarounds are taken.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s SAVEPOINT feature is impacted by unresolved
issues in the pysqlite driver, which defers BEGIN statements to a greater
degree than is often feasible. See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</section>
<section id="transactional-ddl">
<h2>Transactional DDL<a class="headerlink" href="#transactional-ddl" title="Permalink to this headline">¶</a></h2>
<p>The SQLite database supports transactional <a class="reference internal" href="../glossary.html#term-DDL"><span class="xref std std-term">DDL</span></a> as well.
In this case, the pysqlite driver is not only failing to start transactions,
it also is ending any existing transaction when DDL is detected, so again,
workarounds are required.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>SQLite’s transactional DDL is impacted by unresolved issues
in the pysqlite driver, which fails to emit BEGIN and additionally
forces a COMMIT to cancel any transaction when DDL is encountered.
See the section <a class="reference internal" href="#pysqlite-serializable"><span class="std std-ref">Serializable isolation / Savepoints / Transactional DDL</span></a>
for techniques to work around this behavior.</p>
</div>
</section>
<section id="foreign-key-support">
<span id="sqlite-foreign-keys"></span><h2>Foreign Key Support<a class="headerlink" href="#foreign-key-support" title="Permalink to this headline">¶</a></h2>
<p>SQLite supports FOREIGN KEY syntax when emitting CREATE statements for tables,
however by default these constraints have no effect on the operation of the
table.</p>
<p>Constraint checking on SQLite has three prerequisites:</p>
<ul class="simple">
<li><p>At least version 3.6.19 of SQLite must be in use</p></li>
<li><p>The SQLite library must be compiled <em>without</em> the SQLITE_OMIT_FOREIGN_KEY
or SQLITE_OMIT_TRIGGER symbols enabled.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">PRAGMA</span> <span class="pre">foreign_keys</span> <span class="pre">=</span> <span class="pre">ON</span></code> statement must be emitted on all
connections before use.</p></li>
</ul>
<p>SQLAlchemy allows for the <code class="docutils literal notranslate"><span class="pre">PRAGMA</span></code> statement to be emitted automatically for
new connections through the usage of events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.engine</span> <span class="kn">import</span> <span class="n">Engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">event</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">Engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">set_sqlite_pragma</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_keys=ON&quot;</span><span class="p">)</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When SQLite foreign keys are enabled, it is <strong>not possible</strong>
to emit CREATE or DROP statements for tables that contain
mutually-dependent foreign key constraints;
to emit the DDL for these tables requires that ALTER TABLE be used to
create or drop these constraints separately, for which SQLite has
no support.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/foreignkeys.html">SQLite Foreign Key Support</a>
- on the SQLite web site.</p>
<p><a class="reference internal" href="../core/event.html"><span class="std std-ref">Events</span></a> - SQLAlchemy event API.</p>
<dl class="simple">
<dt><a class="reference internal" href="../core/constraints.html#use-alter"><span class="std std-ref">Creating/Dropping Foreign Key Constraints via ALTER</span></a> - more information on SQLAlchemy’s facilities for handling</dt><dd><p>mutually-dependent foreign key constraints.</p>
</dd>
</dl>
</div>
</section>
<section id="on-conflict-support-for-constraints">
<span id="sqlite-on-conflict-ddl"></span><h2>ON CONFLICT support for constraints<a class="headerlink" href="#on-conflict-support-for-constraints" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This section describes the <a class="reference internal" href="../glossary.html#term-DDL"><span class="xref std std-term">DDL</span></a> version of “ON CONFLICT” for
SQLite, which occurs within a CREATE TABLE statement.  For “ON CONFLICT” as
applied to an INSERT statement, see <a class="reference internal" href="#sqlite-on-conflict-insert"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a>.</p>
</div>
<p>SQLite supports a non-standard DDL clause known as ON CONFLICT which can be applied
to primary key, unique, check, and not null constraints.   In DDL, it is
rendered either within the “CONSTRAINT” clause or within the column definition
itself depending on the location of the target constraint.    To render this
clause within DDL, the extension parameter <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict</span></code> can be
specified with a string conflict resolution algorithm within the
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.PrimaryKeyConstraint" title="sqlalchemy.schema.PrimaryKeyConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">PrimaryKeyConstraint</span></code></a>, <a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.UniqueConstraint" title="sqlalchemy.schema.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a>,
<a class="reference internal" href="../core/constraints.html#sqlalchemy.schema.CheckConstraint" title="sqlalchemy.schema.CheckConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">CheckConstraint</span></code></a> objects.  Within the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object,
there
are individual parameters <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_not_null</span></code>,
<code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_primary_key</span></code>, <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_unique</span></code> which each
correspond to the three types of relevant constraint types that can be
indicated from a <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> object.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/lang_conflict.html">ON CONFLICT</a> - in the SQLite
documentation</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict</span></code> parameters accept a  string argument which is just
the resolution name to be chosen, which on SQLite can be one of ROLLBACK,
ABORT, FAIL, IGNORE, and REPLACE.   For example, to add a UNIQUE constraint
that specifies the IGNORE algorithm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">),</span>
    <span class="n">UniqueConstraint</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">sqlite_on_conflict</span><span class="o">=</span><span class="s1">&#39;IGNORE&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>The above renders CREATE TABLE DDL as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">),</span>
    <span class="n">UNIQUE</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">IGNORE</span>
<span class="p">)</span></pre></div>
</div>
<p>When using the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.unique" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.unique</span></code></a>
flag to add a UNIQUE constraint
to a single column, the <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_unique</span></code> parameter can
be added to the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> as well, which will be added to the
UNIQUE constraint in the DDL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_unique</span><span class="o">=</span><span class="s1">&#39;IGNORE&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>rendering:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">),</span>
    <span class="n">UNIQUE</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">IGNORE</span>
<span class="p">)</span></pre></div>
</div>
<p>To apply the FAIL algorithm for a NOT NULL constraint,
<code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_not_null</span></code> is used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_not_null</span><span class="o">=</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>this renders the column inline ON CONFLICT phrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">data</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">FAIL</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Similarly, for an inline primary key, use <code class="docutils literal notranslate"><span class="pre">sqlite_on_conflict_primary_key</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;some_table&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">sqlite_on_conflict_primary_key</span><span class="o">=</span><span class="s1">&#39;FAIL&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>SQLAlchemy renders the PRIMARY KEY constraint separately, so the conflict
resolution algorithm is applied to the constraint itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">some_table</span> <span class="p">(</span>
    <span class="nb">id</span> <span class="n">INTEGER</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
    <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="n">ON</span> <span class="n">CONFLICT</span> <span class="n">FAIL</span>
<span class="p">)</span></pre></div>
</div>
</section>
<section id="insert-on-conflict-upsert">
<span id="sqlite-on-conflict-insert"></span><h2>INSERT…ON CONFLICT (Upsert)<a class="headerlink" href="#insert-on-conflict-upsert" title="Permalink to this headline">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This section describes the <a class="reference internal" href="../glossary.html#term-DML"><span class="xref std std-term">DML</span></a> version of “ON CONFLICT” for
SQLite, which occurs within an INSERT statement.  For “ON CONFLICT” as
applied to a CREATE TABLE statement, see <a class="reference internal" href="#sqlite-on-conflict-ddl"><span class="std std-ref">ON CONFLICT support for constraints</span></a>.</p>
</div>
<p>From version 3.24.0 onwards, SQLite supports “upserts” (update or insert)
of rows into a table via the <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause of the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>
statement. A candidate row will only be inserted if that row does not violate
any unique or primary key constraints. In the case of a unique constraint violation, a
secondary action can occur which can be either “DO UPDATE”, indicating that
the data in the target row should be updated, or “DO NOTHING”, which indicates
to silently skip this row.</p>
<p>Conflicts are determined using columns that are part of existing unique
constraints and indexes.  These constraints are identified by stating the
columns and conditions that comprise the indexes.</p>
<p>SQLAlchemy provides <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> support via the SQLite-specific
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.insert" title="sqlalchemy.dialects.sqlite.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">insert()</span></code></a> function, which provides
the generative methods <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a>
and <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a>:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">insert</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">insert_stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_existing_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">?</span>
</div><span class="gp">&gt;&gt;&gt; </span><span class="n">do_nothing_stmt</span> <span class="o">=</span> <span class="n">insert_stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_nothing_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://sqlite.org/lang_UPSERT.html">Upsert</a>
- in the SQLite documentation.</p>
</div>
<section id="specifying-the-target">
<h3>Specifying the Target<a class="headerlink" href="#specifying-the-target" title="Permalink to this headline">¶</a></h3>
<p>Both methods supply the “target” of the conflict using column inference:</p>
<ul>
<li><p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a> argument
specifies a sequence containing string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, and/or SQL expression elements, which would identify a unique index
or unique constraint.</p></li>
<li><p>When using <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_elements" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_elements</span></code></a>
to infer an index, a partial index can be inferred by also specifying the
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_where" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.index_where</span></code></a> parameter:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">user_email</span><span class="o">=</span><span class="s1">&#39;a@b.com&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted data&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_email</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">index_where</span><span class="o">=</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_email</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s1">&#39;%@gmail.com&#39;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="k">data</span><span class="p">,</span> <span class="n">user_email</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">user_email</span><span class="p">)</span>
<span class="k">WHERE</span> <span class="n">user_email</span> <span class="k">LIKE</span> <span class="s1">&#39;%@gmail.com&#39;</span>
<span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="k">data</span>
<span class="o">&gt;&gt;&gt;</span>
</div></pre></div>
</div>
</li>
</ul>
</section>
<section id="the-set-clause">
<h3>The SET Clause<a class="headerlink" href="#the-set-clause" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT...DO</span> <span class="pre">UPDATE</span></code> is used to perform an update of the already
existing row, using any combination of new values as well as values
from the proposed insertion. These values are specified using the
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> parameter.  This
parameter accepts a dictionary which consists of direct values
for UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>

<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">?</span>
</div></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a> method does <strong>not</strong> take
into account Python-side default UPDATE values or generation functions,
e.g. those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>. These
values will not be exercised for an ON CONFLICT style of UPDATE, unless
they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</section>
<section id="updating-using-the-excluded-insert-values">
<h3>Updating using the Excluded INSERT Values<a class="headerlink" href="#updating-using-the-excluded-insert-values" title="Permalink to this headline">¶</a></h3>
<p>In order to refer to the proposed insertion row, the special alias
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.excluded" title="sqlalchemy.dialects.sqlite.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> is available as an attribute on
the <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert" title="sqlalchemy.dialects.sqlite.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object; this object creates an “excluded.” prefix
on a column, that informs the DO UPDATE to update the row with the value that
would have been inserted had the constraint not failed:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;jlh&#39;</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">do_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">author</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">do_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span> <span class="n">author</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
</div></pre></div>
</div>
</section>
<section id="additional-where-criteria">
<h3>Additional WHERE Criteria<a class="headerlink" href="#additional-where-criteria" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update()</span></code></a> method also accepts
a WHERE clause using the <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.where" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.where</span></code></a>
parameter, which will limit those rows which receive an UPDATE:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span>
<span class="gp">... </span>    <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;jlh&#39;</span>
<span class="gp">... </span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">on_update_stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">set_</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;updated value&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span><span class="o">.</span><span class="n">author</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">my_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">on_update_stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="k">data</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span> <span class="n">author</span> <span class="o">=</span> <span class="n">excluded</span><span class="p">.</span><span class="n">author</span>
<span class="k">WHERE</span> <span class="n">my_table</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="o">?</span>
</div></pre></div>
</div>
</section>
<section id="skipping-rows-with-do-nothing">
<h3>Skipping Rows with DO NOTHING<a class="headerlink" href="#skipping-rows-with-do-nothing" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> may be used to skip inserting a row entirely
if any conflict with a unique constraint occurs; below this is illustrated
using the <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.on_conflict_do_nothing()</span></code></a> method:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">(</span><span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div></pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> is used without specifying any columns or constraint,
it has the effect of skipping the INSERT for any unique violation which
occurs:</p>
<div class="highlight-pycon+sql notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="n">my_table</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;some_id&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;inserted value&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
<div class='show_sql'><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">my_table</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">data</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span> <span class="k">ON</span> <span class="n">CONFLICT</span> <span class="k">DO</span> <span class="k">NOTHING</span>
</div></pre></div>
</div>
</section>
</section>
<section id="type-reflection">
<span id="sqlite-type-reflection"></span><h2>Type Reflection<a class="headerlink" href="#type-reflection" title="Permalink to this headline">¶</a></h2>
<p>SQLite types are unlike those of most other database backends, in that
the string name of the type usually does not correspond to a “type” in a
one-to-one fashion.  Instead, SQLite links per-column typing behavior
to one of five so-called “type affinities” based on a string matching
pattern for the type.</p>
<p>SQLAlchemy’s reflection process, when inspecting types, uses a simple
lookup table to link the keywords returned to provided SQLAlchemy types.
This lookup table is present within the SQLite dialect as it is for all
other dialects.  However, the SQLite dialect has a different “fallback”
routine for when a particular type name is not located in the lookup map;
it instead implements the SQLite “type affinity” scheme located at
<a class="reference external" href="https://www.sqlite.org/datatype3.html">https://www.sqlite.org/datatype3.html</a> section 2.1.</p>
<p>The provided typemap will make direct associations from an exact string
name match for the following types:</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BIGINT" title="sqlalchemy.types.BIGINT"><code class="xref py py-class docutils literal notranslate"><span class="pre">BIGINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BLOB" title="sqlalchemy.types.BLOB"><code class="xref py py-class docutils literal notranslate"><span class="pre">BLOB</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">BOOLEAN</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.BOOLEAN" title="sqlalchemy.types.BOOLEAN"><code class="xref py py-class docutils literal notranslate"><span class="pre">BOOLEAN</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.CHAR" title="sqlalchemy.types.CHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">CHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATE" title="sqlalchemy.types.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATE</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DATETIME" title="sqlalchemy.types.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">DATETIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DECIMAL" title="sqlalchemy.types.DECIMAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">DECIMAL</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.FLOAT" title="sqlalchemy.types.FLOAT"><code class="xref py py-class docutils literal notranslate"><span class="pre">FLOAT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMERIC</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.SMALLINT" title="sqlalchemy.types.SMALLINT"><code class="xref py py-class docutils literal notranslate"><span class="pre">SMALLINT</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIME" title="sqlalchemy.types.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIME</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TIMESTAMP" title="sqlalchemy.types.TIMESTAMP"><code class="xref py py-class docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.VARCHAR" title="sqlalchemy.types.VARCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">VARCHAR</span></code></a>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NVARCHAR" title="sqlalchemy.types.NVARCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">NVARCHAR</span></code></a>,
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NCHAR" title="sqlalchemy.types.NCHAR"><code class="xref py py-class docutils literal notranslate"><span class="pre">NCHAR</span></code></a></p>
<p>When a type name does not match one of the above types, the “type affinity”
lookup is used instead:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.INTEGER" title="sqlalchemy.types.INTEGER"><code class="xref py py-class docutils literal notranslate"><span class="pre">INTEGER</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">INT</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.TEXT" title="sqlalchemy.types.TEXT"><code class="xref py py-class docutils literal notranslate"><span class="pre">TEXT</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">CLOB</span></code> or <code class="docutils literal notranslate"><span class="pre">TEXT</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_api.html#sqlalchemy.types.NullType" title="sqlalchemy.types.NullType"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullType</span></code></a> is returned if the type name includes the
string <code class="docutils literal notranslate"><span class="pre">BLOB</span></code></p></li>
<li><p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.REAL" title="sqlalchemy.types.REAL"><code class="xref py py-class docutils literal notranslate"><span class="pre">REAL</span></code></a> is returned if the type name includes the string
<code class="docutils literal notranslate"><span class="pre">REAL</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOA</span></code> or <code class="docutils literal notranslate"><span class="pre">DOUB</span></code>.</p></li>
<li><p>Otherwise, the <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.NUMERIC" title="sqlalchemy.types.NUMERIC"><code class="xref py py-class docutils literal notranslate"><span class="pre">NUMERIC</span></code></a> type is used.</p></li>
</ul>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.3: </span>Support for SQLite type affinity rules when reflecting
columns.</p>
</div>
</section>
<section id="partial-indexes">
<span id="sqlite-partial-index"></span><h2>Partial Indexes<a class="headerlink" href="#partial-indexes" title="Permalink to this headline">¶</a></h2>
<p>A partial index, e.g. one which uses a WHERE clause, can be specified
with the DDL system using the argument <code class="docutils literal notranslate"><span class="pre">sqlite_where</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;testtbl&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">))</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">Index</span><span class="p">(</span><span class="s1">&#39;test_idx1&#39;</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">sqlite_where</span><span class="o">=</span><span class="n">and_</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">))</span></pre></div>
</div>
<p>The index will be rendered at create time as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">INDEX</span> <span class="n">test_idx1</span> <span class="n">ON</span> <span class="n">testtbl</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">WHERE</span> <span class="n">data</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="n">AND</span> <span class="n">data</span> <span class="o">&lt;</span> <span class="mi">10</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 0.9.9.</span></p>
</div>
</section>
<section id="dotted-column-names">
<span id="sqlite-dotted-column-names"></span><h2>Dotted Column Names<a class="headerlink" href="#dotted-column-names" title="Permalink to this headline">¶</a></h2>
<p>Using table or column names that explicitly have periods in them is
<strong>not recommended</strong>.   While this is generally a bad idea for relational
databases in general, as the dot is a syntactically significant character,
the SQLite driver up until version <strong>3.10.0</strong> of SQLite has a bug which
requires that SQLAlchemy filter out these dots in result sets.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.1: </span>The following SQLite issue has been resolved as of version 3.10.0
of SQLite.  SQLAlchemy as of <strong>1.1</strong> automatically disables its internal
workarounds based on detection of this version.</p>
</div>
<p>The bug, entirely outside of SQLAlchemy, can be illustrated thusly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="k">assert</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">sqlite_version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;bug is fixed in this version&quot;</span>

<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span> \
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span></pre></div>
</div>
<p>The second assertion fails:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;test.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">19</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
<span class="ne">AssertionError</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;x.a&#39;</span><span class="p">,</span> <span class="s1">&#39;x.b&#39;</span><span class="p">]</span></pre></div>
</div>
<p>Where above, the driver incorrectly reports the names of the columns
including the name of the table, which is entirely inconsistent vs.
when the UNION is not present.</p>
<p>SQLAlchemy relies upon column names being predictable in how they match
to the original statement, so the SQLAlchemy dialect has no choice but
to filter these out:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">eng</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">eng</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;create table x (a integer, b integer)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (1, 1)&quot;</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;insert into x (a, b) values (2, 2)&quot;</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;select x.a, x.b from x&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>Note that above, even though SQLAlchemy filters out the dots, <em>both
names are still addressable</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x.b&quot;</span><span class="p">]</span>
<span class="go">1</span></pre></div>
</div>
<p>Therefore, the workaround applied by SQLAlchemy only impacts
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.keys" title="sqlalchemy.engine.CursorResult.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.keys()</span></code></a> and <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row.keys" title="sqlalchemy.engine.Row.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row.keys()</span></code></a> in the public API. In
the very specific case where an application is forced to use column names that
contain dots, and the functionality of <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.CursorResult.keys" title="sqlalchemy.engine.CursorResult.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">CursorResult.keys()</span></code></a> and
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Row.keys" title="sqlalchemy.engine.Row.keys"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Row.keys()</span></code></a> is required to return these dotted names unmodified,
the <code class="docutils literal notranslate"><span class="pre">sqlite_raw_colnames</span></code> execution option may be provided, either on a
per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execution_options</span><span class="p">(</span><span class="n">sqlite_raw_colnames</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    select x.a, x.b from x where a=1</span>
<span class="s1">    union</span>
<span class="s1">    select x.a, x.b from x where a=2</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s2">&quot;x.a&quot;</span><span class="p">,</span> <span class="s2">&quot;x.b&quot;</span><span class="p">]</span></pre></div>
</div>
<p>or on a per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite://&quot;</span><span class="p">,</span> <span class="n">execution_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sqlite_raw_colnames&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></pre></div>
</div>
<p>When using the per-<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Engine" title="sqlalchemy.engine.Engine"><code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code></a> execution option, note that
<strong>Core and ORM queries that use UNION may not function properly</strong>.</p>
</section>
<section id="sqlite-specific-table-options">
<h2>SQLite-specific table options<a class="headerlink" href="#sqlite-specific-table-options" title="Permalink to this headline">¶</a></h2>
<p>One option for CREATE TABLE is supported directly by the SQLite
dialect in conjunction with the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> construct:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">WITHOUT</span> <span class="pre">ROWID</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">(</span><span class="s2">&quot;some_table&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">sqlite_with_rowid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></pre></div>
</div>
</li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/lang_createtable.html">SQLite CREATE TABLE options</a></p>
</div>
</section>
<section id="sqlite-data-types">
<h2>SQLite Data Types<a class="headerlink" href="#sqlite-data-types" title="Permalink to this headline">¶</a></h2>
<p>As with all SQLAlchemy dialects, all UPPERCASE types that are known to be
valid with SQLite are importable from the top level dialect, whether
they originate from <a class="reference internal" href="../core/type_basics.html#module-sqlalchemy.types" title="sqlalchemy.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sqlalchemy.types</span></code></a> or from the local dialect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> \
            <span class="n">BLOB</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">CHAR</span><span class="p">,</span> <span class="n">DATE</span><span class="p">,</span> <span class="n">DATETIME</span><span class="p">,</span> <span class="n">DECIMAL</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">,</span> \
            <span class="n">INTEGER</span><span class="p">,</span> <span class="n">NUMERIC</span><span class="p">,</span> <span class="n">JSON</span><span class="p">,</span> <span class="n">SMALLINT</span><span class="p">,</span> <span class="n">TEXT</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">TIMESTAMP</span><span class="p">,</span> \
            <span class="n">VARCHAR</span></pre></div>
</div>
<span class="target" id="module-sqlalchemy.dialects.sqlite"></span><table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE"><span class="sig-name descname">DATE</span></a></p></td>
<td><p>Represent a Python date object in SQLite using a string.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME"><span class="sig-name descname">DATETIME</span></a></p></td>
<td><p>Represent a Python datetime object in SQLite using a string.</p></td>
</tr>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.JSON"><span class="sig-name descname">JSON</span></a></p></td>
<td><p>SQLite JSON type.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME"><span class="sig-name descname">TIME</span></a></p></td>
<td><p>Represent a Python time object in SQLite using a string.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.DATETIME">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">DATETIME</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATETIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a Python datetime object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2"> </span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2021</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">57.105542</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATETIME</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">DATETIME</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">/</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2"> &quot;</span>
                             <span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">regexp</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(\d+)/(\d+)/(\d+) (\d+)-(\d+)-(\d+)&quot;</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.storage_format">¶</a> – format string which will be applied to the dict
with keys year, month, day, hour, minute, second, and microsecond.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATETIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME.params.regexp">¶</a> – regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python datetime() constructor as keyword arguments.
Otherwise, if positional groups are used, the datetime() constructor
is called with positional arguments via
<code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATETIME" title="sqlalchemy.dialects.sqlite.DATETIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.DATETIME</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.DateTime" title="sqlalchemy.types.DateTime"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.DateTime</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.DATE">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">DATE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">storage_format</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regexp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.DATE" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a Python date object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(year)04d</span><span class="s2">-</span><span class="si">%(month)02d</span><span class="s2">-</span><span class="si">%(day)02d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2011</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">15</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">DATE</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">DATE</span><span class="p">(</span>
        <span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(month)02d</span><span class="s2">/</span><span class="si">%(day)02d</span><span class="s2">/</span><span class="si">%(year)04d</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(?P&lt;month&gt;\d+)/(?P&lt;day&gt;\d+)/(?P&lt;year&gt;\d+)&quot;</span><span class="p">)</span>
    <span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.storage_format">¶</a> – format string which will be applied to the
dict with keys year, month, and day.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.DATE.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.DATE.params.regexp">¶</a> – regular expression which will be applied to
incoming result rows. If the regexp contains named groups, the
resulting match dict is applied to the Python date() constructor
as keyword arguments. Otherwise, if positional groups are used, the
date() constructor is called with positional arguments via
<code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.sqlite.DATE" title="sqlalchemy.dialects.sqlite.DATE"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.DATE</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Date" title="sqlalchemy.types.Date"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Date</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.JSON">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">JSON</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">none_as_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.JSON" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLite JSON type.</p>
<p>SQLite supports JSON as of version 3.9 through its <a class="reference external" href="https://www.sqlite.org/json1.html">JSON1</a> extension. Note
that <a class="reference external" href="https://www.sqlite.org/json1.html">JSON1</a> is a
<a class="reference external" href="https://www.sqlite.org/loadext.html">loadable extension</a> and as such
may not be available, or may require run-time loading.</p>
<p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.JSON" title="sqlalchemy.dialects.sqlite.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> is used automatically whenever the base
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> datatype is used against a SQLite backend.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> - main documentation for the generic
cross-platform JSON datatype.</p>
</div>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.JSON" title="sqlalchemy.dialects.sqlite.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a> type supports persistence of JSON values
as well as the core index operations provided by <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">JSON</span></code></a>
datatype, by adapting the operations to render the <code class="docutils literal notranslate"><span class="pre">JSON_EXTRACT</span></code>
function wrapped in the <code class="docutils literal notranslate"><span class="pre">JSON_QUOTE</span></code> function at the database level.
Extracted values are quoted in order to ensure that the results are
always JSON string values.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.</span></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.sqlite.JSON" title="sqlalchemy.dialects.sqlite.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.JSON</span></code></a> (<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.JSON" title="sqlalchemy.types.JSON"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.JSON</span></code></a>)</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.TIME">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">TIME</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.TIME" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent a Python time object in SQLite using a string.</p>
<p>The default string storage format is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">:</span><span class="si">%(minute)02d</span><span class="s2">:</span><span class="si">%(second)02d</span><span class="s2">.</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span></pre></div>
</div>
<p>e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">12</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">57.10558</span></pre></div>
</div>
<p>The storage format can be customized to some degree using the
<code class="docutils literal notranslate"><span class="pre">storage_format</span></code> and <code class="docutils literal notranslate"><span class="pre">regexp</span></code> parameters, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.dialects.sqlite</span> <span class="kn">import</span> <span class="n">TIME</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">(</span><span class="n">storage_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(hour)02d</span><span class="s2">-</span><span class="si">%(minute)02d</span><span class="s2">-&quot;</span>
                        <span class="s2">&quot;</span><span class="si">%(second)02d</span><span class="s2">-</span><span class="si">%(microsecond)06d</span><span class="s2">&quot;</span><span class="p">,</span>
         <span class="n">regexp</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(\d+)-(\d+)-(\d+)-(?:-(\d+))?&quot;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.storage_format"></span><strong>storage_format</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.storage_format">¶</a> – format string which will be applied to the dict
with keys hour, minute, second, and microsecond.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.TIME.params.regexp"></span><strong>regexp</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.TIME.params.regexp">¶</a> – regular expression which will be applied to incoming result
rows. If the regexp contains named groups, the resulting match dict is
applied to the Python time() constructor as keyword arguments. Otherwise,
if positional groups are used, the time() constructor is called with
positional arguments via <code class="docutils literal notranslate"><span class="pre">*map(int,</span> <span class="pre">match_obj.groups(0))</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.sqlite.TIME" title="sqlalchemy.dialects.sqlite.TIME"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.TIME</span></code></a> (<code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.base._DateTimeMixin</span></code>, <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Time" title="sqlalchemy.types.Time"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.types.Time</span></code></a>)</p>
</div>
</dd></dl>

</section>
<section id="sqlite-dml-constructs">
<h2>SQLite DML Constructs<a class="headerlink" href="#sqlite-dml-constructs" title="Permalink to this headline">¶</a></h2>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head">Object Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.insert"><span class="sig-name descname">insert</span></a>(table[, values, inline, bind, ...], **dialect_kw)</p></td>
<td><p>Construct an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object.</p></td>
</tr>
<tr class="row-odd"><td class="nowrap"><p><a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert"><span class="sig-name descname">Insert</span></a></p></td>
<td><p>SQLite-specific implementation of INSERT.</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.insert">
<em class="property"><span class="pre">function</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefixes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">dialect_kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.insert" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object.</p>
<div class="inherited-member docutils container">
<p>This documentation is inherited from <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert" title="sqlalchemy.sql.expression.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.insert()</span></code></a>; this constructor, <a class="reference internal" href="#sqlalchemy.dialects.sqlite.insert" title="sqlalchemy.dialects.sqlite.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.insert()</span></code></a>,   creates a <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert" title="sqlalchemy.dialects.sqlite.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.Insert</span></code></a> object.  See that class for additional details describing this subclass.</p>
</div>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">insert</span>

<span class="n">stmt</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">insert</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span><span class="o">.</span>
    <span class="n">values</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="o">=</span><span class="s1">&#39;Full Username&#39;</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>Similar functionality is available via the
<a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableClause.insert" title="sqlalchemy.sql.expression.TableClause.insert"><code class="xref py py-meth docutils literal notranslate"><span class="pre">TableClause.insert()</span></code></a> method on
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/tutorial.html#coretutorial-insert-expressions"><span class="std std-ref">Insert Expressions</span></a> - in the
<a class="reference internal" href="../core/tutorial.html"><span class="std std-ref">1.x tutorial</span></a></p>
<p><a class="reference internal" href="../tutorial/data_insert.html#tutorial-core-insert"><span class="std std-ref">Inserting Rows with Core</span></a> - in the <a class="reference internal" href="../tutorial/index.html#unified-tutorial"><span class="std std-ref">SQLAlchemy 1.4 / 2.0 Tutorial</span></a></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.insert.params.table"></span><strong>table</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.insert.params.table">¶</a> – <a class="reference internal" href="../core/selectable.html#sqlalchemy.sql.expression.TableClause" title="sqlalchemy.sql.expression.TableClause"><code class="xref py py-class docutils literal notranslate"><span class="pre">TableClause</span></code></a>
which is the subject of the
insert.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.insert.params.values"></span><strong>values</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.insert.params.values">¶</a> – <p>collection of values to be inserted; see
<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a>
for a description of allowed formats here.
Can be omitted entirely; a <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> construct
will also dynamically render the VALUES clause at execution time
based on the parameters passed to <a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execute" title="sqlalchemy.engine.Connection.execute"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Connection.execute()</span></code></a>.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert.params.values" title="sqlalchemy.sql.expression.insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">insert.values</span></code></a> parameter will be removed in SQLAlchemy 2.0.  Please refer to the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.values" title="sqlalchemy.sql.expression.Insert.values"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.values()</span></code></a> method.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.insert.params.inline"></span><strong>inline</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.insert.params.inline">¶</a> – <p>if True, no attempt will be made to retrieve the
SQL-generated default values to be provided within the statement;
in particular,
this allows SQL expressions to be rendered ‘inline’ within the
statement without the need to pre-execute them beforehand; for
backends that support “returning”, this turns off the “implicit
returning” feature for the statement.</p>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.4: </span>The <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.insert.params.inline" title="sqlalchemy.sql.expression.insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">insert.inline</span></code></a> parameter will be removed in SQLAlchemy 2.0.  Please use the <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.inline" title="sqlalchemy.sql.expression.Insert.inline"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Insert.inline()</span></code></a> method.</p>
</div>
</p></li>
</ul>
</dd>
</dl>
<p>If both <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> and compile-time bind
parameters are present, the compile-time bind parameters override the
information specified within <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> on a
per-key basis.</p>
<p>The keys within <a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert.params.values" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.values</span></code></a> can be either
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects or their string
identifiers. Each key may reference one of:</p>
<ul class="simple">
<li><p>a literal data value (i.e. string, number, etc.);</p></li>
<li><p>a Column object;</p></li>
<li><p>a SELECT statement.</p></li>
</ul>
<p>If a <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement is specified which references this
<code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement’s table, the statement will be correlated
against the <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> statement.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../core/tutorial.html#coretutorial-insert-expressions"><span class="std std-ref">Insert Expressions</span></a> - SQL Expression Tutorial</p>
<p><a class="reference internal" href="../core/tutorial.html#inserts-and-updates"><span class="std std-ref">Inserts, Updates and Deletes</span></a> - SQL Expression Tutorial</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.Insert">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">sqlalchemy.dialects.sqlite.</span></span><span class="sig-name descname"><span class="pre">Insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefixes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">returning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_defaults</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">dialect_kw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.Insert" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLite-specific implementation of INSERT.</p>
<p>Adds methods for SQLite-specific syntaxes such as ON CONFLICT.</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert" title="sqlalchemy.dialects.sqlite.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">Insert</span></code></a> object is created using the
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.insert" title="sqlalchemy.dialects.sqlite.insert"><code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.insert()</span></code></a> function.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#sqlite-on-conflict-insert"><span class="std std-ref">INSERT…ON CONFLICT (Upsert)</span></a></p>
</div>
<div class="class-bases docutils container">
<p><strong>Class signature</strong></p>
<p>class <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert" title="sqlalchemy.dialects.sqlite.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.Insert</span></code></a> (<a class="reference internal" href="../core/dml.html#sqlalchemy.sql.expression.Insert" title="sqlalchemy.sql.expression.Insert"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.sql.expression.Insert</span></code></a>)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.Insert.excluded">
<em class="property"><span class="pre">attribute</span> </em><a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.Insert.</span></code></a><span class="sig-name descname"><span class="pre">excluded</span></span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.Insert.excluded" title="Permalink to this definition">¶</a></dt>
<dd><p>Provide the <code class="docutils literal notranslate"><span class="pre">excluded</span></code> namespace for an ON CONFLICT statement</p>
<p>SQLite’s ON CONFLICT clause allows reference to the row that would
be inserted, known as <code class="docutils literal notranslate"><span class="pre">excluded</span></code>.  This attribute provides
all columns in this row to be referenceable.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.excluded" title="sqlalchemy.dialects.sqlite.Insert.excluded"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Insert.excluded</span></code></a> attribute is an instance
of <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a>, which provides an
interface the same as that of the <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table.c" title="sqlalchemy.schema.Table.c"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Table.c</span></code></a>
collection described at <a class="reference internal" href="../core/metadata.html#metadata-tables-and-columns"><span class="std std-ref">Accessing Tables and Columns</span></a>.
With this collection, ordinary names are accessible like attributes
(e.g. <code class="docutils literal notranslate"><span class="pre">stmt.excluded.some_column</span></code>), but special names and
dictionary method names should be accessed using indexed access,
such as <code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;column</span> <span class="pre">name&quot;]</span></code> or
<code class="docutils literal notranslate"><span class="pre">stmt.excluded[&quot;values&quot;]</span></code>.  See the docstring for
<a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnCollection" title="sqlalchemy.sql.expression.ColumnCollection"><code class="xref py py-class docutils literal notranslate"><span class="pre">ColumnCollection</span></code></a> for further examples.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_nothing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a DO NOTHING action for ON CONFLICT clause.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index or unique constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_nothing.params.index_where">¶</a> – Additional WHERE criterion that can be used to infer a
conditional target index.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update">
<em class="property"><span class="pre">method</span> </em><a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert"><code class="docutils literal notranslate"><span class="pre">sqlalchemy.dialects.sqlite.Insert.</span></code></a><span class="sig-name descname"><span class="pre">on_conflict_do_update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index_elements</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">where</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update" title="Permalink to this definition">¶</a></dt>
<dd><p>Specifies a DO UPDATE SET action for ON CONFLICT clause.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_elements"></span><strong>index_elements</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_elements">¶</a> – A sequence consisting of string column names, <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a>
objects, or other column expression objects that will be used
to infer a target index or unique constraint.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_where"></span><strong>index_where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.index_where">¶</a> – Additional WHERE criterion that can be used to infer a
conditional target index.</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_"></span><strong>set_</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_">¶</a> – <p>A dictionary or other mapping object
where the keys are either names of columns in the target table,
or <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects or other ORM-mapped columns
matching that of the target table, and expressions or literals
as values, specifying the <code class="docutils literal notranslate"><span class="pre">SET</span></code> actions to take.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4: </span>The
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a>
parameter supports <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column" title="sqlalchemy.schema.Column"><code class="xref py py-class docutils literal notranslate"><span class="pre">Column</span></code></a> objects from the target
<a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Table" title="sqlalchemy.schema.Table"><code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code></a> as keys.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This dictionary does <strong>not</strong> take into account
Python-specified default UPDATE values or generation functions,
e.g. those specified using <a class="reference internal" href="../core/metadata.html#sqlalchemy.schema.Column.params.onupdate" title="sqlalchemy.schema.Column"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Column.onupdate</span></code></a>.
These values will not be exercised for an ON CONFLICT style of
UPDATE, unless they are manually specified in the
<a class="reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.set_" title="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Insert.on_conflict_do_update.set_</span></code></a> dictionary.</p>
</div>
</p></li>
<li><p><span class="target" id="sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.where"></span><strong>where</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.dialects.sqlite.Insert.on_conflict_do_update.params.where">¶</a> – Optional argument. If present, can be a literal SQL
string or an acceptable expression for a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause
that restricts the rows affected by <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">UPDATE</span> <span class="pre">SET</span></code>. Rows
not meeting the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> condition will not be updated
(effectively a <code class="docutils literal notranslate"><span class="pre">DO</span> <span class="pre">NOTHING</span></code> for those rows).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="pysqlite">
<span id="id1"></span><h2>Pysqlite<a class="headerlink" href="#pysqlite" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-sqlalchemy.dialects.sqlite.pysqlite"></span><p>Support for the SQLite database via the pysqlite driver.<p>Note that <code class="docutils literal notranslate"><span class="pre">pysqlite</span></code> is the same driver as the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code>
module included with the Python distribution.</p>
</p>
<section id="dialect-sqlite-pysqlite-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-pysqlite-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for pysqlite is available at:
<a class="reference external" href="https://docs.python.org/library/sqlite3.html">https://docs.python.org/library/sqlite3.html</a></p>
</section>
<section id="dialect-sqlite-pysqlite-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlite-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">+</span><span class="n">pysqlite</span><span class="p">:</span><span class="o">///</span><span class="n">file_path</span></pre></div>
</div>
</p>
</section>
<section id="driver">
<h3>Driver<a class="headerlink" href="#driver" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> Python DBAPI is standard on all modern Python versions;
for cPython and Pypy, no additional installation is necessary.</p>
</section>
<section id="connect-strings">
<h3>Connect Strings<a class="headerlink" href="#connect-strings" title="Permalink to this headline">¶</a></h3>
<p>The file specification for the SQLite database is taken as the “database”
portion of the URL.  Note that the format of a SQLAlchemy url is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">driver</span><span class="p">:</span><span class="o">//</span><span class="n">user</span><span class="p">:</span><span class="k">pass</span><span class="nd">@host</span><span class="o">/</span><span class="n">database</span></pre></div>
</div>
<p>This means that the actual filename to be used starts with the characters to
the <strong>right</strong> of the third slash.   So connecting to a relative filepath
looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># relative path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>An absolute path, which is denoted by starting with a slash, means you
need <strong>four</strong> slashes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># absolute path</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:////path/to/database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>To use a Windows path, regular drive specifications and backslashes can be
used. Double backslashes are probably needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># absolute path on Windows</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///C:</span><span class="se">\\</span><span class="s1">path</span><span class="se">\\</span><span class="s1">to</span><span class="se">\\</span><span class="s1">database.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>The sqlite <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> identifier is the default if no filepath is
present.  Specify <code class="docutils literal notranslate"><span class="pre">sqlite://</span></code> and nothing else:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in-memory database</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">)</span></pre></div>
</div>
<section id="uri-connections">
<span id="pysqlite-uri-connections"></span><h4>URI Connections<a class="headerlink" href="#uri-connections" title="Permalink to this headline">¶</a></h4>
<p>Modern versions of SQLite support an alternative system of connecting using a
<a class="reference external" href="https://www.sqlite.org/uri.html">driver level URI</a>, which has the  advantage
that additional driver-level arguments can be passed including options such as
“read only”.   The Python sqlite3 driver supports this mode under modern Python
3 versions.   The SQLAlchemy pysqlite driver supports this mode of use by
specifying “uri=true” in the URL query string.  The SQLite-level “URI” is kept
as the “database” portion of the SQLAlchemy url (that is, following a slash):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///file:path/to/database?mode=ro&amp;uri=true&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “uri=true” parameter must appear in the <strong>query string</strong>
of the URL.  It will not currently work as expected if it is only
present in the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a>
parameter dictionary.</p>
</div>
<p>The logic reconciles the simultaneous presence of SQLAlchemy’s query string and
SQLite’s query string by separating out the parameters that belong to the
Python sqlite3 driver vs. those that belong to the SQLite URI.  This is
achieved through the use of a fixed list of parameters known to be accepted by
the Python side of the driver.  For example, to include a URL that indicates
the Python sqlite3 “timeout” and “check_same_thread” parameters, along with the
SQLite “mode” and “nolock” parameters, they can all be passed together on the
query string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;sqlite:///file:path/to/database?&quot;</span>
    <span class="s2">&quot;check_same_thread=true&amp;timeout=10&amp;mode=ro&amp;nolock=1&amp;uri=true&quot;</span>
<span class="p">)</span></pre></div>
</div>
<p>Above, the pysqlite / sqlite3 DBAPI would be passed arguments as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="s2">&quot;file:path/to/database?mode=ro&amp;nolock=1&quot;</span><span class="p">,</span>
    <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span></pre></div>
</div>
<p>Regarding future parameters added to either the Python or native drivers. new
parameter names added to the SQLite URI scheme should be automatically
accommodated by this scheme.  New parameter names added to the Python driver
side can be accommodated by specifying them in the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.connect_args" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.connect_args</span></code></a> dictionary,
until dialect support is
added by SQLAlchemy.   For the less likely case that the native SQLite driver
adds a new parameter name that overlaps with one of the existing, known Python
driver parameters (such as “timeout” perhaps), SQLAlchemy’s dialect would
require adjustment for the URL scheme to continue to support this.</p>
<p>As is always the case for all SQLAlchemy dialects, the entire “URL” process
can be bypassed in <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a> through the use of the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.creator" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.creator</span></code></a>
parameter which allows for a custom callable
that creates a Python sqlite3 driver level connection directly.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.3.9.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://www.sqlite.org/uri.html">Uniform Resource Identifiers</a> - in
the SQLite documentation</p>
</div>
</section>
</section>
<section id="regular-expression-support">
<span id="pysqlite-regexp"></span><h3>Regular Expression Support<a class="headerlink" href="#regular-expression-support" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.4.</span></p>
</div>
<p>Support for the <a class="reference internal" href="../core/sqlelement.html#sqlalchemy.sql.expression.ColumnOperators.regexp_match" title="sqlalchemy.sql.expression.ColumnOperators.regexp_match"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ColumnOperators.regexp_match()</span></code></a> operator is provided
using Python’s <a class="reference external" href="https://docs.python.org/3/library/re.html#re.search">re.search</a> function.  SQLite itself does not include a working
regular expression operator; instead, it includes a non-implemented placeholder
operator <code class="docutils literal notranslate"><span class="pre">REGEXP</span></code> that calls a user-defined function that must be provided.</p>
<p>SQLAlchemy’s implementation makes use of the pysqlite <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Connection.create_function">create_function</a> hook
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">regexp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="n">sqlite_connection</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span>
    <span class="s2">&quot;regexp&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">regexp</span><span class="p">,</span>
<span class="p">)</span></pre></div>
</div>
<p>There is currently no support for regular expression flags as a separate
argument, as these are not supported by SQLite’s REGEXP operator, however these
may be included inline within the regular expression string.  See <a class="reference external" href="https://docs.python.org/3/library/re.html#re.search">Python regular expressions</a> for
details.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://docs.python.org/3/library/re.html#re.search">Python regular expressions</a>: Documentation for Python’s regular expression syntax.</p>
</div>
</section>
<section id="compatibility-with-sqlite3-native-date-and-datetime-types">
<h3>Compatibility with sqlite3 “native” date and datetime types<a class="headerlink" href="#compatibility-with-sqlite3-native-date-and-datetime-types" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver includes the sqlite3.PARSE_DECLTYPES and
sqlite3.PARSE_COLNAMES options, which have the effect of any column
or expression explicitly cast as “date” or “timestamp” will be converted
to a Python date or datetime object.  The date and datetime types provided
with the pysqlite dialect are not currently compatible with these options,
since they render the ISO date/datetime including microseconds, which
pysqlite’s driver does not.   Additionally, SQLAlchemy does not at
this time automatically render the “cast” syntax required for the
freestanding functions “current_timestamp” and “current_date” to return
datetime/date types natively.   Unfortunately, pysqlite
does not provide the standard DBAPI types in <code class="docutils literal notranslate"><span class="pre">cursor.description</span></code>,
leaving SQLAlchemy with no way to detect these types on the fly
without expensive per-row type checks.</p>
<p>Keeping in mind that pysqlite’s parsing option is not recommended,
nor should be necessary, for use with SQLAlchemy, usage of PARSE_DECLTYPES
can be forced if one configures “native_datetime=True” on create_engine():</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span>
    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;detect_types&#39;</span><span class="p">:</span>
        <span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_DECLTYPES</span><span class="o">|</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">PARSE_COLNAMES</span><span class="p">},</span>
    <span class="n">native_datetime</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span></pre></div>
</div>
<p>With this flag enabled, the DATE and TIMESTAMP types (but note - not the
DATETIME or TIME types…confused yet ?) will not perform any bind parameter
or result processing. Execution of “func.current_date()” will return a string.
“func.current_timestamp()” is registered as returning a DATETIME type in
SQLAlchemy, so this function still receives SQLAlchemy-level result
processing.</p>
</section>
<section id="threading-pooling-behavior">
<span id="pysqlite-threading-pooling"></span><h3>Threading/Pooling Behavior<a class="headerlink" href="#threading-pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>Pysqlite’s default behavior is to prohibit the usage of a single connection
in more than one thread.   This is originally intended to work with older
versions of SQLite that did not support multithreaded operation under
various circumstances.  In particular, older SQLite versions
did not allow a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database to be used in multiple threads
under any circumstances.</p>
<p>Pysqlite does include a now-undocumented flag known as
<code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> which will disable this check, however note that
pysqlite connections are still not safe to use in concurrently in multiple
threads.  In particular, any statement execution calls would need to be
externally mutexed, as Pysqlite does not provide for thread-safe propagation
of error messages among other things.   So while even <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> databases
can be shared among threads in modern SQLite, Pysqlite doesn’t provide enough
thread-safety to make this usage worth it.</p>
<p>SQLAlchemy sets up pooling to work with Pysqlite’s default behavior:</p>
<ul class="simple">
<li><p>When a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> SQLite database is specified, the dialect by default
will use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a>. This pool maintains a single
connection per thread, so that all access to the engine within the current
thread use the same <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database - other threads would access a
different <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database.</p></li>
<li><p>When a file-based database is specified, the dialect will use
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> as the source of connections. This pool closes and
discards connections which are returned to the pool immediately. SQLite
file-based connections have extremely low overhead, so pooling is not
necessary. The scheme also prevents a connection from being used again in
a different thread and works best with SQLite’s coarse-grained file locking.</p></li>
</ul>
<section id="using-a-memory-database-in-multiple-threads">
<h4>Using a Memory Database in Multiple Threads<a class="headerlink" href="#using-a-memory-database-in-multiple-threads" title="Permalink to this headline">¶</a></h4>
<p>To use a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database in a multithreaded scenario, the same
connection object must be shared among threads, since the database exists
only within the scope of that connection.   The
<a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a> implementation will maintain a single connection
globally, and the <code class="docutils literal notranslate"><span class="pre">check_same_thread</span></code> flag can be passed to Pysqlite
as <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite://&#39;</span><span class="p">,</span>
                    <span class="n">connect_args</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;check_same_thread&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">},</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that using a <code class="docutils literal notranslate"><span class="pre">:memory:</span></code> database in multiple threads requires a recent
version of SQLite.</p>
</section>
<section id="using-temporary-tables-with-sqlite">
<h4>Using Temporary Tables with SQLite<a class="headerlink" href="#using-temporary-tables-with-sqlite" title="Permalink to this headline">¶</a></h4>
<p>Due to the way SQLite deals with temporary tables, if you wish to use a
temporary table in a file-based SQLite database across multiple checkouts
from the connection pool, such as when using an ORM <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session" title="sqlalchemy.orm.Session"><code class="xref py py-class docutils literal notranslate"><span class="pre">Session</span></code></a> where
the temporary table should continue to remain after <a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.commit" title="sqlalchemy.orm.Session.commit"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.commit()</span></code></a> or
<a class="reference internal" href="../orm/session_api.html#sqlalchemy.orm.Session.rollback" title="sqlalchemy.orm.Session.rollback"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Session.rollback()</span></code></a> is called, a pool which maintains a single
connection must be used.   Use <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> if the scope is
only needed within the current thread, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.StaticPool" title="sqlalchemy.pool.StaticPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">StaticPool</span></code></a> is scope is
needed within multiple threads for this case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># maintain the same connection per thread</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">SingletonThreadPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">SingletonThreadPool</span><span class="p">)</span>


<span class="c1"># maintain the same connection across all threads</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">StaticPool</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///mydb.db&#39;</span><span class="p">,</span>
                    <span class="n">poolclass</span><span class="o">=</span><span class="n">StaticPool</span><span class="p">)</span></pre></div>
</div>
<p>Note that <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a> should be configured for the number
of threads that are to be used; beyond that number, connections will be
closed out in a non deterministic way.</p>
</section>
</section>
<section id="unicode">
<h3>Unicode<a class="headerlink" href="#unicode" title="Permalink to this headline">¶</a></h3>
<p>The pysqlite driver only returns Python <code class="docutils literal notranslate"><span class="pre">unicode</span></code> objects in result sets,
never plain strings, and accommodates <code class="docutils literal notranslate"><span class="pre">unicode</span></code> objects within bound
parameter values in all cases.   Regardless of the SQLAlchemy string type in
use, string-based result values will by Python <code class="docutils literal notranslate"><span class="pre">unicode</span></code> in Python 2.
The <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.Unicode" title="sqlalchemy.types.Unicode"><code class="xref py py-class docutils literal notranslate"><span class="pre">Unicode</span></code></a> type should still be used to indicate those columns that
require unicode, however, so that non-<code class="docutils literal notranslate"><span class="pre">unicode</span></code> values passed inadvertently
will emit a warning.  Pysqlite will emit an error if a non-<code class="docutils literal notranslate"><span class="pre">unicode</span></code> string
is passed containing non-ASCII characters.</p>
</section>
<section id="dealing-with-mixed-string-binary-columns-in-python-3">
<h3>Dealing with Mixed String / Binary Columns in Python 3<a class="headerlink" href="#dealing-with-mixed-string-binary-columns-in-python-3" title="Permalink to this headline">¶</a></h3>
<p>The SQLite database is weakly typed, and as such it is possible when using
binary values, which in Python 3 are represented as <code class="docutils literal notranslate"><span class="pre">b'some</span> <span class="pre">string'</span></code>, that a
particular SQLite database can have data values within different rows where
some of them will be returned as a <code class="docutils literal notranslate"><span class="pre">b''</span></code> value by the Pysqlite driver, and
others will be returned as Python strings, e.g. <code class="docutils literal notranslate"><span class="pre">''</span></code> values.   This situation
is not known to occur if the SQLAlchemy <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> datatype is used
consistently, however if a particular SQLite database has data that was
inserted using the Pysqlite driver directly, or when using the SQLAlchemy
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.String" title="sqlalchemy.types.String"><code class="xref py py-class docutils literal notranslate"><span class="pre">String</span></code></a> type which was later changed to <a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a>, the
table will not be consistently readable because SQLAlchemy’s
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> datatype does not handle strings so it has no way of
“encoding” a value that is in string format.</p>
<p>To deal with a SQLite table that has mixed string / binary data in the
same column, use a custom type that will check each row individually:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># note this is Python 3 only</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">TypeDecorator</span>

<span class="k">class</span> <span class="nc">MixedBinary</span><span class="p">(</span><span class="n">TypeDecorator</span><span class="p">):</span>
    <span class="n">impl</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">cache_ok</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">process_result_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dialect</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></pre></div>
</div>
<p>Then use the above <code class="docutils literal notranslate"><span class="pre">MixedBinary</span></code> datatype in the place where
<a class="reference internal" href="../core/type_basics.html#sqlalchemy.types.LargeBinary" title="sqlalchemy.types.LargeBinary"><code class="xref py py-class docutils literal notranslate"><span class="pre">LargeBinary</span></code></a> would normally be used.</p>
</section>
<section id="serializable-isolation-savepoints-transactional-ddl">
<span id="pysqlite-serializable"></span><h3>Serializable isolation / Savepoints / Transactional DDL<a class="headerlink" href="#serializable-isolation-savepoints-transactional-ddl" title="Permalink to this headline">¶</a></h3>
<p>In the section <a class="reference internal" href="#sqlite-concurrency"><span class="std std-ref">Database Locking Behavior / Concurrency</span></a>, we refer to the pysqlite
driver’s assortment of issues that prevent several features of SQLite
from working correctly.  The pysqlite DBAPI driver has several
long-standing bugs which impact the correctness of its transactional
behavior.   In its default mode of operation, SQLite features such as
SERIALIZABLE isolation, transactional DDL, and SAVEPOINT support are
non-functional, and in order to use these features, workarounds must
be taken.</p>
<p>The issue is essentially that the driver attempts to second-guess the user’s
intent, failing to start transactions and sometimes ending them prematurely, in
an effort to minimize the SQLite databases’s file locking behavior, even
though SQLite itself uses “shared” locks for read-only activities.</p>
<p>SQLAlchemy chooses to not alter this behavior by default, as it is the
long-expected behavior of the pysqlite driver; if and when the pysqlite
driver attempts to repair these issues, that will be more of a driver towards
defaults for SQLAlchemy.</p>
<p>The good news is that with a few events, we can implement transactional
support fully, by disabling pysqlite’s feature entirely and emitting BEGIN
ourselves. This is achieved using two event listeners:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">event</span>

<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///myfile.db&quot;</span><span class="p">)</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_connect</span><span class="p">(</span><span class="n">dbapi_connection</span><span class="p">,</span> <span class="n">connection_record</span><span class="p">):</span>
    <span class="c1"># disable pysqlite&#39;s emitting of the BEGIN statement entirely.</span>
    <span class="c1"># also stops it from emitting COMMIT before any DDL.</span>
    <span class="n">dbapi_connection</span><span class="o">.</span><span class="n">isolation_level</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="c1"># emit our own BEGIN</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;BEGIN&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using the above recipe, it is advised to not use the
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection.execution_options.params.isolation_level" title="sqlalchemy.engine.Connection.execution_options"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">Connection.execution_options.isolation_level</span></code></a> setting on
<a class="reference internal" href="../core/connections.html#sqlalchemy.engine.Connection" title="sqlalchemy.engine.Connection"><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code></a> and <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine" title="sqlalchemy.create_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_engine()</span></code></a>
with the SQLite driver,
as this function necessarily will also alter the “.isolation_level” setting.</p>
</div>
<p>Above, we intercept a new pysqlite connection and disable any transactional
integration.   Then, at the point at which SQLAlchemy knows that transaction
scope is to begin, we emit <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code> ourselves.</p>
<p>When we take control of <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code>, we can also control directly SQLite’s
locking modes, introduced at
<a class="reference external" href="https://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a>,
by adding the desired locking mode to our <code class="docutils literal notranslate"><span class="pre">&quot;BEGIN&quot;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@event</span><span class="o">.</span><span class="n">listens_for</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;begin&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">do_begin</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">exec_driver_sql</span><span class="p">(</span><span class="s2">&quot;BEGIN EXCLUSIVE&quot;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="https://sqlite.org/lang_transaction.html">BEGIN TRANSACTION</a> -
on the SQLite site</p>
<p><a class="reference external" href="https://bugs.python.org/issue9924">sqlite3 SELECT does not BEGIN a transaction</a> -
on the Python bug tracker</p>
<p><a class="reference external" href="https://bugs.python.org/issue10740">sqlite3 module breaks transactions and potentially corrupts data</a> -
on the Python bug tracker</p>
</div>
</section>
</section>
<section id="aiosqlite">
<span id="id4"></span><h2>Aiosqlite<a class="headerlink" href="#aiosqlite" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-sqlalchemy.dialects.sqlite.aiosqlite"></span><p>Support for the SQLite database via the aiosqlite driver.</p>
<section id="dialect-sqlite-aiosqlite-url">
<h3>DBAPI<a class="headerlink" href="#dialect-sqlite-aiosqlite-url" title="Permalink to this headline">¶</a></h3>
<p>Documentation and download information (if applicable) for aiosqlite is available at:
<a class="reference external" href="https://pypi.org/project/aiosqlite/">https://pypi.org/project/aiosqlite/</a></p>
</section>
<section id="dialect-sqlite-aiosqlite-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-aiosqlite-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlite</span><span class="o">+</span><span class="n">aiosqlite</span><span class="p">:</span><span class="o">///</span><span class="n">file_path</span></pre></div>
</div>
</p>
</section>
<p>The aiosqlite dialect provides support for the SQLAlchemy asyncio interface
running on top of pysqlite.</p>
<p>aiosqlite is a wrapper around pysqlite that uses a background thread for
each connection.   It does not actually use non-blocking IO, as SQLite
databases are not socket-based.  However it does provide a working asyncio
interface that’s useful for testing and prototyping purposes.</p>
<p>Using a special asyncio mediation layer, the aiosqlite dialect is usable
as the backend for the <a class="reference internal" href="../orm/extensions/asyncio.html"><span class="std std-ref">SQLAlchemy asyncio</span></a>
extension package.</p>
<p>This dialect should normally be used only with the
<a class="reference internal" href="../orm/extensions/asyncio.html#sqlalchemy.ext.asyncio.create_async_engine" title="sqlalchemy.ext.asyncio.create_async_engine"><code class="xref py py-func docutils literal notranslate"><span class="pre">create_async_engine()</span></code></a> engine creation function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.asyncio</span> <span class="kn">import</span> <span class="n">create_async_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_async_engine</span><span class="p">(</span><span class="s2">&quot;sqlite+aiosqlite:///filename&quot;</span><span class="p">)</span></pre></div>
</div>
<p>The URL passes through all arguments to the <code class="docutils literal notranslate"><span class="pre">pysqlite</span></code> driver, so all
connection arguments are the same as they are for that of <a class="reference internal" href="#pysqlite"><span class="std std-ref">Pysqlite</span></a>.</p>
</section>
<section id="pysqlcipher">
<span id="id5"></span><h2>Pysqlcipher<a class="headerlink" href="#pysqlcipher" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-sqlalchemy.dialects.sqlite.pysqlcipher"></span><p>Support for the SQLite database via the pysqlcipher driver.<p>Dialect for support of DBAPIs that make use of the
<a class="reference external" href="https://www.zetetic.net/sqlcipher">SQLCipher</a> backend.</p>
</p>
<section id="dialect-sqlite-pysqlcipher-connect">
<h3>Connecting<a class="headerlink" href="#dialect-sqlite-pysqlcipher-connect" title="Permalink to this headline">¶</a></h3>
<p>Connect String:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sqlite+pysqlcipher://:passphrase@/file_path[?kdf_iter=&lt;iter&gt;]</pre></div>
</div>
</p>
</section>
<section id="id6">
<h3>Driver<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Current dialect selection logic is:</p>
<ul class="simple">
<li><p>If the <a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.module" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.module</span></code></a> parameter supplies a DBAPI module,
that module is used.</p></li>
<li><p>Otherwise for Python 3, choose <a class="reference external" href="https://pypi.org/project/sqlcipher3/">https://pypi.org/project/sqlcipher3/</a></p></li>
<li><p>If not available, fall back to <a class="reference external" href="https://pypi.org/project/pysqlcipher3/">https://pypi.org/project/pysqlcipher3/</a></p></li>
<li><p>For Python 2, <a class="reference external" href="https://pypi.org/project/pysqlcipher/">https://pypi.org/project/pysqlcipher/</a> is used.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pysqlcipher3</span></code> and <code class="docutils literal notranslate"><span class="pre">pysqlcipher</span></code> DBAPI drivers are no
longer maintained; the <code class="docutils literal notranslate"><span class="pre">sqlcipher3</span></code> driver as of this writing appears
to be current.  For future compatibility, any pysqlcipher-compatible DBAPI
may be used as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlcipher_compatible_driver</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span>
    <span class="s2">&quot;sqlite+pysqlcipher://:password@/dbname.db&quot;</span><span class="p">,</span>
    <span class="n">module</span><span class="o">=</span><span class="n">sqlcipher_compatible_driver</span>
<span class="p">)</span></pre></div>
</div>
</div>
<p>These drivers make use of the SQLCipher engine. This system essentially
introduces new PRAGMA commands to SQLite which allows the setting of a
passphrase and other encryption parameters, allowing the database file to be
encrypted.</p>
</section>
<section id="id7">
<h3>Connect Strings<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The format of the connect string is in every way the same as that
of the <a class="reference internal" href="#module-sqlalchemy.dialects.sqlite.pysqlite" title="sqlalchemy.dialects.sqlite.pysqlite"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysqlite</span></code></a> driver, except that the
“password” field is now accepted, which should contain a passphrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>For an absolute file path, two leading slashes should be used for the
database name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@//path/to/foo.db&#39;</span><span class="p">)</span></pre></div>
</div>
<p>A selection of additional encryption-related pragmas supported by SQLCipher
as documented at <a class="reference external" href="https://www.zetetic.net/sqlcipher/sqlcipher-api/">https://www.zetetic.net/sqlcipher/sqlcipher-api/</a> can be passed
in the query string, and will result in that PRAGMA being called for each
new connection.  Currently, <code class="docutils literal notranslate"><span class="pre">cipher</span></code>, <code class="docutils literal notranslate"><span class="pre">kdf_iter</span></code>
<code class="docutils literal notranslate"><span class="pre">cipher_page_size</span></code> and <code class="docutils literal notranslate"><span class="pre">cipher_use_hmac</span></code> are supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite+pysqlcipher://:testing@/foo.db?cipher=aes-256-cfb&amp;kdf_iter=64000&#39;</span><span class="p">)</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Previous versions of sqlalchemy did not take into consideration
the encryption-related pragmas passed in the url string, that were silently
ignored. This may cause errors when opening files saved by a
previous sqlalchemy version if the encryption options do not match.</p>
</div>
</section>
<section id="pooling-behavior">
<h3>Pooling Behavior<a class="headerlink" href="#pooling-behavior" title="Permalink to this headline">¶</a></h3>
<p>The driver makes a change to the default pool behavior of pysqlite
as described in <a class="reference internal" href="#pysqlite-threading-pooling"><span class="std std-ref">Threading/Pooling Behavior</span></a>.   The pysqlcipher driver
has been observed to be significantly slower on connection than the
pysqlite driver, most likely due to the encryption overhead, so the
dialect here defaults to using the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.SingletonThreadPool" title="sqlalchemy.pool.SingletonThreadPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">SingletonThreadPool</span></code></a>
implementation,
instead of the <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> pool used by pysqlite.  As always, the pool
implementation is entirely configurable using the
<a class="reference internal" href="../core/engines.html#sqlalchemy.create_engine.params.poolclass" title="sqlalchemy.create_engine"><code class="xref py py-paramref docutils literal notranslate"><span class="pre">create_engine.poolclass</span></code></a> parameter; the <code class="xref py py-class docutils literal notranslate">
<span class="pre">StaticPool</span></code> may
be more feasible for single-threaded use, or <a class="reference internal" href="../core/pooling.html#sqlalchemy.pool.NullPool" title="sqlalchemy.pool.NullPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">NullPool</span></code></a> may be used
to prevent unencrypted connections from being held open for long periods of
time, at the expense of slower startup time for new connections.</p>
</section>
</section>
</section>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="mysql.html" title="previous chapter">MySQL and MariaDB</a>
        Next:
        <a href="oracle.html" title="next chapter">Oracle</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2021, the SQLAlchemy authors and contributors.


    <p><b>flambé!</b> the dragon and <b><i>The Alchemist</i></b> image designs created and generously donated by <a href="https://github.com/vmalloc">Rotem Yaari</a>.</p>

        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.1.2.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.4.23',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


